{"version":3,"sources":["../../src/notifications/notifications.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Patch,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  Request,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiQuery } from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { NotificationsService } from './notifications.service';\nimport {\n  RegisterPushTokenDto,\n  SendNotificationDto,\n  SendBulkNotificationDto,\n} from './dto/notification.dto';\n\n@ApiTags('Notifications')\n@Controller('notifications')\n@UseGuards(JwtAuthGuard)\n@ApiBearerAuth('JWT-auth')\nexport class NotificationsController {\n  constructor(private readonly notificationsService: NotificationsService) {}\n\n  @Post('register-token')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Register or update push notification token' })\n  @ApiResponse({ status: 200, description: 'Token registered successfully' })\n  @ApiResponse({ status: 400, description: 'Invalid token format' })\n  async registerToken(@Request() req: any, @Body() dto: RegisterPushTokenDto) {\n    return this.notificationsService.registerPushToken(\n      req.user.id,\n      dto.token,\n      dto.deviceInfo\n    );\n  }\n\n  @Get()\n  @ApiOperation({ summary: 'Get user notifications' })\n  @ApiResponse({ status: 200, description: 'Notifications retrieved successfully' })\n  @ApiQuery({ name: 'limit', required: false, type: Number })\n  @ApiQuery({ name: 'offset', required: false, type: Number })\n  async getNotifications(\n    @Request() req: any,\n    @Query('limit') limit?: number,\n    @Query('offset') offset?: number\n  ) {\n    return this.notificationsService.getUserNotifications(\n      req.user.id,\n      limit ? Number(limit) : 50,\n      offset ? Number(offset) : 0\n    );\n  }\n\n  @Get('unread-count')\n  @ApiOperation({ summary: 'Get unread notification count' })\n  @ApiResponse({ status: 200, description: 'Unread count retrieved successfully' })\n  async getUnreadCount(@Request() req: any) {\n    const count = await this.notificationsService.getUnreadCount(req.user.id);\n    return { count };\n  }\n\n  @Patch(':id/read')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Mark notification as read' })\n  @ApiResponse({ status: 200, description: 'Notification marked as read' })\n  @ApiResponse({ status: 400, description: 'Notification not found' })\n  async markAsRead(@Request() req: any, @Param('id') id: string) {\n    return this.notificationsService.markAsRead(id, req.user.id);\n  }\n\n  @Patch('mark-all-read')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Mark all notifications as read' })\n  @ApiResponse({ status: 200, description: 'All notifications marked as read' })\n  async markAllAsRead(@Request() req: any) {\n    return this.notificationsService.markAllAsRead(req.user.id);\n  }\n\n  // Admin/System endpoints\n  @Post('send')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Send notification to a user (admin/system)' })\n  @ApiResponse({ status: 200, description: 'Notification sent successfully' })\n  async sendNotification(@Body() dto: SendNotificationDto) {\n    return this.notificationsService.sendNotification(\n      dto.userId,\n      dto.title,\n      dto.body,\n      dto.data,\n      dto.type\n    );\n  }\n\n  @Post('send-bulk')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Send notification to multiple users (admin/system)' })\n  @ApiResponse({ status: 200, description: 'Bulk notifications sent successfully' })\n  async sendBulkNotification(@Body() dto: SendBulkNotificationDto) {\n    return this.notificationsService.sendBulkNotifications(\n      dto.userIds,\n      dto.title,\n      dto.body,\n      dto.data,\n      dto.type\n    );\n  }\n}\n"],"names":["NotificationsController","registerToken","req","dto","notificationsService","registerPushToken","user","id","token","deviceInfo","getNotifications","limit","offset","getUserNotifications","Number","getUnreadCount","count","markAsRead","markAllAsRead","sendNotification","userId","title","body","data","type","sendBulkNotification","sendBulkNotifications","userIds","OK","summary","status","description","name","required"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBAdN;yBACqE;8BAC/C;sCACQ;iCAK9B;;;;;;;;;;;;;;;AAMA,IAAA,AAAMA,0BAAN,MAAMA;IAGX,MAKMC,cAAc,AAAWC,GAAQ,EAAE,AAAQC,GAAyB,EAAE;QAC1E,OAAO,IAAI,CAACC,oBAAoB,CAACC,iBAAiB,CAChDH,IAAII,IAAI,CAACC,EAAE,EACXJ,IAAIK,KAAK,EACTL,IAAIM,UAAU;IAElB;IAEA,MAKMC,iBACJ,AAAWR,GAAQ,EACnB,AAAgBS,KAAc,EAC9B,AAAiBC,MAAe,EAChC;QACA,OAAO,IAAI,CAACR,oBAAoB,CAACS,oBAAoB,CACnDX,IAAII,IAAI,CAACC,EAAE,EACXI,QAAQG,OAAOH,SAAS,IACxBC,SAASE,OAAOF,UAAU;IAE9B;IAEA,MAGMG,eAAe,AAAWb,GAAQ,EAAE;QACxC,MAAMc,QAAQ,MAAM,IAAI,CAACZ,oBAAoB,CAACW,cAAc,CAACb,IAAII,IAAI,CAACC,EAAE;QACxE,OAAO;YAAES;QAAM;IACjB;IAEA,MAKMC,WAAW,AAAWf,GAAQ,EAAE,AAAaK,EAAU,EAAE;QAC7D,OAAO,IAAI,CAACH,oBAAoB,CAACa,UAAU,CAACV,IAAIL,IAAII,IAAI,CAACC,EAAE;IAC7D;IAEA,MAIMW,cAAc,AAAWhB,GAAQ,EAAE;QACvC,OAAO,IAAI,CAACE,oBAAoB,CAACc,aAAa,CAAChB,IAAII,IAAI,CAACC,EAAE;IAC5D;IAEA,yBAAyB;IACzB,MAIMY,iBAAiB,AAAQhB,GAAwB,EAAE;QACvD,OAAO,IAAI,CAACC,oBAAoB,CAACe,gBAAgB,CAC/ChB,IAAIiB,MAAM,EACVjB,IAAIkB,KAAK,EACTlB,IAAImB,IAAI,EACRnB,IAAIoB,IAAI,EACRpB,IAAIqB,IAAI;IAEZ;IAEA,MAIMC,qBAAqB,AAAQtB,GAA4B,EAAE;QAC/D,OAAO,IAAI,CAACC,oBAAoB,CAACsB,qBAAqB,CACpDvB,IAAIwB,OAAO,EACXxB,IAAIkB,KAAK,EACTlB,IAAImB,IAAI,EACRnB,IAAIoB,IAAI,EACRpB,IAAIqB,IAAI;IAEZ;IApFA,YAAY,AAAiBpB,oBAA0C,CAAE;aAA5CA,uBAAAA;IAA6C;AAqF5E;;;6CAlFuBwB;;QACLC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAUzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC7BC,MAAM;QAASC,UAAU;QAAOT,MAAMV;;;QACtCkB,MAAM;QAAUC,UAAU;QAAOT,MAAMV;;;;;;;;;;;;;;;;QAcnCe,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAOpBH;;QACLC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;6CAMpBH;;QACLC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAOpBH;;QACLC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAYpBH;;QACLC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa"}