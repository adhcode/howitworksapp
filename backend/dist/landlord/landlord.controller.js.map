{"version":3,"sources":["../../src/landlord/landlord.controller.ts"],"sourcesContent":["import { Controller, Get, Post, UseGuards, Request, Query, Param, Body } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth, ApiQuery } from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { LandlordService } from './landlord.service';\n\n@ApiTags('landlord')\n@Controller('landlord')\n@UseGuards(JwtAuthGuard)\n@ApiBearerAuth()\nexport class LandlordController {\n    constructor(private readonly landlordService: LandlordService) {}\n\n    @Get('dashboard')\n    @ApiOperation({ summary: 'Get landlord dashboard data' })\n    @ApiResponse({ status: 200, description: 'Dashboard data retrieved successfully' })\n    async getDashboard(@Request() req: any) {\n        const dashboardData = await this.landlordService.getDashboardData(req.user.id);\n\n        return {\n            success: true,\n            data: dashboardData,\n        };\n    }\n\n    @Post('generate-payment-schedules')\n    @ApiOperation({ summary: 'Generate payment schedules for existing tenants' })\n    @ApiResponse({ status: 200, description: 'Payment schedules generated successfully' })\n    async generatePaymentSchedules(@Request() req: any) {\n        try {\n            console.log('üöÄ Starting payment schedule generation for landlord:', req.user.id);\n            const result = await this.landlordService.generatePaymentSchedulesForExistingTenants(req.user.id);\n            console.log('‚úÖ Payment schedule generation completed:', result);\n\n            return {\n                success: true,\n                data: result,\n            };\n        } catch (error) {\n            console.error('‚ùå Error generating payment schedules:', error);\n            console.error('Error stack:', error.stack);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('dashboard/refresh')\n    @ApiOperation({ summary: 'Refresh dashboard data with real calculations' })\n    @ApiResponse({ status: 200, description: 'Dashboard refreshed successfully' })\n    async refreshDashboard(@Request() req: any) {\n        try {\n            console.log('üîÑ Refreshing dashboard for landlord:', req.user.id);\n            const dashboardData = await this.landlordService.getDashboardData(req.user.id);\n            console.log('‚úÖ Dashboard refreshed with data:', dashboardData);\n\n            return {\n                success: true,\n                data: dashboardData,\n            };\n        } catch (error) {\n            console.error('‚ùå Error refreshing dashboard:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('rent-contracts')\n    @ApiOperation({ summary: 'Get landlord rent contracts' })\n    @ApiResponse({ status: 200, description: 'Rent contracts retrieved successfully' })\n    @ApiQuery({ name: 'status', required: false, enum: ['active', 'expired', 'terminated'] })\n    @ApiQuery({ name: 'payoutType', required: false, enum: ['monthly', 'yearly'] })\n    async getRentContracts(\n        @Request() req: any,\n        @Query('status') status?: string,\n        @Query('payoutType') payoutType?: string\n    ) {\n        try {\n            const contracts = await this.landlordService.getRentContracts(req.user.id, { status, payoutType });\n            return {\n                success: true,\n                data: contracts,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching rent contracts:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('escrow-balances')\n    @ApiOperation({ summary: 'Get landlord escrow balances' })\n    @ApiResponse({ status: 200, description: 'Escrow balances retrieved successfully' })\n    async getEscrowBalances(@Request() req: any) {\n        try {\n            const balances = await this.landlordService.getEscrowBalances(req.user.id);\n            return {\n                success: true,\n                data: balances,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching escrow balances:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('payment-history')\n    @ApiOperation({ summary: 'Get landlord payment history with contract filtering' })\n    @ApiResponse({ status: 200, description: 'Payment history retrieved successfully' })\n    @ApiQuery({ name: 'contractId', required: false })\n    @ApiQuery({ name: 'page', required: false, type: Number })\n    @ApiQuery({ name: 'limit', required: false, type: Number })\n    async getPaymentHistory(\n        @Request() req: any,\n        @Query('contractId') contractId?: string,\n        @Query('page') page: number = 1,\n        @Query('limit') limit: number = 20\n    ) {\n        try {\n            const history = await this.landlordService.getPaymentHistory(req.user.id, {\n                contractId,\n                page,\n                limit,\n            });\n            return {\n                success: true,\n                data: history,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching payment history:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('contract-stats')\n    @ApiOperation({ summary: 'Get contract-based payment statistics' })\n    @ApiResponse({ status: 200, description: 'Contract statistics retrieved successfully' })\n    async getContractStats(@Request() req: any) {\n        try {\n            const stats = await this.landlordService.getContractStats(req.user.id);\n            return {\n                success: true,\n                data: stats,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching contract stats:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    // Maintenance endpoints\n    @Get('maintenance')\n    @ApiOperation({ summary: 'Get all maintenance requests for landlord properties' })\n    @ApiResponse({ status: 200, description: 'Maintenance requests retrieved successfully' })\n    @ApiQuery({ name: 'status', required: false, enum: ['pending', 'in_progress', 'completed', 'cancelled'] })\n    @ApiQuery({ name: 'propertyId', required: false })\n    async getMaintenanceRequests(\n        @Request() req: any,\n        @Query('status') status?: string,\n        @Query('propertyId') propertyId?: string\n    ) {\n        try {\n            const requests = await this.landlordService.getMaintenanceRequests(req.user.id, { status, propertyId });\n            return {\n                success: true,\n                data: requests,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching maintenance requests:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('maintenance/stats')\n    @ApiOperation({ summary: 'Get maintenance statistics for landlord' })\n    @ApiResponse({ status: 200, description: 'Maintenance statistics retrieved successfully' })\n    async getMaintenanceStats(@Request() req: any) {\n        try {\n            const stats = await this.landlordService.getMaintenanceStats(req.user.id);\n            return {\n                success: true,\n                data: stats,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching maintenance stats:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Get('maintenance/:id')\n    @ApiOperation({ summary: 'Get maintenance request details' })\n    @ApiResponse({ status: 200, description: 'Maintenance request retrieved successfully' })\n    async getMaintenanceRequest(@Request() req: any, @Param('id') id: string) {\n        try {\n            const request = await this.landlordService.getMaintenanceRequest(req.user.id, id);\n            return {\n                success: true,\n                data: request,\n            };\n        } catch (error) {\n            console.error('‚ùå Error fetching maintenance request:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Post('maintenance')\n    @ApiOperation({ summary: 'Report a maintenance issue' })\n    @ApiResponse({ status: 201, description: 'Maintenance request created successfully' })\n    async reportMaintenance(\n        @Request() req: any,\n        @Body() maintenanceData: {\n            propertyId: string;\n            title: string;\n            description: string;\n            priority?: 'low' | 'medium' | 'high' | 'urgent';\n            images?: string[];\n        }\n    ) {\n        try {\n            const request = await this.landlordService.reportMaintenance(req.user.id, maintenanceData);\n            return {\n                success: true,\n                data: request,\n                message: 'Maintenance request submitted successfully',\n            };\n        } catch (error) {\n            console.error('‚ùå Error reporting maintenance:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n\n    @Post('maintenance/:id/comment')\n    @ApiOperation({ summary: 'Add a comment to a maintenance request' })\n    @ApiResponse({ status: 201, description: 'Comment added successfully' })\n    async addMaintenanceComment(\n        @Request() req: any,\n        @Param('id') id: string,\n        @Body() commentData: { comment: string }\n    ) {\n        try {\n            const result = await this.landlordService.addMaintenanceComment(req.user.id, id, commentData.comment);\n            return {\n                success: true,\n                data: result,\n                message: 'Comment added successfully',\n            };\n        } catch (error) {\n            console.error('‚ùå Error adding comment:', error);\n            return {\n                success: false,\n                error: error.message,\n            };\n        }\n    }\n}"],"names":["LandlordController","getDashboard","req","dashboardData","landlordService","getDashboardData","user","id","success","data","generatePaymentSchedules","console","log","result","generatePaymentSchedulesForExistingTenants","error","stack","message","refreshDashboard","getRentContracts","status","payoutType","contracts","getEscrowBalances","balances","getPaymentHistory","contractId","page","limit","history","getContractStats","stats","getMaintenanceRequests","propertyId","requests","getMaintenanceStats","getMaintenanceRequest","request","reportMaintenance","maintenanceData","addMaintenanceComment","commentData","comment","summary","description","name","required","enum","type","Number"],"mappings":"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"}