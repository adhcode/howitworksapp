{"version":3,"sources":["../../src/auth/auth.controller.ts"],"sourcesContent":["import { Controller, Post, Body, HttpCode, HttpStatus, Get, Query, UseGuards, Request, Patch } from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\nimport { AuthService } from './auth.service';\nimport { LoginDto, RegisterDto, AuthResponseDto } from './dto/auth.dto';\nimport { ChangePasswordDto } from './dto/change-password.dto';\nimport { ForgotPasswordDto, ResetPasswordDto } from './dto/forgot-password.dto';\nimport { JwtAuthGuard } from './guards/jwt-auth.guard';\n\n@ApiTags('Authentication')\n@Controller('auth')\nexport class AuthController {\n  constructor(private readonly authService: AuthService) {}\n\n  @Post('register')\n  @ApiOperation({ summary: 'Register a new user' })\n  @ApiResponse({ status: 201, description: 'User registered successfully. Verification email sent.' })\n  @ApiResponse({ status: 409, description: 'User already exists' })\n  async register(@Body() registerDto: RegisterDto): Promise<{ message: string; email: string }> {\n    return this.authService.register(registerDto);\n  }\n\n  @Post('login')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Login user' })\n  @ApiResponse({ status: 200, description: 'Login successful', type: AuthResponseDto })\n  @ApiResponse({ status: 401, description: 'Invalid credentials or email not verified' })\n  async login(@Body() loginDto: LoginDto): Promise<AuthResponseDto> {\n    return this.authService.login(loginDto);\n  }\n\n  @Get('verify-email')\n  @ApiOperation({ summary: 'Verify email address' })\n  @ApiResponse({ status: 200, description: 'Email verified successfully' })\n  @ApiResponse({ status: 400, description: 'Invalid or expired token' })\n  async verifyEmail(@Query('token') token: string): Promise<{ message: string }> {\n    return this.authService.verifyEmail(token);\n  }\n\n  @Post('verify-email-code')\n  @ApiOperation({ summary: 'Verify email address with code' })\n  @ApiResponse({ status: 200, description: 'Email verified successfully' })\n  @ApiResponse({ status: 400, description: 'Invalid or expired code' })\n  async verifyEmailWithCode(@Body() body: { email: string; code: string }): Promise<{ message: string }> {\n    return this.authService.verifyEmailWithCode(body.email, body.code);\n  }\n\n  @Post('resend-verification')\n  @ApiOperation({ summary: 'Resend verification email' })\n  @ApiResponse({ status: 200, description: 'Verification email sent' })\n  @ApiResponse({ status: 400, description: 'User not found or email already verified' })\n  async resendVerification(@Body('email') email: string): Promise<{ message: string }> {\n    return this.authService.resendVerificationEmail(email);\n  }\n\n  @Post('register-admin')\n  @ApiOperation({ summary: 'Register a new admin user (public endpoint)' })\n  @ApiResponse({ status: 201, description: 'Admin registered successfully' })\n  @ApiResponse({ status: 409, description: 'User already exists' })\n  async registerAdmin(@Body() registerDto: RegisterDto): Promise<{ message: string; email: string }> {\n    // Force role to admin\n    const adminRegisterDto = { ...registerDto, role: 'admin' as any };\n    return this.authService.register(adminRegisterDto);\n  }\n\n  @Post('test-email')\n  @ApiOperation({ summary: 'Test email sending (development only)' })\n  @ApiResponse({ status: 200, description: 'Test email sent' })\n  async testEmail(@Body() body: { email: string; name: string }): Promise<{ message: string }> {\n    // Only allow in development\n    if (process.env.NODE_ENV === 'production') {\n      throw new Error('Test endpoint not available in production');\n    }\n    \n    return this.authService.testEmail(body.email, body.name);\n  }\n\n  @Post('manual-verify')\n  @ApiOperation({ summary: 'Manually verify email (development/testing only)' })\n  @ApiResponse({ status: 200, description: 'Email verified manually' })\n  async manualVerifyEmail(@Body() body: { email: string }): Promise<{ message: string }> {\n    // Only allow in development\n    if (process.env.NODE_ENV === 'production') {\n      throw new Error('Manual verification not available in production');\n    }\n    \n    return this.authService.manualVerifyEmail(body.email);\n  }\n\n  @Get('me')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth('JWT-auth')\n  @ApiOperation({ summary: 'Get current authenticated user' })\n  @ApiResponse({ status: 200, description: 'Current user retrieved successfully' })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getCurrentUser(@Request() req: any) {\n    return this.authService.getCurrentUser(req.user.id);\n  }\n\n  @Patch('change-password')\n  @UseGuards(JwtAuthGuard)\n  @ApiBearerAuth('JWT-auth')\n  @ApiOperation({ summary: 'Change user password' })\n  @ApiResponse({ status: 200, description: 'Password changed successfully' })\n  @ApiResponse({ status: 401, description: 'Current password is incorrect' })\n  @ApiResponse({ status: 400, description: 'Invalid request' })\n  async changePassword(\n    @Request() req: any,\n    @Body() changePasswordDto: ChangePasswordDto,\n  ): Promise<{ message: string }> {\n    return this.authService.changePassword(req.user.id, changePasswordDto);\n  }\n\n  @Post('forgot-password')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Request password reset' })\n  @ApiResponse({ status: 200, description: 'Password reset email sent if account exists' })\n  async forgotPassword(@Body() forgotPasswordDto: ForgotPasswordDto): Promise<{ message: string }> {\n    return this.authService.forgotPassword(forgotPasswordDto.email);\n  }\n\n  @Post('reset-password')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Reset password with token' })\n  @ApiResponse({ status: 200, description: 'Password reset successfully' })\n  @ApiResponse({ status: 400, description: 'Invalid or expired token' })\n  async resetPassword(@Body() resetPasswordDto: ResetPasswordDto): Promise<{ message: string }> {\n    return this.authService.resetPassword(resetPasswordDto.token, resetPasswordDto.password);\n  }\n}"],"names":["AuthController","register","registerDto","authService","login","loginDto","verifyEmail","token","verifyEmailWithCode","body","email","code","resendVerification","resendVerificationEmail","registerAdmin","adminRegisterDto","role","testEmail","process","env","NODE_ENV","Error","name","manualVerifyEmail","getCurrentUser","req","user","id","changePassword","changePasswordDto","forgotPassword","forgotPasswordDto","resetPassword","resetPasswordDto","password","summary","status","description","OK","type","AuthResponseDto"],"mappings":";;;;+BAUaA;;;eAAAA;;;wBAVuF;yBAClC;6BACtC;yBAC2B;mCACrB;mCACkB;8BACvB;;;;;;;;;;;;;;;AAItB,IAAA,AAAMA,iBAAN,MAAMA;IAGX,MAIMC,SAAS,AAAQC,WAAwB,EAA+C;QAC5F,OAAO,IAAI,CAACC,WAAW,CAACF,QAAQ,CAACC;IACnC;IAEA,MAKME,MAAM,AAAQC,QAAkB,EAA4B;QAChE,OAAO,IAAI,CAACF,WAAW,CAACC,KAAK,CAACC;IAChC;IAEA,MAIMC,YAAY,AAAgBC,KAAa,EAAgC;QAC7E,OAAO,IAAI,CAACJ,WAAW,CAACG,WAAW,CAACC;IACtC;IAEA,MAIMC,oBAAoB,AAAQC,IAAqC,EAAgC;QACrG,OAAO,IAAI,CAACN,WAAW,CAACK,mBAAmB,CAACC,KAAKC,KAAK,EAAED,KAAKE,IAAI;IACnE;IAEA,MAIMC,mBAAmB,AAAeF,KAAa,EAAgC;QACnF,OAAO,IAAI,CAACP,WAAW,CAACU,uBAAuB,CAACH;IAClD;IAEA,MAIMI,cAAc,AAAQZ,WAAwB,EAA+C;QACjG,sBAAsB;QACtB,MAAMa,mBAAmB;YAAE,GAAGb,WAAW;YAAEc,MAAM;QAAe;QAChE,OAAO,IAAI,CAACb,WAAW,CAACF,QAAQ,CAACc;IACnC;IAEA,MAGME,UAAU,AAAQR,IAAqC,EAAgC;QAC3F,4BAA4B;QAC5B,IAAIS,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACzC,MAAM,IAAIC,MAAM;QAClB;QAEA,OAAO,IAAI,CAAClB,WAAW,CAACc,SAAS,CAACR,KAAKC,KAAK,EAAED,KAAKa,IAAI;IACzD;IAEA,MAGMC,kBAAkB,AAAQd,IAAuB,EAAgC;QACrF,4BAA4B;QAC5B,IAAIS,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;YACzC,MAAM,IAAIC,MAAM;QAClB;QAEA,OAAO,IAAI,CAAClB,WAAW,CAACoB,iBAAiB,CAACd,KAAKC,KAAK;IACtD;IAEA,MAMMc,eAAe,AAAWC,GAAQ,EAAE;QACxC,OAAO,IAAI,CAACtB,WAAW,CAACqB,cAAc,CAACC,IAAIC,IAAI,CAACC,EAAE;IACpD;IAEA,MAOMC,eACJ,AAAWH,GAAQ,EACnB,AAAQI,iBAAoC,EACd;QAC9B,OAAO,IAAI,CAAC1B,WAAW,CAACyB,cAAc,CAACH,IAAIC,IAAI,CAACC,EAAE,EAAEE;IACtD;IAEA,MAIMC,eAAe,AAAQC,iBAAoC,EAAgC;QAC/F,OAAO,IAAI,CAAC5B,WAAW,CAAC2B,cAAc,CAACC,kBAAkBrB,KAAK;IAChE;IAEA,MAKMsB,cAAc,AAAQC,gBAAkC,EAAgC;QAC5F,OAAO,IAAI,CAAC9B,WAAW,CAAC6B,aAAa,CAACC,iBAAiB1B,KAAK,EAAE0B,iBAAiBC,QAAQ;IACzF;IApHA,YAAY,AAAiB/B,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AAqH1D;;;;QAlHkBgC,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAMpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;QAAoBE,MAAMC,wBAAe;;;QACnEJ,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAMzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAQzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QAWzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAazBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAQzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;6CASpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;6CAMpBC;;QACLH,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa"}