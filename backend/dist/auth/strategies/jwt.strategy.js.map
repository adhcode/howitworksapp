{"version":3,"sources":["../../../src/auth/strategies/jwt.strategy.ts"],"sourcesContent":["import { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport { ConfigService } from '@nestjs/config';\nimport { AuthService } from '../auth.service';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor(\n    private readonly configService: ConfigService,\n    private readonly authService: AuthService,\n  ) {\n    super({\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n      ignoreExpiration: false,\n      secretOrKey: configService.getOrThrow<string>('JWT_SECRET'),\n    });\n  }\n\n  async validate(payload: any) {\n    const user = await this.authService.validateUser(payload.sub);\n    if (!user) {\n      throw new UnauthorizedException();\n    }\n    return user;\n  }\n}"],"names":["JwtStrategy","PassportStrategy","Strategy","validate","payload","user","authService","validateUser","sub","UnauthorizedException","configService","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","ignoreExpiration","secretOrKey","getOrThrow"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPqC;0BACjB;6BACI;wBACP;6BACF;;;;;;;;;;AAGrB,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAQ;IAYxD,MAAMC,SAASC,OAAY,EAAE;QAC3B,MAAMC,OAAO,MAAM,IAAI,CAACC,WAAW,CAACC,YAAY,CAACH,QAAQI,GAAG;QAC5D,IAAI,CAACH,MAAM;YACT,MAAM,IAAII,6BAAqB;QACjC;QACA,OAAOJ;IACT;IAjBA,YACE,AAAiBK,aAA4B,EAC7C,AAAiBJ,WAAwB,CACzC;QACA,KAAK,CAAC;YACJK,gBAAgBC,uBAAU,CAACC,2BAA2B;YACtDC,kBAAkB;YAClBC,aAAaL,cAAcM,UAAU,CAAS;QAChD,SAPiBN,gBAAAA,oBACAJ,cAAAA;IAOnB;AASF"}