{"version":3,"sources":["../../../src/tenant-rent-contracts/exceptions/exceptions.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { HttpStatus } from '@nestjs/common';\nimport { ContractNotFoundError } from './contract-not-found.exception';\nimport { InvalidTransitionDateError } from './invalid-transition-date.exception';\nimport { EscrowReleaseError } from './escrow-release.exception';\nimport { RentContractExceptionFilter } from './rent-contract-exception.filter';\n\ndescribe('Rent Contract Exceptions', () => {\n  describe('ContractNotFoundError', () => {\n    it('should create error with correct message and status', () => {\n      const contractId = 'test-contract-id';\n      const error = new ContractNotFoundError(contractId);\n\n      expect(error.name).toBe('ContractNotFoundError');\n      expect(error.getStatus()).toBe(HttpStatus.NOT_FOUND);\n      expect(error.message).toContain(contractId);\n      \n      const response = error.getResponse() as any;\n      expect(response.contractId).toBe(contractId);\n      expect(response.statusCode).toBe(HttpStatus.NOT_FOUND);\n    });\n  });\n\n  describe('InvalidTransitionDateError', () => {\n    it('should create error with correct message and details', () => {\n      const message = 'Invalid date provided';\n      const details = { expiryDate: '2024-01-01', reason: 'too early' };\n      const error = new InvalidTransitionDateError(message, details);\n\n      expect(error.name).toBe('InvalidTransitionDateError');\n      expect(error.getStatus()).toBe(HttpStatus.BAD_REQUEST);\n      expect(error.message).toContain(message);\n      \n      const response = error.getResponse() as any;\n      expect(response.details).toEqual(details);\n      expect(response.statusCode).toBe(HttpStatus.BAD_REQUEST);\n    });\n  });\n\n  describe('EscrowReleaseError', () => {\n    it('should create error with escrow details', () => {\n      const message = 'Release failed';\n      const escrowId = 'escrow-123';\n      const details = { amount: 1000, reason: 'insufficient funds' };\n      const error = new EscrowReleaseError(message, escrowId, details);\n\n      expect(error.name).toBe('EscrowReleaseError');\n      expect(error.getStatus()).toBe(HttpStatus.INTERNAL_SERVER_ERROR);\n      expect(error.message).toContain(message);\n      \n      const response = error.getResponse() as any;\n      expect(response.escrowId).toBe(escrowId);\n      expect(response.details).toEqual(details);\n    });\n  });\n\n  describe('RentContractExceptionFilter', () => {\n    let filter: RentContractExceptionFilter;\n    let mockResponse: any;\n    let mockRequest: any;\n    let mockHost: any;\n\n    beforeEach(async () => {\n      const module: TestingModule = await Test.createTestingModule({\n        providers: [RentContractExceptionFilter],\n      }).compile();\n\n      filter = module.get<RentContractExceptionFilter>(RentContractExceptionFilter);\n\n      mockResponse = {\n        status: jest.fn().mockReturnThis(),\n        json: jest.fn().mockReturnThis(),\n      };\n\n      mockRequest = {\n        url: '/rent-contracts',\n        method: 'POST',\n      };\n\n      mockHost = {\n        switchToHttp: jest.fn().mockReturnValue({\n          getResponse: () => mockResponse,\n          getRequest: () => mockRequest,\n        }),\n      };\n    });\n\n    it('should handle ContractNotFoundError correctly', () => {\n      const contractId = 'test-contract-id';\n      const error = new ContractNotFoundError(contractId);\n\n      filter.catch(error, mockHost);\n\n      expect(mockResponse.status).toHaveBeenCalledWith(HttpStatus.NOT_FOUND);\n      expect(mockResponse.json).toHaveBeenCalledWith(\n        expect.objectContaining({\n          statusCode: HttpStatus.NOT_FOUND,\n          error: 'Contract Not Found',\n          contractId,\n          timestamp: expect.any(String),\n          path: '/rent-contracts',\n          method: 'POST',\n        })\n      );\n    });\n\n    it('should handle InvalidTransitionDateError correctly', () => {\n      const message = 'Invalid date';\n      const details = { reason: 'test' };\n      const error = new InvalidTransitionDateError(message, details);\n\n      filter.catch(error, mockHost);\n\n      expect(mockResponse.status).toHaveBeenCalledWith(HttpStatus.BAD_REQUEST);\n      expect(mockResponse.json).toHaveBeenCalledWith(\n        expect.objectContaining({\n          statusCode: HttpStatus.BAD_REQUEST,\n          error: 'Invalid Transition Date',\n          details,\n        })\n      );\n    });\n\n    it('should handle EscrowReleaseError correctly', () => {\n      const message = 'Release failed';\n      const escrowId = 'escrow-123';\n      const error = new EscrowReleaseError(message, escrowId);\n\n      filter.catch(error, mockHost);\n\n      expect(mockResponse.status).toHaveBeenCalledWith(HttpStatus.INTERNAL_SERVER_ERROR);\n      expect(mockResponse.json).toHaveBeenCalledWith(\n        expect.objectContaining({\n          statusCode: HttpStatus.INTERNAL_SERVER_ERROR,\n          error: 'Escrow Release Failed',\n          escrowId,\n        })\n      );\n    });\n\n    it('should handle unexpected errors', () => {\n      const error = new Error('Unexpected error');\n\n      filter.catch(error, mockHost);\n\n      expect(mockResponse.status).toHaveBeenCalledWith(HttpStatus.INTERNAL_SERVER_ERROR);\n      expect(mockResponse.json).toHaveBeenCalledWith(\n        expect.objectContaining({\n          statusCode: HttpStatus.INTERNAL_SERVER_ERROR,\n          error: 'Internal Server Error',\n          message: 'An unexpected error occurred while processing the rent contract request',\n        })\n      );\n    });\n  });\n});"],"names":["describe","it","contractId","error","ContractNotFoundError","expect","name","toBe","getStatus","HttpStatus","NOT_FOUND","message","toContain","response","getResponse","statusCode","details","expiryDate","reason","InvalidTransitionDateError","BAD_REQUEST","toEqual","escrowId","amount","EscrowReleaseError","INTERNAL_SERVER_ERROR","filter","mockResponse","mockRequest","mockHost","beforeEach","module","Test","createTestingModule","providers","RentContractExceptionFilter","compile","get","status","jest","fn","mockReturnThis","json","url","method","switchToHttp","mockReturnValue","getRequest","catch","toHaveBeenCalledWith","objectContaining","timestamp","any","String","path","Error"],"mappings":";;;;yBAAoC;wBACT;2CACW;gDACK;wCACR;6CACS;AAE5CA,SAAS,4BAA4B;IACnCA,SAAS,yBAAyB;QAChCC,GAAG,uDAAuD;YACxD,MAAMC,aAAa;YACnB,MAAMC,QAAQ,IAAIC,gDAAqB,CAACF;YAExCG,OAAOF,MAAMG,IAAI,EAAEC,IAAI,CAAC;YACxBF,OAAOF,MAAMK,SAAS,IAAID,IAAI,CAACE,kBAAU,CAACC,SAAS;YACnDL,OAAOF,MAAMQ,OAAO,EAAEC,SAAS,CAACV;YAEhC,MAAMW,WAAWV,MAAMW,WAAW;YAClCT,OAAOQ,SAASX,UAAU,EAAEK,IAAI,CAACL;YACjCG,OAAOQ,SAASE,UAAU,EAAER,IAAI,CAACE,kBAAU,CAACC,SAAS;QACvD;IACF;IAEAV,SAAS,8BAA8B;QACrCC,GAAG,wDAAwD;YACzD,MAAMU,UAAU;YAChB,MAAMK,UAAU;gBAAEC,YAAY;gBAAcC,QAAQ;YAAY;YAChE,MAAMf,QAAQ,IAAIgB,0DAA0B,CAACR,SAASK;YAEtDX,OAAOF,MAAMG,IAAI,EAAEC,IAAI,CAAC;YACxBF,OAAOF,MAAMK,SAAS,IAAID,IAAI,CAACE,kBAAU,CAACW,WAAW;YACrDf,OAAOF,MAAMQ,OAAO,EAAEC,SAAS,CAACD;YAEhC,MAAME,WAAWV,MAAMW,WAAW;YAClCT,OAAOQ,SAASG,OAAO,EAAEK,OAAO,CAACL;YACjCX,OAAOQ,SAASE,UAAU,EAAER,IAAI,CAACE,kBAAU,CAACW,WAAW;QACzD;IACF;IAEApB,SAAS,sBAAsB;QAC7BC,GAAG,2CAA2C;YAC5C,MAAMU,UAAU;YAChB,MAAMW,WAAW;YACjB,MAAMN,UAAU;gBAAEO,QAAQ;gBAAML,QAAQ;YAAqB;YAC7D,MAAMf,QAAQ,IAAIqB,0CAAkB,CAACb,SAASW,UAAUN;YAExDX,OAAOF,MAAMG,IAAI,EAAEC,IAAI,CAAC;YACxBF,OAAOF,MAAMK,SAAS,IAAID,IAAI,CAACE,kBAAU,CAACgB,qBAAqB;YAC/DpB,OAAOF,MAAMQ,OAAO,EAAEC,SAAS,CAACD;YAEhC,MAAME,WAAWV,MAAMW,WAAW;YAClCT,OAAOQ,SAASS,QAAQ,EAAEf,IAAI,CAACe;YAC/BjB,OAAOQ,SAASG,OAAO,EAAEK,OAAO,CAACL;QACnC;IACF;IAEAhB,SAAS,+BAA+B;QACtC,IAAI0B;QACJ,IAAIC;QACJ,IAAIC;QACJ,IAAIC;QAEJC,WAAW;YACT,MAAMC,SAAwB,MAAMC,aAAI,CAACC,mBAAmB,CAAC;gBAC3DC,WAAW;oBAACC,wDAA2B;iBAAC;YAC1C,GAAGC,OAAO;YAEVV,SAASK,OAAOM,GAAG,CAA8BF,wDAA2B;YAE5ER,eAAe;gBACbW,QAAQC,KAAKC,EAAE,GAAGC,cAAc;gBAChCC,MAAMH,KAAKC,EAAE,GAAGC,cAAc;YAChC;YAEAb,cAAc;gBACZe,KAAK;gBACLC,QAAQ;YACV;YAEAf,WAAW;gBACTgB,cAAcN,KAAKC,EAAE,GAAGM,eAAe,CAAC;oBACtChC,aAAa,IAAMa;oBACnBoB,YAAY,IAAMnB;gBACpB;YACF;QACF;QAEA3B,GAAG,iDAAiD;YAClD,MAAMC,aAAa;YACnB,MAAMC,QAAQ,IAAIC,gDAAqB,CAACF;YAExCwB,OAAOsB,KAAK,CAAC7C,OAAO0B;YAEpBxB,OAAOsB,aAAaW,MAAM,EAAEW,oBAAoB,CAACxC,kBAAU,CAACC,SAAS;YACrEL,OAAOsB,aAAae,IAAI,EAAEO,oBAAoB,CAC5C5C,OAAO6C,gBAAgB,CAAC;gBACtBnC,YAAYN,kBAAU,CAACC,SAAS;gBAChCP,OAAO;gBACPD;gBACAiD,WAAW9C,OAAO+C,GAAG,CAACC;gBACtBC,MAAM;gBACNV,QAAQ;YACV;QAEJ;QAEA3C,GAAG,sDAAsD;YACvD,MAAMU,UAAU;YAChB,MAAMK,UAAU;gBAAEE,QAAQ;YAAO;YACjC,MAAMf,QAAQ,IAAIgB,0DAA0B,CAACR,SAASK;YAEtDU,OAAOsB,KAAK,CAAC7C,OAAO0B;YAEpBxB,OAAOsB,aAAaW,MAAM,EAAEW,oBAAoB,CAACxC,kBAAU,CAACW,WAAW;YACvEf,OAAOsB,aAAae,IAAI,EAAEO,oBAAoB,CAC5C5C,OAAO6C,gBAAgB,CAAC;gBACtBnC,YAAYN,kBAAU,CAACW,WAAW;gBAClCjB,OAAO;gBACPa;YACF;QAEJ;QAEAf,GAAG,8CAA8C;YAC/C,MAAMU,UAAU;YAChB,MAAMW,WAAW;YACjB,MAAMnB,QAAQ,IAAIqB,0CAAkB,CAACb,SAASW;YAE9CI,OAAOsB,KAAK,CAAC7C,OAAO0B;YAEpBxB,OAAOsB,aAAaW,MAAM,EAAEW,oBAAoB,CAACxC,kBAAU,CAACgB,qBAAqB;YACjFpB,OAAOsB,aAAae,IAAI,EAAEO,oBAAoB,CAC5C5C,OAAO6C,gBAAgB,CAAC;gBACtBnC,YAAYN,kBAAU,CAACgB,qBAAqB;gBAC5CtB,OAAO;gBACPmB;YACF;QAEJ;QAEArB,GAAG,mCAAmC;YACpC,MAAME,QAAQ,IAAIoD,MAAM;YAExB7B,OAAOsB,KAAK,CAAC7C,OAAO0B;YAEpBxB,OAAOsB,aAAaW,MAAM,EAAEW,oBAAoB,CAACxC,kBAAU,CAACgB,qBAAqB;YACjFpB,OAAOsB,aAAae,IAAI,EAAEO,oBAAoB,CAC5C5C,OAAO6C,gBAAgB,CAAC;gBACtBnC,YAAYN,kBAAU,CAACgB,qBAAqB;gBAC5CtB,OAAO;gBACPQ,SAAS;YACX;QAEJ;IACF;AACF"}