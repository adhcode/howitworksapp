{"version":3,"sources":["../../../src/tenant-rent-contracts/exceptions/rent-contract-exception.filter.ts"],"sourcesContent":["import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Logger,\n} from '@nestjs/common';\nimport { Response } from 'express';\nimport { ContractNotFoundError } from './contract-not-found.exception';\nimport { InvalidTransitionDateError } from './invalid-transition-date.exception';\nimport { EscrowReleaseError } from './escrow-release.exception';\n\n@Catch()\nexport class RentContractExceptionFilter implements ExceptionFilter {\n  private readonly logger = new Logger(RentContractExceptionFilter.name);\n\n  catch(exception: any, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const request = ctx.getRequest();\n\n    let status = HttpStatus.INTERNAL_SERVER_ERROR;\n    let errorResponse: any = {\n      statusCode: status,\n      timestamp: new Date().toISOString(),\n      path: request.url,\n      method: request.method,\n    };\n\n    // Handle specific rent contract exceptions\n    if (exception instanceof ContractNotFoundError) {\n      status = HttpStatus.NOT_FOUND;\n      errorResponse = {\n        ...errorResponse,\n        statusCode: status,\n        error: 'Contract Not Found',\n        message: exception.message,\n        contractId: exception.getResponse()['contractId'],\n      };\n    } else if (exception instanceof InvalidTransitionDateError) {\n      status = HttpStatus.BAD_REQUEST;\n      errorResponse = {\n        ...errorResponse,\n        statusCode: status,\n        error: 'Invalid Transition Date',\n        message: exception.message,\n        details: exception.getResponse()['details'],\n      };\n    } else if (exception instanceof EscrowReleaseError) {\n      status = HttpStatus.INTERNAL_SERVER_ERROR;\n      errorResponse = {\n        ...errorResponse,\n        statusCode: status,\n        error: 'Escrow Release Failed',\n        message: exception.message,\n        escrowId: exception.getResponse()['escrowId'],\n        details: exception.getResponse()['details'],\n      };\n    } else if (exception instanceof HttpException) {\n      // Handle other HTTP exceptions\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n      \n      errorResponse = {\n        ...errorResponse,\n        statusCode: status,\n        error: typeof exceptionResponse === 'string' ? exceptionResponse : exceptionResponse['error'],\n        message: typeof exceptionResponse === 'string' ? exceptionResponse : exceptionResponse['message'],\n      };\n    } else {\n      // Handle unexpected errors\n      errorResponse = {\n        ...errorResponse,\n        error: 'Internal Server Error',\n        message: 'An unexpected error occurred while processing the rent contract request',\n      };\n      \n      // Log the full error for debugging\n      this.logger.error(\n        `Unexpected error in rent contract operation: ${exception.message}`,\n        exception.stack,\n      );\n    }\n\n    // Log the error with context\n    this.logger.error(\n      `Rent Contract Error - ${request.method} ${request.url} - Status: ${status} - ${errorResponse.message}`,\n      {\n        exception: exception.name,\n        statusCode: status,\n        path: request.url,\n        method: request.method,\n        timestamp: errorResponse.timestamp,\n      },\n    );\n\n    response.status(status).json(errorResponse);\n  }\n}"],"names":["RentContractExceptionFilter","catch","exception","host","ctx","switchToHttp","response","getResponse","request","getRequest","status","HttpStatus","INTERNAL_SERVER_ERROR","errorResponse","statusCode","timestamp","Date","toISOString","path","url","method","ContractNotFoundError","NOT_FOUND","error","message","contractId","InvalidTransitionDateError","BAD_REQUEST","details","EscrowReleaseError","escrowId","HttpException","getStatus","exceptionResponse","logger","stack","name","json","Logger"],"mappings":";;;;+BAcaA;;;eAAAA;;;wBAPN;2CAE+B;gDACK;wCACR;;;;;;;AAG5B,IAAA,AAAMA,8BAAN,MAAMA;IAGXC,MAAMC,SAAc,EAAEC,IAAmB,EAAE;QACzC,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,WAAWF,IAAIG,WAAW;QAChC,MAAMC,UAAUJ,IAAIK,UAAU;QAE9B,IAAIC,SAASC,kBAAU,CAACC,qBAAqB;QAC7C,IAAIC,gBAAqB;YACvBC,YAAYJ;YACZK,WAAW,IAAIC,OAAOC,WAAW;YACjCC,MAAMV,QAAQW,GAAG;YACjBC,QAAQZ,QAAQY,MAAM;QACxB;QAEA,2CAA2C;QAC3C,IAAIlB,qBAAqBmB,gDAAqB,EAAE;YAC9CX,SAASC,kBAAU,CAACW,SAAS;YAC7BT,gBAAgB;gBACd,GAAGA,aAAa;gBAChBC,YAAYJ;gBACZa,OAAO;gBACPC,SAAStB,UAAUsB,OAAO;gBAC1BC,YAAYvB,UAAUK,WAAW,EAAE,CAAC,aAAa;YACnD;QACF,OAAO,IAAIL,qBAAqBwB,0DAA0B,EAAE;YAC1DhB,SAASC,kBAAU,CAACgB,WAAW;YAC/Bd,gBAAgB;gBACd,GAAGA,aAAa;gBAChBC,YAAYJ;gBACZa,OAAO;gBACPC,SAAStB,UAAUsB,OAAO;gBAC1BI,SAAS1B,UAAUK,WAAW,EAAE,CAAC,UAAU;YAC7C;QACF,OAAO,IAAIL,qBAAqB2B,0CAAkB,EAAE;YAClDnB,SAASC,kBAAU,CAACC,qBAAqB;YACzCC,gBAAgB;gBACd,GAAGA,aAAa;gBAChBC,YAAYJ;gBACZa,OAAO;gBACPC,SAAStB,UAAUsB,OAAO;gBAC1BM,UAAU5B,UAAUK,WAAW,EAAE,CAAC,WAAW;gBAC7CqB,SAAS1B,UAAUK,WAAW,EAAE,CAAC,UAAU;YAC7C;QACF,OAAO,IAAIL,qBAAqB6B,qBAAa,EAAE;YAC7C,+BAA+B;YAC/BrB,SAASR,UAAU8B,SAAS;YAC5B,MAAMC,oBAAoB/B,UAAUK,WAAW;YAE/CM,gBAAgB;gBACd,GAAGA,aAAa;gBAChBC,YAAYJ;gBACZa,OAAO,OAAOU,sBAAsB,WAAWA,oBAAoBA,iBAAiB,CAAC,QAAQ;gBAC7FT,SAAS,OAAOS,sBAAsB,WAAWA,oBAAoBA,iBAAiB,CAAC,UAAU;YACnG;QACF,OAAO;YACL,2BAA2B;YAC3BpB,gBAAgB;gBACd,GAAGA,aAAa;gBAChBU,OAAO;gBACPC,SAAS;YACX;YAEA,mCAAmC;YACnC,IAAI,CAACU,MAAM,CAACX,KAAK,CACf,CAAC,6CAA6C,EAAErB,UAAUsB,OAAO,EAAE,EACnEtB,UAAUiC,KAAK;QAEnB;QAEA,6BAA6B;QAC7B,IAAI,CAACD,MAAM,CAACX,KAAK,CACf,CAAC,sBAAsB,EAAEf,QAAQY,MAAM,CAAC,CAAC,EAAEZ,QAAQW,GAAG,CAAC,WAAW,EAAET,OAAO,GAAG,EAAEG,cAAcW,OAAO,EAAE,EACvG;YACEtB,WAAWA,UAAUkC,IAAI;YACzBtB,YAAYJ;YACZQ,MAAMV,QAAQW,GAAG;YACjBC,QAAQZ,QAAQY,MAAM;YACtBL,WAAWF,cAAcE,SAAS;QACpC;QAGFT,SAASI,MAAM,CAACA,QAAQ2B,IAAI,CAACxB;IAC/B;;aAnFiBqB,SAAS,IAAII,cAAM,CAACtC,4BAA4BoC,IAAI;;AAoFvE"}