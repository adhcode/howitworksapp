{"version":3,"sources":["../../src/tenant-rent-contracts/tenant-rent-contracts.controller.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { BadRequestException, NotFoundException } from '@nestjs/common';\nimport { TenantRentContractsController } from './tenant-rent-contracts.controller';\nimport { TenantPaymentService } from './tenant-payment.service';\nimport { LandlordPayoutService } from './landlord-payout.service';\nimport { SchedulerService } from './scheduler.service';\nimport { \n  CreateRentContractDto, \n  ProcessPaymentDto, \n  LandlordPayoutType,\n  ContractStatus \n} from './dto/tenant-rent-contract.dto';\n\ndescribe('TenantRentContractsController', () => {\n  let controller: TenantRentContractsController;\n  let tenantPaymentService: jest.Mocked<TenantPaymentService>;\n  let landlordPayoutService: jest.Mocked<LandlordPayoutService>;\n  let schedulerService: jest.Mocked<SchedulerService>;\n\n  const mockContract = {\n    id: 'contract-123',\n    tenantId: 'tenant-123',\n    landlordId: 'landlord-123',\n    propertyId: 'property-123',\n    unitId: 'unit-123',\n    monthlyAmount: '2500.00',\n    expiryDate: new Date('2025-12-31T23:59:59.000Z'),\n    landlordPayoutType: LandlordPayoutType.MONTHLY,\n    nextPaymentDue: new Date('2024-02-01T00:00:00.000Z'),\n    transitionStartDate: new Date('2024-01-01T00:00:00.000Z'),\n    status: 'active' as const,\n    isExistingTenant: false,\n    originalExpiryDate: null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockEscrowBalance = {\n    id: 'escrow-123',\n    landlordId: 'landlord-123',\n    contractId: 'contract-123',\n    totalEscrowed: '7500.00',\n    monthsAccumulated: 3,\n    expectedReleaseDate: new Date('2025-12-31T23:59:59.000Z'),\n    isReleased: false,\n    releasedAt: null,\n    releasedAmount: null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  beforeEach(async () => {\n    const mockTenantPaymentService = {\n      createRentContract: jest.fn(),\n      getContractById: jest.fn(),\n      getActiveContracts: jest.fn(),\n      getAllContracts: jest.fn(),\n      processMonthlyPayment: jest.fn(),\n      updateContractStatus: jest.fn(),\n      getContractsWithDuePayments: jest.fn(),\n      getExpiringContracts: jest.fn(),\n      getLandlordEscrowBalances: jest.fn(),\n      getTotalEscrowedAmount: jest.fn(),\n    };\n\n    const mockLandlordPayoutService = {\n      processImmediatePayout: jest.fn(),\n      addToEscrow: jest.fn(),\n      checkEscrowReleases: jest.fn(),\n      releaseEscrowBalance: jest.fn(),\n      getLandlordEscrowBalances: jest.fn(),\n      getTotalEscrowedAmount: jest.fn(),\n      forceReleaseEscrow: jest.fn(),\n    };\n\n    const mockSchedulerService = {\n      checkDuePayments: jest.fn(),\n      sendPaymentReminders: jest.fn(),\n      processEscrowReleases: jest.fn(),\n      updateOverduePaymentStatuses: jest.fn(),\n      cleanupNotifications: jest.fn(),\n      getPaymentDueSummary: jest.fn(),\n      getSchedulerHealth: jest.fn(),\n      triggerPaymentDueCheck: jest.fn(),\n      triggerPaymentReminders: jest.fn(),\n      triggerEscrowReleases: jest.fn(),\n      triggerOverdueUpdates: jest.fn(),\n      triggerNotificationCleanup: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [TenantRentContractsController],\n      providers: [\n        { provide: TenantPaymentService, useValue: mockTenantPaymentService },\n        { provide: LandlordPayoutService, useValue: mockLandlordPayoutService },\n        { provide: SchedulerService, useValue: mockSchedulerService },\n      ],\n    }).compile();\n\n    controller = module.get<TenantRentContractsController>(TenantRentContractsController);\n    tenantPaymentService = module.get(TenantPaymentService);\n    landlordPayoutService = module.get(LandlordPayoutService);\n    schedulerService = module.get(SchedulerService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(controller).toBeDefined();\n  });\n\n  describe('createContract', () => {\n    const createContractDto: CreateRentContractDto = {\n      tenantId: 'tenant-123',\n      landlordId: 'landlord-123',\n      propertyId: 'property-123',\n      unitId: 'unit-123',\n      monthlyAmount: 2500,\n      expiryDate: '2025-12-31T23:59:59.000Z',\n      landlordPayoutType: LandlordPayoutType.MONTHLY,\n      isExistingTenant: false,\n    };\n\n    it('should create a contract successfully', async () => {\n      tenantPaymentService.createRentContract.mockResolvedValue(mockContract);\n\n      const result = await controller.createContract(createContractDto);\n\n      expect(result).toEqual({\n        success: true,\n        data: mockContract,\n        message: 'Rent contract created successfully',\n      });\n      expect(tenantPaymentService.createRentContract).toHaveBeenCalledWith(createContractDto);\n    });\n\n    it('should handle contract creation errors', async () => {\n      tenantPaymentService.createRentContract.mockRejectedValue(\n        new BadRequestException('Tenant already has an active rent contract')\n      );\n\n      await expect(controller.createContract(createContractDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should validate required fields', async () => {\n      const invalidDto = { ...createContractDto };\n      delete (invalidDto as any).tenantId;\n\n      // This would be caught by class-validator in real scenario\n      await expect(controller.createContract(invalidDto as any)).rejects.toThrow();\n    });\n\n    it('should handle existing tenant contract creation', async () => {\n      const existingTenantDto: CreateRentContractDto = {\n        ...createContractDto,\n        isExistingTenant: true,\n        originalExpiryDate: '2025-06-30T23:59:59.000Z',\n      };\n\n      const existingTenantContract = {\n        ...mockContract,\n        isExistingTenant: true,\n        originalExpiryDate: new Date('2025-06-30T23:59:59.000Z'),\n      };\n\n      tenantPaymentService.createRentContract.mockResolvedValue(existingTenantContract);\n\n      const result = await controller.createContract(existingTenantDto);\n\n      expect(result.success).toBe(true);\n      expect(result.data.isExistingTenant).toBe(true);\n    });\n  });\n\n  describe('getContract', () => {\n    it('should get contract by ID successfully', async () => {\n      tenantPaymentService.getContractById.mockResolvedValue(mockContract);\n\n      const result = await controller.getContract('contract-123');\n\n      expect(result).toEqual({\n        success: true,\n        data: mockContract,\n      });\n      expect(tenantPaymentService.getContractById).toHaveBeenCalledWith('contract-123');\n    });\n\n    it('should handle contract not found', async () => {\n      tenantPaymentService.getContractById.mockRejectedValue(\n        new NotFoundException('Rent contract not found: contract-123')\n      );\n\n      await expect(controller.getContract('contract-123')).rejects.toThrow(\n        NotFoundException\n      );\n    });\n\n    it('should handle invalid contract ID format', async () => {\n      tenantPaymentService.getContractById.mockRejectedValue(\n        new BadRequestException('Invalid contract ID format')\n      );\n\n      await expect(controller.getContract('invalid-id')).rejects.toThrow(\n        BadRequestException\n      );\n    });\n  });\n\n  describe('getContracts', () => {\n    const mockContracts = [mockContract];\n\n    it('should get all active contracts', async () => {\n      tenantPaymentService.getActiveContracts.mockResolvedValue(mockContracts);\n\n      const result = await controller.getContracts();\n\n      expect(result).toEqual({\n        success: true,\n        data: mockContracts,\n        total: 1,\n      });\n      expect(tenantPaymentService.getActiveContracts).toHaveBeenCalledWith(undefined, undefined);\n    });\n\n    it('should filter contracts by tenant ID', async () => {\n      tenantPaymentService.getActiveContracts.mockResolvedValue(mockContracts);\n\n      const result = await controller.getContracts('tenant-123');\n\n      expect(result.success).toBe(true);\n      expect(tenantPaymentService.getActiveContracts).toHaveBeenCalledWith('tenant-123', undefined);\n    });\n\n    it('should filter contracts by landlord ID', async () => {\n      tenantPaymentService.getActiveContracts.mockResolvedValue(mockContracts);\n\n      const result = await controller.getContracts(undefined, 'landlord-123');\n\n      expect(result.success).toBe(true);\n      expect(tenantPaymentService.getActiveContracts).toHaveBeenCalledWith(undefined, 'landlord-123');\n    });\n\n    it('should handle empty results', async () => {\n      tenantPaymentService.getActiveContracts.mockResolvedValue([]);\n\n      const result = await controller.getContracts();\n\n      expect(result).toEqual({\n        success: true,\n        data: [],\n        total: 0,\n      });\n    });\n  });\n\n  describe('processPayment', () => {\n    const processPaymentDto: ProcessPaymentDto = {\n      amount: 2500,\n      paymentMethod: 'card',\n      reference: 'test-ref-123',\n    };\n\n    const mockPaymentResult = {\n      success: true,\n      payoutType: LandlordPayoutType.MONTHLY,\n      message: 'Payment credited immediately to landlord wallet',\n      nextPaymentDue: new Date('2024-03-01T00:00:00.000Z'),\n    };\n\n    it('should process payment successfully', async () => {\n      tenantPaymentService.processMonthlyPayment.mockResolvedValue(mockPaymentResult);\n\n      const result = await controller.processPayment('contract-123', processPaymentDto);\n\n      expect(result).toEqual({\n        success: true,\n        data: mockPaymentResult,\n        message: 'Payment processed successfully',\n      });\n      expect(tenantPaymentService.processMonthlyPayment).toHaveBeenCalledWith(\n        'contract-123',\n        2500,\n        'card',\n        'test-ref-123'\n      );\n    });\n\n    it('should handle payment processing errors', async () => {\n      tenantPaymentService.processMonthlyPayment.mockRejectedValue(\n        new BadRequestException('Payment amount does not match expected monthly amount')\n      );\n\n      await expect(controller.processPayment('contract-123', processPaymentDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should handle payment without optional fields', async () => {\n      const minimalPaymentDto = { amount: 2500 };\n      tenantPaymentService.processMonthlyPayment.mockResolvedValue(mockPaymentResult);\n\n      const result = await controller.processPayment('contract-123', minimalPaymentDto);\n\n      expect(result.success).toBe(true);\n      expect(tenantPaymentService.processMonthlyPayment).toHaveBeenCalledWith(\n        'contract-123',\n        2500,\n        undefined,\n        undefined\n      );\n    });\n\n    it('should validate payment amount', async () => {\n      const invalidPaymentDto = { amount: -100 };\n\n      await expect(controller.processPayment('contract-123', invalidPaymentDto)).rejects.toThrow();\n    });\n  });\n\n  describe('updateContractStatus', () => {\n    it('should update contract status successfully', async () => {\n      const updatedContract = { ...mockContract, status: 'terminated' as const };\n      tenantPaymentService.updateContractStatus.mockResolvedValue(updatedContract);\n\n      const result = await controller.updateContractStatus('contract-123', {\n        status: ContractStatus.TERMINATED,\n      });\n\n      expect(result).toEqual({\n        success: true,\n        data: updatedContract,\n        message: 'Contract status updated successfully',\n      });\n      expect(tenantPaymentService.updateContractStatus).toHaveBeenCalledWith(\n        'contract-123',\n        ContractStatus.TERMINATED\n      );\n    });\n\n    it('should handle invalid status updates', async () => {\n      tenantPaymentService.updateContractStatus.mockRejectedValue(\n        new BadRequestException('Invalid status transition')\n      );\n\n      await expect(\n        controller.updateContractStatus('contract-123', { status: ContractStatus.TERMINATED })\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('getLandlordEscrowBalances', () => {\n    const mockEscrowBalances = [mockEscrowBalance];\n\n    it('should get landlord escrow balances successfully', async () => {\n      landlordPayoutService.getLandlordEscrowBalances.mockResolvedValue(mockEscrowBalances);\n\n      const result = await controller.getLandlordEscrowBalances('landlord-123');\n\n      expect(result).toEqual({\n        success: true,\n        data: mockEscrowBalances,\n        total: 1,\n      });\n      expect(landlordPayoutService.getLandlordEscrowBalances).toHaveBeenCalledWith('landlord-123');\n    });\n\n    it('should handle landlord with no escrow balances', async () => {\n      landlordPayoutService.getLandlordEscrowBalances.mockResolvedValue([]);\n\n      const result = await controller.getLandlordEscrowBalances('landlord-123');\n\n      expect(result).toEqual({\n        success: true,\n        data: [],\n        total: 0,\n      });\n    });\n  });\n\n  describe('getTotalEscrowedAmount', () => {\n    it('should get total escrowed amount successfully', async () => {\n      landlordPayoutService.getTotalEscrowedAmount.mockResolvedValue(15000);\n\n      const result = await controller.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toEqual({\n        success: true,\n        data: { totalAmount: 15000 },\n      });\n      expect(landlordPayoutService.getTotalEscrowedAmount).toHaveBeenCalledWith('landlord-123');\n    });\n\n    it('should handle landlord with zero escrow', async () => {\n      landlordPayoutService.getTotalEscrowedAmount.mockResolvedValue(0);\n\n      const result = await controller.getTotalEscrowedAmount('landlord-123');\n\n      expect(result.data.totalAmount).toBe(0);\n    });\n  });\n\n  describe('forceReleaseEscrow', () => {\n    const mockReleaseResult = {\n      success: true,\n      releasedAmount: 7500,\n      escrowId: 'escrow-123',\n      landlordId: 'landlord-123',\n    };\n\n    it('should force release escrow successfully', async () => {\n      landlordPayoutService.forceReleaseEscrow.mockResolvedValue(mockReleaseResult);\n\n      const result = await controller.forceReleaseEscrow('contract-123', {\n        reason: 'Early termination',\n      });\n\n      expect(result).toEqual({\n        success: true,\n        data: mockReleaseResult,\n        message: 'Escrow released successfully',\n      });\n      expect(landlordPayoutService.forceReleaseEscrow).toHaveBeenCalledWith(\n        'contract-123',\n        'Early termination'\n      );\n    });\n\n    it('should handle force release errors', async () => {\n      landlordPayoutService.forceReleaseEscrow.mockRejectedValue(\n        new NotFoundException('No active escrow found for contract')\n      );\n\n      await expect(\n        controller.forceReleaseEscrow('contract-123', { reason: 'Test' })\n      ).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  describe('scheduler endpoints', () => {\n    describe('triggerPaymentCheck', () => {\n      it('should trigger payment check successfully', async () => {\n        schedulerService.triggerPaymentDueCheck.mockResolvedValue();\n\n        const result = await controller.triggerPaymentCheck();\n\n        expect(result).toEqual({\n          success: true,\n          message: 'Payment due check triggered successfully',\n        });\n        expect(schedulerService.triggerPaymentDueCheck).toHaveBeenCalled();\n      });\n\n      it('should handle scheduler errors', async () => {\n        schedulerService.triggerPaymentDueCheck.mockRejectedValue(\n          new Error('Scheduler service unavailable')\n        );\n\n        await expect(controller.triggerPaymentCheck()).rejects.toThrow(\n          'Scheduler service unavailable'\n        );\n      });\n    });\n\n    describe('triggerPaymentReminders', () => {\n      it('should trigger payment reminders successfully', async () => {\n        schedulerService.triggerPaymentReminders.mockResolvedValue();\n\n        const result = await controller.triggerPaymentReminders();\n\n        expect(result).toEqual({\n          success: true,\n          message: 'Payment reminders triggered successfully',\n        });\n        expect(schedulerService.triggerPaymentReminders).toHaveBeenCalled();\n      });\n    });\n\n    describe('triggerEscrowReleases', () => {\n      it('should trigger escrow releases successfully', async () => {\n        schedulerService.triggerEscrowReleases.mockResolvedValue();\n\n        const result = await controller.triggerEscrowReleases();\n\n        expect(result).toEqual({\n          success: true,\n          message: 'Escrow releases triggered successfully',\n        });\n        expect(schedulerService.triggerEscrowReleases).toHaveBeenCalled();\n      });\n    });\n\n    describe('getPaymentDueSummary', () => {\n      const mockSummary = {\n        totalDue: 5000,\n        totalOverdue: 2500,\n        contractsWithDuePayments: 2,\n        contractsWithOverduePayments: 1,\n      };\n\n      it('should get payment due summary successfully', async () => {\n        schedulerService.getPaymentDueSummary.mockResolvedValue(mockSummary);\n\n        const result = await controller.getPaymentDueSummary();\n\n        expect(result).toEqual({\n          success: true,\n          data: mockSummary,\n        });\n        expect(schedulerService.getPaymentDueSummary).toHaveBeenCalled();\n      });\n    });\n\n    describe('getSchedulerHealth', () => {\n      const mockHealth = {\n        status: 'healthy' as const,\n        lastOperations: {},\n        metrics: {\n          totalContracts: 10,\n          activeContracts: 8,\n          overdueContracts: 2,\n          pendingNotifications: 5,\n        },\n      };\n\n      it('should get scheduler health successfully', async () => {\n        schedulerService.getSchedulerHealth.mockResolvedValue(mockHealth);\n\n        const result = await controller.getSchedulerHealth();\n\n        expect(result).toEqual({\n          success: true,\n          data: mockHealth,\n        });\n        expect(schedulerService.getSchedulerHealth).toHaveBeenCalled();\n      });\n    });\n  });\n\n  describe('error handling', () => {\n    it('should handle service unavailable errors', async () => {\n      tenantPaymentService.getContractById.mockRejectedValue(\n        new Error('Service temporarily unavailable')\n      );\n\n      await expect(controller.getContract('contract-123')).rejects.toThrow(\n        'Service temporarily unavailable'\n      );\n    });\n\n    it('should handle validation errors', async () => {\n      const invalidDto = { amount: 'invalid' } as any;\n\n      // This would be caught by validation pipes in real scenario\n      await expect(controller.processPayment('contract-123', invalidDto)).rejects.toThrow();\n    });\n\n    it('should handle database connection errors', async () => {\n      tenantPaymentService.getActiveContracts.mockRejectedValue(\n        new Error('Database connection failed')\n      );\n\n      await expect(controller.getContracts()).rejects.toThrow('Database connection failed');\n    });\n  });\n\n  describe('performance and edge cases', () => {\n    it('should handle large result sets', async () => {\n      const largeContractList = Array.from({ length: 1000 }, (_, i) => ({\n        ...mockContract,\n        id: `contract-${i}`,\n      }));\n\n      tenantPaymentService.getActiveContracts.mockResolvedValue(largeContractList);\n\n      const result = await controller.getContracts();\n\n      expect(result.success).toBe(true);\n      expect(result.data).toHaveLength(1000);\n      expect(result.total).toBe(1000);\n    });\n\n    it('should handle concurrent requests', async () => {\n      tenantPaymentService.getContractById.mockResolvedValue(mockContract);\n\n      const promises = Array.from({ length: 10 }, () =>\n        controller.getContract('contract-123')\n      );\n\n      const results = await Promise.all(promises);\n\n      expect(results).toHaveLength(10);\n      results.forEach(result => {\n        expect(result.success).toBe(true);\n        expect(result.data).toEqual(mockContract);\n      });\n    });\n\n    it('should handle null and undefined values gracefully', async () => {\n      tenantPaymentService.getActiveContracts.mockResolvedValue([]);\n\n      const result = await controller.getContracts(null as any, undefined);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual([]);\n    });\n\n    it('should handle special characters in IDs', async () => {\n      const specialId = 'contract-123-äöü-测试';\n      tenantPaymentService.getContractById.mockResolvedValue({\n        ...mockContract,\n        id: specialId,\n      });\n\n      const result = await controller.getContract(specialId);\n\n      expect(result.success).toBe(true);\n      expect(result.data.id).toBe(specialId);\n    });\n  });\n});"],"names":["describe","controller","tenantPaymentService","landlordPayoutService","schedulerService","mockContract","id","tenantId","landlordId","propertyId","unitId","monthlyAmount","expiryDate","Date","landlordPayoutType","LandlordPayoutType","MONTHLY","nextPaymentDue","transitionStartDate","status","isExistingTenant","originalExpiryDate","createdAt","updatedAt","mockEscrowBalance","contractId","totalEscrowed","monthsAccumulated","expectedReleaseDate","isReleased","releasedAt","releasedAmount","beforeEach","mockTenantPaymentService","createRentContract","jest","fn","getContractById","getActiveContracts","getAllContracts","processMonthlyPayment","updateContractStatus","getContractsWithDuePayments","getExpiringContracts","getLandlordEscrowBalances","getTotalEscrowedAmount","mockLandlordPayoutService","processImmediatePayout","addToEscrow","checkEscrowReleases","releaseEscrowBalance","forceReleaseEscrow","mockSchedulerService","checkDuePayments","sendPaymentReminders","processEscrowReleases","updateOverduePaymentStatuses","cleanupNotifications","getPaymentDueSummary","getSchedulerHealth","triggerPaymentDueCheck","triggerPaymentReminders","triggerEscrowReleases","triggerOverdueUpdates","triggerNotificationCleanup","module","Test","createTestingModule","controllers","TenantRentContractsController","providers","provide","TenantPaymentService","useValue","LandlordPayoutService","SchedulerService","compile","get","afterEach","clearAllMocks","it","expect","toBeDefined","createContractDto","mockResolvedValue","result","createContract","toEqual","success","data","message","toHaveBeenCalledWith","mockRejectedValue","BadRequestException","rejects","toThrow","invalidDto","existingTenantDto","existingTenantContract","toBe","getContract","NotFoundException","mockContracts","getContracts","total","undefined","processPaymentDto","amount","paymentMethod","reference","mockPaymentResult","payoutType","processPayment","minimalPaymentDto","invalidPaymentDto","updatedContract","ContractStatus","TERMINATED","mockEscrowBalances","totalAmount","mockReleaseResult","escrowId","reason","triggerPaymentCheck","toHaveBeenCalled","Error","mockSummary","totalDue","totalOverdue","contractsWithDuePayments","contractsWithOverduePayments","mockHealth","lastOperations","metrics","totalContracts","activeContracts","overdueContracts","pendingNotifications","largeContractList","Array","from","length","_","i","toHaveLength","promises","results","Promise","all","forEach","specialId"],"mappings":"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"}