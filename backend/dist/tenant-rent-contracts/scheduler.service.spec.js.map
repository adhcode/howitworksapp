{"version":3,"sources":["../../src/tenant-rent-contracts/scheduler.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { SchedulerService } from './scheduler.service';\nimport { TenantPaymentService } from './tenant-payment.service';\nimport { LandlordPayoutService } from './landlord-payout.service';\nimport { EmailService } from '../email/email.service';\nimport { DATABASE_CONNECTION } from '../database/database.module';\nimport { Logger } from '@nestjs/common';\n\ndescribe('SchedulerService', () => {\n  let service: SchedulerService;\n  let tenantPaymentService: jest.Mocked<TenantPaymentService>;\n  let landlordPayoutService: jest.Mocked<LandlordPayoutService>;\n  let emailService: jest.Mocked<EmailService>;\n  let mockDb: any;\n  let loggerSpy: jest.SpyInstance;\n\n  beforeEach(async () => {\n    // Create mock services\n    const mockTenantPaymentService = {\n      getContractsWithDuePayments: jest.fn(),\n    };\n\n    const mockLandlordPayoutService = {\n      checkEscrowReleases: jest.fn(),\n    };\n\n    const mockEmailService = {\n      sendPaymentReminder: jest.fn(),\n    };\n\n    // Create mock database\n    mockDb = {\n      select: jest.fn().mockReturnThis(),\n      from: jest.fn().mockReturnThis(),\n      where: jest.fn().mockReturnThis(),\n      delete: jest.fn().mockReturnThis(),\n      update: jest.fn().mockReturnThis(),\n      set: jest.fn().mockReturnThis(),\n      transaction: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        SchedulerService,\n        { provide: TenantPaymentService, useValue: mockTenantPaymentService },\n        { provide: LandlordPayoutService, useValue: mockLandlordPayoutService },\n        { provide: EmailService, useValue: mockEmailService },\n        { provide: DATABASE_CONNECTION, useValue: mockDb },\n      ],\n    }).compile();\n\n    service = module.get<SchedulerService>(SchedulerService);\n    tenantPaymentService = module.get(TenantPaymentService);\n    landlordPayoutService = module.get(LandlordPayoutService);\n    emailService = module.get(EmailService);\n    \n    // Mock the logger to avoid console output during tests\n    loggerSpy = jest.spyOn(Logger.prototype, 'log').mockImplementation();\n    jest.spyOn(Logger.prototype, 'error').mockImplementation();\n    jest.spyOn(Logger.prototype, 'warn').mockImplementation();\n    jest.spyOn(Logger.prototype, 'debug').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('checkDuePayments', () => {\n    it('should log start and completion messages', async () => {\n      await service.checkDuePayments();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Starting daily payment due check...');\n      expect(loggerSpy).toHaveBeenCalledWith('Daily payment due check completed successfully');\n    });\n\n    it('should handle errors gracefully', async () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      \n      // Mock an error by overriding the method temporarily\n      const originalMethod = service.checkDuePayments;\n      service.checkDuePayments = jest.fn().mockRejectedValue(new Error('Test error'));\n\n      await service.checkDuePayments();\n\n      expect(errorSpy).toHaveBeenCalledWith('Error during daily payment due check:', expect.any(Error));\n      \n      // Restore original method\n      service.checkDuePayments = originalMethod;\n    });\n  });\n\n  describe('sendPaymentReminders', () => {\n    it('should log start and completion messages', async () => {\n      await service.sendPaymentReminders();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Starting payment reminder notifications...');\n      expect(loggerSpy).toHaveBeenCalledWith('Payment reminder notifications completed successfully');\n    });\n\n    it('should handle errors gracefully', async () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      \n      // Mock an error by overriding the method temporarily\n      const originalMethod = service.sendPaymentReminders;\n      service.sendPaymentReminders = jest.fn().mockRejectedValue(new Error('Test error'));\n\n      await service.sendPaymentReminders();\n\n      expect(errorSpy).toHaveBeenCalledWith('Error during payment reminder notifications:', expect.any(Error));\n      \n      // Restore original method\n      service.sendPaymentReminders = originalMethod;\n    });\n  });\n\n  describe('triggerPaymentDueCheck', () => {\n    it('should call checkDuePayments method', async () => {\n      const checkDuePaymentsSpy = jest.spyOn(service, 'checkDuePayments').mockResolvedValue();\n\n      await service.triggerPaymentDueCheck();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Manual trigger: checking due payments...');\n      expect(checkDuePaymentsSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('triggerPaymentReminders', () => {\n    it('should call sendPaymentReminders method', async () => {\n      const sendPaymentRemindersSpy = jest.spyOn(service, 'sendPaymentReminders').mockResolvedValue();\n\n      await service.triggerPaymentReminders();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Manual trigger: sending payment reminders...');\n      expect(sendPaymentRemindersSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('processEscrowReleases', () => {\n    it('should process escrow releases successfully', async () => {\n      const mockResults = [\n        { success: true, releasedAmount: 12000, escrowId: 'escrow-1', landlordId: 'landlord-1' },\n        { success: true, releasedAmount: 15000, escrowId: 'escrow-2', landlordId: 'landlord-2' },\n      ];\n\n      landlordPayoutService.checkEscrowReleases.mockResolvedValue(mockResults);\n\n      await service.processEscrowReleases();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Starting daily escrow release processing...');\n      expect(landlordPayoutService.checkEscrowReleases).toHaveBeenCalled();\n      expect(loggerSpy).toHaveBeenCalledWith('Successfully released escrow: 12000 to landlord landlord-1');\n      expect(loggerSpy).toHaveBeenCalledWith('Successfully released escrow: 15000 to landlord landlord-2');\n    });\n\n    it('should handle escrow release errors gracefully', async () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      landlordPayoutService.checkEscrowReleases.mockRejectedValue(new Error('Database error'));\n\n      await service.processEscrowReleases();\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        'Critical error during escrow release processing: Database error',\n        expect.any(String)\n      );\n    });\n\n    it('should handle mixed success and failure results', async () => {\n      const mockResults = [\n        { success: true, releasedAmount: 12000, escrowId: 'escrow-1', landlordId: 'landlord-1' },\n        { success: false, escrowId: 'escrow-2', landlordId: 'landlord-2' },\n      ];\n\n      landlordPayoutService.checkEscrowReleases.mockResolvedValue(mockResults);\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n\n      await service.processEscrowReleases();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Successfully released escrow: 12000 to landlord landlord-1');\n      expect(errorSpy).toHaveBeenCalledWith('Failed to release escrow escrow-2');\n    });\n  });\n\n  describe('updateOverduePaymentStatuses', () => {\n    it('should update overdue payment statuses successfully', async () => {\n      const mockContracts = [\n        {\n          id: 'contract-1',\n          nextPaymentDue: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5 days ago\n          status: 'active',\n        },\n        {\n          id: 'contract-2',\n          nextPaymentDue: new Date(Date.now() - 35 * 24 * 60 * 60 * 1000), // 35 days ago\n          status: 'active',\n        },\n      ];\n\n      mockDb.select.mockReturnValue(mockContracts);\n\n      await service.updateOverduePaymentStatuses();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Starting overdue payment status updates...');\n      expect(loggerSpy).toHaveBeenCalledWith('Found 2 contracts with overdue payments');\n    });\n\n    it('should handle database errors gracefully', async () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      mockDb.select.mockRejectedValue(new Error('Database connection failed'));\n\n      await service.updateOverduePaymentStatuses();\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        'Critical error during overdue status updates: Database connection failed',\n        expect.any(String)\n      );\n    });\n\n    it('should identify critically overdue contracts', async () => {\n      const mockContracts = [\n        {\n          id: 'contract-1',\n          nextPaymentDue: new Date(Date.now() - 35 * 24 * 60 * 60 * 1000), // 35 days ago\n          status: 'active',\n        },\n      ];\n\n      mockDb.select.mockReturnValue(mockContracts);\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n\n      await service.updateOverduePaymentStatuses();\n\n      expect(errorSpy).toHaveBeenCalledWith('Contract contract-1 is critically overdue (35 days)');\n    });\n  });\n\n  describe('cleanupNotifications', () => {\n    it('should clean up old notifications successfully', async () => {\n      mockDb.delete.mockResolvedValue({ rowCount: 5 });\n      mockDb.update.mockResolvedValue({ rowCount: 2 });\n\n      await service.cleanupNotifications();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Starting notification cleanup...');\n      expect(mockDb.delete).toHaveBeenCalledTimes(2); // sent and failed notifications\n      expect(mockDb.update).toHaveBeenCalledTimes(1); // stale notifications\n    });\n\n    it('should handle cleanup errors gracefully', async () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      mockDb.delete.mockRejectedValue(new Error('Delete operation failed'));\n\n      await service.cleanupNotifications();\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        'Critical error during notification cleanup: Delete operation failed',\n        expect.any(String)\n      );\n    });\n  });\n\n  describe('executeWithRetry', () => {\n    it('should succeed on first attempt', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n\n      const result = await (service as any).executeWithRetry(mockOperation, 'test operation');\n\n      expect(result).toBe('success');\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n\n    it('should retry on failure and eventually succeed', async () => {\n      const mockOperation = jest.fn()\n        .mockRejectedValueOnce(new Error('First failure'))\n        .mockRejectedValueOnce(new Error('Second failure'))\n        .mockResolvedValue('success');\n\n      const result = await (service as any).executeWithRetry(mockOperation, 'test operation');\n\n      expect(result).toBe('success');\n      expect(mockOperation).toHaveBeenCalledTimes(3);\n    });\n\n    it('should fail after max retries', async () => {\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Persistent failure'));\n\n      await expect(\n        (service as any).executeWithRetry(mockOperation, 'test operation', 2)\n      ).rejects.toThrow('Persistent failure');\n\n      expect(mockOperation).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('triggerEscrowReleases', () => {\n    it('should call processEscrowReleases method', async () => {\n      const processEscrowReleasesSpy = jest.spyOn(service, 'processEscrowReleases').mockResolvedValue();\n\n      await service.triggerEscrowReleases();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Manual trigger: processing escrow releases...');\n      expect(processEscrowReleasesSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('triggerOverdueUpdates', () => {\n    it('should call updateOverduePaymentStatuses method', async () => {\n      const updateOverduePaymentStatusesSpy = jest.spyOn(service, 'updateOverduePaymentStatuses').mockResolvedValue();\n\n      await service.triggerOverdueUpdates();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Manual trigger: updating overdue payment statuses...');\n      expect(updateOverduePaymentStatusesSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('triggerNotificationCleanup', () => {\n    it('should call cleanupNotifications method', async () => {\n      const cleanupNotificationsSpy = jest.spyOn(service, 'cleanupNotifications').mockResolvedValue();\n\n      await service.triggerNotificationCleanup();\n\n      expect(loggerSpy).toHaveBeenCalledWith('Manual trigger: cleaning up notifications...');\n      expect(cleanupNotificationsSpy).toHaveBeenCalled();\n    });\n  });\n\n  describe('getSchedulerHealth', () => {\n    it('should return healthy status with metrics', async () => {\n      mockDb.select.mockReturnValue([\n        { total: '10', active: '8', overdue: '2', pending: '5' }\n      ]);\n\n      const health = await service.getSchedulerHealth();\n\n      expect(health.status).toBe('healthy');\n      expect(health.metrics.totalContracts).toBe(10);\n      expect(health.metrics.activeContracts).toBe(8);\n      expect(health.metrics.overdueContracts).toBe(2);\n      expect(health.metrics.pendingNotifications).toBe(5);\n    });\n\n    it('should return unhealthy status on database error', async () => {\n      mockDb.select.mockRejectedValue(new Error('Database error'));\n\n      const health = await service.getSchedulerHealth();\n\n      expect(health.status).toBe('unhealthy');\n      expect(health.metrics.totalContracts).toBe(0);\n    });\n  });\n\n  describe('logOperationMetrics', () => {\n    it('should log successful operations', () => {\n      const metrics = {\n        processed: 5,\n        errors: 0,\n        duration: 1000,\n        success: true,\n      };\n\n      (service as any).logOperationMetrics('test_operation', metrics);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        '[METRICS] test_operation: {\"processed\":5,\"errors\":0,\"duration\":1000,\"success\":true}'\n      );\n    });\n\n    it('should log failed operations with error level', () => {\n      const errorSpy = jest.spyOn(Logger.prototype, 'error');\n      const metrics = {\n        processed: 3,\n        errors: 2,\n        duration: 2000,\n        success: false,\n        criticalError: 'Database timeout',\n      };\n\n      (service as any).logOperationMetrics('test_operation', metrics);\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        '[METRICS] test_operation: {\"processed\":3,\"errors\":2,\"duration\":2000,\"success\":false,\"criticalError\":\"Database timeout\"}'\n      );\n    });\n  });\n});"],"names":["describe","service","tenantPaymentService","landlordPayoutService","emailService","mockDb","loggerSpy","beforeEach","mockTenantPaymentService","getContractsWithDuePayments","jest","fn","mockLandlordPayoutService","checkEscrowReleases","mockEmailService","sendPaymentReminder","select","mockReturnThis","from","where","delete","update","set","transaction","module","Test","createTestingModule","providers","SchedulerService","provide","TenantPaymentService","useValue","LandlordPayoutService","EmailService","DATABASE_CONNECTION","compile","get","spyOn","Logger","prototype","mockImplementation","afterEach","clearAllMocks","it","expect","toBeDefined","checkDuePayments","toHaveBeenCalledWith","errorSpy","originalMethod","mockRejectedValue","Error","any","sendPaymentReminders","checkDuePaymentsSpy","mockResolvedValue","triggerPaymentDueCheck","toHaveBeenCalled","sendPaymentRemindersSpy","triggerPaymentReminders","mockResults","success","releasedAmount","escrowId","landlordId","processEscrowReleases","String","mockContracts","id","nextPaymentDue","Date","now","status","mockReturnValue","updateOverduePaymentStatuses","rowCount","cleanupNotifications","toHaveBeenCalledTimes","mockOperation","result","executeWithRetry","toBe","mockRejectedValueOnce","rejects","toThrow","processEscrowReleasesSpy","triggerEscrowReleases","updateOverduePaymentStatusesSpy","triggerOverdueUpdates","cleanupNotificationsSpy","triggerNotificationCleanup","total","active","overdue","pending","health","getSchedulerHealth","metrics","totalContracts","activeContracts","overdueContracts","pendingNotifications","processed","errors","duration","logOperationMetrics","criticalError"],"mappings":"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"}