{"version":3,"sources":["../../src/tenant-rent-contracts/tenant-rent-contracts.controller.ts"],"sourcesContent":["import { \n  Controller, \n  Get, \n  Post, \n  Param, \n  Body, \n  Query,\n  UseGuards, \n  Request,\n  HttpStatus,\n  HttpException,\n  ParseUUIDPipe\n} from '@nestjs/common';\nimport { \n  ApiTags, \n  ApiOperation, \n  ApiResponse, \n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery\n} from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { UserRole } from '../auth/dto/auth.dto';\nimport { TenantPaymentService } from './tenant-payment.service';\nimport { LandlordPayoutService } from './landlord-payout.service';\nimport {\n  CreateRentContractDto,\n  ProcessPaymentDto,\n  ContractQueryDto,\n  EscrowBalanceQueryDto,\n  RentContractResponseDto,\n  EscrowBalanceResponseDto,\n  PaymentResultDto,\n  TransitionDateCalculationDto,\n  TransitionDateResponseDto\n} from './dto/tenant-rent-contract.dto';\n\n@ApiTags('tenant-rent-contracts')\n@Controller('rent-contracts')\n@UseGuards(JwtAuthGuard, RolesGuard)\n@ApiBearerAuth()\nexport class TenantRentContractsController {\n  constructor(\n    private readonly tenantPaymentService: TenantPaymentService,\n    private readonly landlordPayoutService: LandlordPayoutService,\n  ) {}\n\n  @Post()\n  @Roles(UserRole.LANDLORD, UserRole.ADMIN)\n  @ApiOperation({ \n    summary: 'Create a new rent contract',\n    description: 'Creates a new tenant rent contract with specified terms and payout preferences'\n  })\n  @ApiResponse({ \n    status: 201, \n    description: 'Contract created successfully',\n    type: RentContractResponseDto\n  })\n  @ApiResponse({ status: 400, description: 'Invalid contract data' })\n  @ApiResponse({ status: 403, description: 'Insufficient permissions' })\n  async createRentContract(\n    @Body() createContractDto: CreateRentContractDto,\n    @Request() req: any\n  ) {\n    try {\n      // Verify the landlord is creating a contract for themselves (unless admin)\n      if (req.user.role !== UserRole.ADMIN && req.user.id !== createContractDto.landlordId) {\n        throw new HttpException(\n          'You can only create contracts for yourself',\n          HttpStatus.FORBIDDEN\n        );\n      }\n\n      const result = await this.tenantPaymentService.createRentContract(createContractDto);\n\n      return {\n        success: true,\n        message: result.arrears \n          ? `Rent contract created. ${result.arrears.message}`\n          : 'Rent contract created successfully',\n        data: result,\n      };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        `Failed to create rent contract: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n\n  @Get(':id')\n  @ApiOperation({ \n    summary: 'Get rent contract by ID',\n    description: 'Retrieves a specific rent contract by its ID with arrears info if applicable'\n  })\n  @ApiParam({ name: 'id', description: 'Contract ID', type: 'string' })\n  @ApiResponse({ \n    status: 200, \n    description: 'Contract retrieved successfully',\n    type: RentContractResponseDto\n  })\n  @ApiResponse({ status: 404, description: 'Contract not found' })\n  @ApiResponse({ status: 403, description: 'Access denied to this contract' })\n  async getRentContract(\n    @Param('id', ParseUUIDPipe) contractId: string,\n    @Request() req: any\n  ) {\n    try {\n      const contract = await this.tenantPaymentService.getContractById(contractId);\n\n      // Check if user has access to this contract\n      const hasAccess = req.user.role === UserRole.ADMIN ||\n                       req.user.id === contract.tenantId ||\n                       req.user.id === contract.landlordId;\n\n      if (!hasAccess) {\n        throw new HttpException(\n          'You do not have access to this contract',\n          HttpStatus.FORBIDDEN\n        );\n      }\n\n      // Calculate arrears if existing tenant\n      let arrearsInfo: {\n        monthsOverdue: number;\n        totalArrears: number;\n        message: string;\n      } | undefined = undefined;\n      if (contract.isExistingTenant) {\n        const arrears = this.tenantPaymentService.calculateArrears(\n          contract.transitionStartDate,\n          parseFloat(contract.monthlyAmount)\n        );\n        \n        if (arrears.monthsOverdue > 0) {\n          arrearsInfo = {\n            monthsOverdue: arrears.monthsOverdue,\n            totalArrears: arrears.totalArrears,\n            message: `You owe ${arrears.monthsOverdue} month${arrears.monthsOverdue > 1 ? 's' : ''} rent (â‚¦${arrears.totalArrears.toLocaleString()}). Please pay arrears to continue.`\n          };\n        }\n      }\n\n      return {\n        success: true,\n        data: {\n          contract,\n          arrears: arrearsInfo\n        },\n      };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        `Failed to retrieve contract: ${error.message}`,\n        HttpStatus.NOT_FOUND\n      );\n    }\n  }\n\n  @Get()\n  @ApiOperation({ \n    summary: 'Get rent contracts with filters',\n    description: 'Retrieves rent contracts based on query parameters'\n  })\n  @ApiQuery({ name: 'tenantId', required: false, description: 'Filter by tenant ID' })\n  @ApiQuery({ name: 'landlordId', required: false, description: 'Filter by landlord ID' })\n  @ApiQuery({ name: 'propertyId', required: false, description: 'Filter by property ID' })\n  @ApiQuery({ name: 'status', required: false, description: 'Filter by contract status' })\n  @ApiResponse({ \n    status: 200, \n    description: 'Contracts retrieved successfully',\n    type: [RentContractResponseDto]\n  })\n  async getRentContracts(\n    @Query() queryDto: ContractQueryDto,\n    @Request() req: any\n  ) {\n    try {\n      // Apply user-based filtering for non-admin users\n      if (req.user.role !== UserRole.ADMIN) {\n        if (req.user.role === UserRole.LANDLORD) {\n          queryDto.landlordId = req.user.id;\n        } else if (req.user.role === UserRole.TENANT) {\n          queryDto.tenantId = req.user.id;\n        }\n      }\n\n      const contracts = await this.tenantPaymentService.getActiveContracts(\n        queryDto.tenantId,\n        queryDto.landlordId\n      );\n\n      return {\n        success: true,\n        data: contracts,\n      };\n    } catch (error) {\n      throw new HttpException(\n        `Failed to retrieve contracts: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n\n  @Post(':id/payments')\n  @Roles(UserRole.TENANT, UserRole.ADMIN)\n  @ApiOperation({ \n    summary: 'Process a rent payment',\n    description: 'Processes a monthly rent payment for the specified contract'\n  })\n  @ApiParam({ name: 'id', description: 'Contract ID', type: 'string' })\n  @ApiResponse({ \n    status: 200, \n    description: 'Payment processed successfully',\n    type: PaymentResultDto\n  })\n  @ApiResponse({ status: 400, description: 'Invalid payment data' })\n  @ApiResponse({ status: 403, description: 'Not authorized to make payment for this contract' })\n  @ApiResponse({ status: 404, description: 'Contract not found' })\n  async processPayment(\n    @Param('id', ParseUUIDPipe) contractId: string,\n    @Body() processPaymentDto: ProcessPaymentDto,\n    @Request() req: any\n  ) {\n    try {\n      // Verify the contract exists and user has access\n      const contract = await this.tenantPaymentService.getContractById(contractId);\n\n      // Check if user is authorized to make payment (tenant or admin)\n      const canMakePayment = req.user.role === UserRole.ADMIN ||\n                            req.user.id === contract.tenantId;\n\n      if (!canMakePayment) {\n        throw new HttpException(\n          'You are not authorized to make payments for this contract',\n          HttpStatus.FORBIDDEN\n        );\n      }\n\n      // Ensure the contractId in the DTO matches the URL parameter\n      processPaymentDto.contractId = contractId;\n\n      const result = await this.tenantPaymentService.processMonthlyPayment(\n        contractId,\n        processPaymentDto.amount\n      );\n\n      return {\n        success: true,\n        message: 'Payment processed successfully',\n        data: result,\n      };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        `Failed to process payment: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n\n  @Get('landlords/:landlordId/escrow-balances')\n  @Roles(UserRole.LANDLORD, UserRole.ADMIN)\n  @ApiOperation({ \n    summary: 'Get landlord escrow balances',\n    description: 'Retrieves escrow balances for a specific landlord'\n  })\n  @ApiParam({ name: 'landlordId', description: 'Landlord user ID', type: 'string' })\n  @ApiQuery({ name: 'unreleasedOnly', required: false, description: 'Show only unreleased balances' })\n  @ApiResponse({ \n    status: 200, \n    description: 'Escrow balances retrieved successfully',\n    type: [EscrowBalanceResponseDto]\n  })\n  @ApiResponse({ status: 403, description: 'Access denied to escrow balances' })\n  async getLandlordEscrowBalances(\n    @Param('landlordId', ParseUUIDPipe) landlordId: string,\n    @Query() queryDto: EscrowBalanceQueryDto,\n    @Request() req: any\n  ) {\n    try {\n      // Verify the landlord is accessing their own escrow (unless admin)\n      if (req.user.role !== UserRole.ADMIN && req.user.id !== landlordId) {\n        throw new HttpException(\n          'You can only access your own escrow balances',\n          HttpStatus.FORBIDDEN\n        );\n      }\n\n      const escrowBalances = await this.landlordPayoutService.getLandlordEscrowBalances(landlordId);\n\n      // Filter for unreleased only if requested\n      const filteredBalances = queryDto.unreleasedOnly \n        ? escrowBalances.filter(balance => !balance.isReleased)\n        : escrowBalances;\n\n      return {\n        success: true,\n        data: filteredBalances,\n      };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        `Failed to retrieve escrow balances: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n\n  @Post('calculate-transition-date')\n  @Roles(UserRole.LANDLORD, UserRole.ADMIN)\n  @ApiOperation({ \n    summary: 'Calculate transition start date',\n    description: 'Calculates when a tenant should start paying through the system'\n  })\n  @ApiResponse({ \n    status: 200, \n    description: 'Transition date calculated successfully',\n    type: TransitionDateResponseDto\n  })\n  async calculateTransitionDate(\n    @Body() calculationDto: TransitionDateCalculationDto\n  ) {\n    try {\n      const expiryDate = new Date(calculationDto.expiryDate);\n      const originalExpiryDate = calculationDto.originalExpiryDate \n        ? new Date(calculationDto.originalExpiryDate) \n        : null;\n      const isExistingTenant = calculationDto.isExistingTenant || false;\n      \n      const transitionStartDate = this.tenantPaymentService.calculateTransitionStartDate(\n        isExistingTenant,\n        originalExpiryDate,\n        expiryDate\n      );\n\n      // Calculate first payment due (same as transition start)\n      const firstPaymentDue = new Date(transitionStartDate);\n\n      // Calculate months until transition\n      const today = new Date();\n      const monthsUntilTransition = Math.max(0, Math.floor(\n        (transitionStartDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24 * 30)\n      ));\n\n      return {\n        success: true,\n        data: {\n          transitionStartDate,\n          firstPaymentDue,\n          monthsUntilTransition,\n        },\n      };\n    } catch (error) {\n      throw new HttpException(\n        `Failed to calculate transition date: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n\n  @Get('landlords/:landlordId/total-escrow')\n  @Roles(UserRole.LANDLORD, UserRole.ADMIN)\n  @ApiOperation({ \n    summary: 'Get total escrow amount for landlord',\n    description: 'Retrieves the total amount held in escrow for a landlord'\n  })\n  @ApiParam({ name: 'landlordId', description: 'Landlord user ID', type: 'string' })\n  @ApiResponse({ \n    status: 200, \n    description: 'Total escrow amount retrieved successfully'\n  })\n  async getTotalEscrowAmount(\n    @Param('landlordId', ParseUUIDPipe) landlordId: string,\n    @Request() req: any\n  ) {\n    try {\n      // Verify the landlord is accessing their own escrow (unless admin)\n      if (req.user.role !== UserRole.ADMIN && req.user.id !== landlordId) {\n        throw new HttpException(\n          'You can only access your own escrow information',\n          HttpStatus.FORBIDDEN\n        );\n      }\n\n      const totalAmount = await this.landlordPayoutService.getTotalEscrowedAmount(landlordId);\n\n      return {\n        success: true,\n        data: {\n          landlordId,\n          totalEscrowedAmount: totalAmount,\n        },\n      };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        `Failed to retrieve total escrow amount: ${error.message}`,\n        HttpStatus.BAD_REQUEST\n      );\n    }\n  }\n}"],"names":["TenantRentContractsController","createRentContract","createContractDto","req","user","role","UserRole","ADMIN","id","landlordId","HttpException","HttpStatus","FORBIDDEN","result","tenantPaymentService","success","message","arrears","data","error","BAD_REQUEST","getRentContract","contractId","contract","getContractById","hasAccess","tenantId","arrearsInfo","undefined","isExistingTenant","calculateArrears","transitionStartDate","parseFloat","monthlyAmount","monthsOverdue","totalArrears","toLocaleString","NOT_FOUND","getRentContracts","queryDto","LANDLORD","TENANT","contracts","getActiveContracts","processPayment","processPaymentDto","canMakePayment","processMonthlyPayment","amount","getLandlordEscrowBalances","escrowBalances","landlordPayoutService","filteredBalances","unreleasedOnly","filter","balance","isReleased","calculateTransitionDate","calculationDto","expiryDate","Date","originalExpiryDate","calculateTransitionStartDate","firstPaymentDue","today","monthsUntilTransition","Math","max","floor","getTime","getTotalEscrowAmount","totalAmount","getTotalEscrowedAmount","totalEscrowedAmount","summary","description","status","type","RentContractResponseDto","name","required","PaymentResultDto","EscrowBalanceResponseDto","TransitionDateResponseDto"],"mappings":"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"}