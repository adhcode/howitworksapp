{"version":3,"sources":["../../src/tenant-rent-contracts/tenant-payment.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { BadRequestException, NotFoundException } from '@nestjs/common';\nimport { TenantPaymentService } from './tenant-payment.service';\nimport { DATABASE_CONNECTION } from '../database/database.module';\nimport { LandlordPayoutType, ContractStatus } from './dto/tenant-rent-contract.dto';\n\n// Mock database\nconst mockDb = {\n  select: jest.fn().mockReturnThis(),\n  insert: jest.fn().mockReturnThis(),\n  update: jest.fn().mockReturnThis(),\n  from: jest.fn().mockReturnThis(),\n  where: jest.fn().mockReturnThis(),\n  values: jest.fn().mockReturnThis(),\n  set: jest.fn().mockReturnThis(),\n  returning: jest.fn().mockReturnThis(),\n  limit: jest.fn().mockReturnThis(),\n  orderBy: jest.fn().mockReturnThis(),\n};\n\ndescribe('TenantPaymentService', () => {\n  let service: TenantPaymentService;\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        TenantPaymentService,\n        {\n          provide: DATABASE_CONNECTION,\n          useValue: mockDb,\n        },\n      ],\n    }).compile();\n\n    service = module.get<TenantPaymentService>(TenantPaymentService);\n    \n    // Reset all mocks\n    jest.clearAllMocks();\n  });\n\n  describe('calculateTransitionStartDate', () => {\n    it('should calculate 3 months before expiry for monthly payout', () => {\n      const expiryDate = new Date('2024-12-01T00:00:00.000Z');\n      const result = service.calculateTransitionStartDate(expiryDate, LandlordPayoutType.MONTHLY);\n      \n      const expected = new Date('2024-09-01T00:00:00.000Z');\n      expect(result).toEqual(expected);\n    });\n\n    it('should calculate 6 months before expiry for yearly payout', () => {\n      const expiryDate = new Date('2024-12-01T00:00:00.000Z');\n      const result = service.calculateTransitionStartDate(expiryDate, LandlordPayoutType.YEARLY);\n      \n      const expected = new Date('2024-06-01T00:00:00.000Z');\n      expect(result).toEqual(expected);\n    });\n\n    it('should return today if calculated date is in the past', () => {\n      const pastExpiryDate = new Date('2024-01-01T00:00:00.000Z');\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      const result = service.calculateTransitionStartDate(pastExpiryDate, LandlordPayoutType.MONTHLY);\n      \n      expect(result.getTime()).toBeGreaterThanOrEqual(today.getTime());\n    });\n\n    it('should throw error for invalid payout type', () => {\n      const expiryDate = new Date('2024-12-01T00:00:00.000Z');\n      \n      expect(() => {\n        service.calculateTransitionStartDate(expiryDate, 'invalid' as LandlordPayoutType);\n      }).toThrow(BadRequestException);\n    });\n\n    it('should handle month overflow correctly', () => {\n      // Test case where subtracting months goes to previous year\n      const expiryDate = new Date('2024-02-01T00:00:00.000Z');\n      const result = service.calculateTransitionStartDate(expiryDate, LandlordPayoutType.YEARLY);\n      \n      const expected = new Date('2023-08-01T00:00:00.000Z');\n      expect(result.getFullYear()).toBe(2023);\n      expect(result.getMonth()).toBe(7); // August (0-indexed)\n    });\n\n    it('should handle leap year calculations correctly', () => {\n      const expiryDate = new Date('2024-02-29T00:00:00.000Z'); // Leap year\n      const result = service.calculateTransitionStartDate(expiryDate, LandlordPayoutType.MONTHLY);\n      \n      // Should be November 29, 2023\n      expect(result.getFullYear()).toBe(2023);\n      expect(result.getMonth()).toBe(10); // November (0-indexed)\n      expect(result.getDate()).toBe(29);\n    });\n  });\n\n  describe('createRentContract', () => {\n    const validContractDto = {\n      tenantId: 'tenant-123',\n      landlordId: 'landlord-123',\n      propertyId: 'property-123',\n      unitId: 'unit-123',\n      monthlyAmount: 25000,\n      expiryDate: '2024-12-31T23:59:59.000Z',\n      landlordPayoutType: LandlordPayoutType.MONTHLY,\n      isExistingTenant: false,\n    };\n\n    beforeEach(() => {\n      // Mock successful database operations\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockReturnValue([]);  // No existing contracts\n      mockDb.insert.mockReturnValue(mockDb);\n      mockDb.values.mockReturnValue(mockDb);\n      mockDb.returning.mockResolvedValue([{\n        id: 'contract-123',\n        ...validContractDto,\n        expiryDate: new Date(validContractDto.expiryDate),\n        nextPaymentDue: new Date('2024-09-30T23:59:59.000Z'),\n        transitionStartDate: new Date('2024-09-30T23:59:59.000Z'),\n        status: 'active',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }]);\n    });\n\n    it('should create a contract successfully with valid data', async () => {\n      const result = await service.createRentContract(validContractDto);\n      \n      expect(result).toBeDefined();\n      expect(result.id).toBe('contract-123');\n      expect(result.tenantId).toBe(validContractDto.tenantId);\n      expect(result.landlordId).toBe(validContractDto.landlordId);\n      expect(mockDb.insert).toHaveBeenCalled();\n    });\n\n    it('should throw error if expiry date is in the past', async () => {\n      const pastExpiryDto = {\n        ...validContractDto,\n        expiryDate: '2020-01-01T00:00:00.000Z',\n      };\n\n      await expect(service.createRentContract(pastExpiryDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should throw error if monthly amount is zero or negative', async () => {\n      const invalidAmountDto = {\n        ...validContractDto,\n        monthlyAmount: 0,\n      };\n\n      await expect(service.createRentContract(invalidAmountDto)).rejects.toThrow(\n        BadRequestException\n      );\n\n      const negativeAmountDto = {\n        ...validContractDto,\n        monthlyAmount: -1000,\n      };\n\n      await expect(service.createRentContract(negativeAmountDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should throw error if tenant already has active contract', async () => {\n      // Mock existing active contract\n      mockDb.limit.mockReturnValue([{ id: 'existing-contract' }]);\n\n      await expect(service.createRentContract(validContractDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should require original expiry date for existing tenants', async () => {\n      const existingTenantDto = {\n        ...validContractDto,\n        isExistingTenant: true,\n        // Missing originalExpiryDate\n      };\n\n      await expect(service.createRentContract(existingTenantDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should validate original expiry date for existing tenants', async () => {\n      const existingTenantDto = {\n        ...validContractDto,\n        isExistingTenant: true,\n        originalExpiryDate: '2020-01-01T00:00:00.000Z', // Past date\n      };\n\n      await expect(service.createRentContract(existingTenantDto)).rejects.toThrow(\n        BadRequestException\n      );\n    });\n\n    it('should calculate correct transition dates for new contracts', async () => {\n      const result = await service.createRentContract(validContractDto);\n      \n      // For monthly payout, transition should start 3 months before expiry\n      const expectedTransition = new Date('2024-12-31T23:59:59.000Z');\n      expectedTransition.setMonth(expectedTransition.getMonth() - 3);\n      \n      expect(result.transitionStartDate).toBeDefined();\n      expect(result.nextPaymentDue).toBeDefined();\n    });\n  });\n\n  describe('getContractById', () => {\n    it('should return contract when found', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        tenantId: 'tenant-123',\n        landlordId: 'landlord-123',\n        status: 'active',\n      };\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      const result = await service.getContractById('contract-123');\n      \n      expect(result).toEqual(mockContract);\n    });\n\n    it('should throw NotFoundException when contract not found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]);\n\n      await expect(service.getContractById('nonexistent')).rejects.toThrow(\n        NotFoundException\n      );\n    });\n  });\n\n  describe('getActiveContracts', () => {\n    const mockContracts = [\n      {\n        id: 'contract-1',\n        tenantId: 'tenant-1',\n        landlordId: 'landlord-1',\n        status: 'active',\n      },\n      {\n        id: 'contract-2',\n        tenantId: 'tenant-2',\n        landlordId: 'landlord-1',\n        status: 'active',\n      },\n    ];\n\n    beforeEach(() => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockContracts);\n    });\n\n    it('should return all active contracts when no filter provided', async () => {\n      const result = await service.getActiveContracts();\n      \n      expect(result).toEqual(mockContracts);\n      expect(mockDb.where).toHaveBeenCalled();\n    });\n\n    it('should filter by tenant ID when provided', async () => {\n      const filteredContracts = [mockContracts[0]];\n      mockDb.orderBy.mockResolvedValue(filteredContracts);\n\n      const result = await service.getActiveContracts({ tenantId: 'tenant-1' });\n      \n      expect(result).toEqual(filteredContracts);\n    });\n\n    it('should filter by landlord ID when provided', async () => {\n      const result = await service.getActiveContracts({ landlordId: 'landlord-1' });\n      \n      expect(result).toEqual(mockContracts);\n    });\n\n    it('should filter by property ID when provided', async () => {\n      const result = await service.getActiveContracts({ propertyId: 'property-1' });\n      \n      expect(mockDb.where).toHaveBeenCalled();\n    });\n  });\n\n  describe('updateNextPaymentDue', () => {\n    it('should update next payment due date by one month', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        nextPaymentDue: new Date('2024-01-01T00:00:00.000Z'),\n      };\n\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock update\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n\n      await service.updateNextPaymentDue('contract-123');\n\n      expect(mockDb.update).toHaveBeenCalled();\n      expect(mockDb.set).toHaveBeenCalledWith(\n        expect.objectContaining({\n          nextPaymentDue: new Date('2024-02-01T00:00:00.000Z'),\n        })\n      );\n    });\n\n    it('should throw error if contract not found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]);\n\n      await expect(service.updateNextPaymentDue('nonexistent')).rejects.toThrow(\n        NotFoundException\n      );\n    });\n  });\n\n  describe('getContractsWithDuePayments', () => {\n    it('should return contracts with payments due', async () => {\n      const today = new Date('2024-01-15T00:00:00.000Z');\n      const mockContracts = [\n        {\n          id: 'contract-1',\n          nextPaymentDue: new Date('2024-01-10T00:00:00.000Z'), // Due\n          status: 'active',\n        },\n        {\n          id: 'contract-2',\n          nextPaymentDue: new Date('2024-01-20T00:00:00.000Z'), // Not due yet\n          status: 'active',\n        },\n      ];\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockContracts);\n\n      const result = await service.getContractsWithDuePayments(today);\n\n      // Should only return the first contract (due)\n      expect(result).toHaveLength(1);\n      expect(result[0].id).toBe('contract-1');\n    });\n  });\n\n  describe('updateContractStatus', () => {\n    it('should update contract status successfully', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        status: 'active',\n      };\n\n      const updatedContract = {\n        ...mockContract,\n        status: 'terminated',\n      };\n\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock update\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.returning.mockResolvedValue([updatedContract]);\n\n      const result = await service.updateContractStatus('contract-123', ContractStatus.TERMINATED);\n\n      expect(result.status).toBe('terminated');\n      expect(mockDb.update).toHaveBeenCalled();\n    });\n  });\n\n  describe('getExpiringContracts', () => {\n    it('should return contracts expiring within specified days', async () => {\n      const mockContracts = [\n        {\n          id: 'contract-1',\n          expiryDate: new Date('2024-01-20T00:00:00.000Z'), // Expires soon\n          landlordPayoutType: 'yearly',\n          status: 'active',\n        },\n        {\n          id: 'contract-2',\n          expiryDate: new Date('2024-02-20T00:00:00.000Z'), // Expires later\n          landlordPayoutType: 'yearly',\n          status: 'active',\n        },\n      ];\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockContracts);\n\n      // Mock current date to be 2024-01-15\n      const mockDate = new Date('2024-01-15T00:00:00.000Z');\n      jest.spyOn(global, 'Date').mockImplementation(() => mockDate as any);\n\n      const result = await service.getExpiringContracts(7);\n\n      // Should only return contracts expiring within 7 days\n      expect(result).toHaveLength(1);\n      expect(result[0].id).toBe('contract-1');\n\n      // Restore Date\n      (global.Date as any).mockRestore();\n    });\n  });\n\n  describe('processMonthlyPayment', () => {\n    const mockContract = {\n      id: 'contract-123',\n      tenantId: 'tenant-123',\n      landlordId: 'landlord-123',\n      propertyId: 'property-123',\n      unitId: 'unit-123',\n      monthlyAmount: '25000.00',\n      nextPaymentDue: new Date('2024-01-15T00:00:00.000Z'),\n      expiryDate: new Date('2024-12-31T23:59:59.000Z'),\n      landlordPayoutType: LandlordPayoutType.MONTHLY,\n      status: 'active',\n    };\n\n    beforeEach(() => {\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock updateNextPaymentDue\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n    });\n\n    it('should process payment successfully for monthly payout', async () => {\n      const result = await service.processMonthlyPayment('contract-123', 25000, 'card', 'ref-123');\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe(LandlordPayoutType.MONTHLY);\n      expect(result.message).toContain('immediately');\n      expect(result.nextPaymentDue).toBeDefined();\n    });\n\n    it('should process payment successfully for yearly payout', async () => {\n      const yearlyContract = {\n        ...mockContract,\n        landlordPayoutType: LandlordPayoutType.YEARLY,\n      };\n\n      mockDb.limit.mockResolvedValue([yearlyContract]);\n      \n      // Mock escrow operations\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]); // No existing escrow\n      mockDb.insert.mockReturnValue(mockDb);\n      mockDb.values.mockResolvedValue(undefined);\n\n      const result = await service.processMonthlyPayment('contract-123', 25000, 'card', 'ref-123');\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe(LandlordPayoutType.YEARLY);\n      expect(result.message).toContain('escrow');\n    });\n\n    it('should throw error for invalid payment amount', async () => {\n      await expect(\n        service.processMonthlyPayment('contract-123', 0, 'card', 'ref-123')\n      ).rejects.toThrow(BadRequestException);\n\n      await expect(\n        service.processMonthlyPayment('contract-123', -100, 'card', 'ref-123')\n      ).rejects.toThrow(BadRequestException);\n    });\n\n    it('should throw error for mismatched payment amount', async () => {\n      await expect(\n        service.processMonthlyPayment('contract-123', 20000, 'card', 'ref-123') // Wrong amount\n      ).rejects.toThrow(BadRequestException);\n    });\n\n    it('should throw error for payment too early', async () => {\n      const futureContract = {\n        ...mockContract,\n        nextPaymentDue: new Date('2024-12-01T00:00:00.000Z'), // Far in future\n      };\n\n      mockDb.limit.mockResolvedValue([futureContract]);\n\n      await expect(\n        service.processMonthlyPayment('contract-123', 25000, 'card', 'ref-123')\n      ).rejects.toThrow(BadRequestException);\n    });\n\n    it('should allow payment up to 30 days early', async () => {\n      const mockDate = new Date('2024-01-01T00:00:00.000Z');\n      jest.spyOn(global, 'Date').mockImplementation(() => mockDate as any);\n\n      const earlyPaymentContract = {\n        ...mockContract,\n        nextPaymentDue: new Date('2024-01-20T00:00:00.000Z'), // 19 days in future\n      };\n\n      mockDb.limit.mockResolvedValue([earlyPaymentContract]);\n\n      const result = await service.processMonthlyPayment('contract-123', 25000, 'card', 'ref-123');\n\n      expect(result.success).toBe(true);\n\n      (global.Date as any).mockRestore();\n    });\n\n    it('should handle contract not found', async () => {\n      mockDb.limit.mockResolvedValue([]); // No contract found\n\n      await expect(\n        service.processMonthlyPayment('nonexistent', 25000, 'card', 'ref-123')\n      ).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  describe('updateNextPaymentDue with expiry handling', () => {\n    it('should update next payment due date normally', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        nextPaymentDue: new Date('2024-01-01T00:00:00.000Z'),\n        expiryDate: new Date('2024-12-31T23:59:59.000Z'), // Far in future\n      };\n\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock update\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n\n      await service.updateNextPaymentDue('contract-123');\n\n      expect(mockDb.update).toHaveBeenCalled();\n      expect(mockDb.set).toHaveBeenCalledWith(\n        expect.objectContaining({\n          nextPaymentDue: new Date('2024-02-01T00:00:00.000Z'),\n        })\n      );\n    });\n\n    it('should mark contract as expired if next payment would be after expiry', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        nextPaymentDue: new Date('2024-12-01T00:00:00.000Z'),\n        expiryDate: new Date('2024-12-15T23:59:59.000Z'), // Expires soon\n      };\n\n      // Mock getContractById (called twice - once for updateNextPaymentDue, once for updateContractStatus)\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock updateContractStatus\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.returning.mockResolvedValue([{ ...mockContract, status: 'expired' }]);\n\n      await service.updateNextPaymentDue('contract-123');\n\n      // Should call update to mark as expired instead of updating payment due\n      expect(mockDb.update).toHaveBeenCalled();\n    });\n  });\n\n  describe('getLandlordEscrowBalances', () => {\n    const mockEscrowBalances = [\n      {\n        id: 'escrow-1',\n        landlordId: 'landlord-123',\n        contractId: 'contract-1',\n        totalEscrowed: '50000.00',\n        isReleased: false,\n      },\n      {\n        id: 'escrow-2',\n        landlordId: 'landlord-123',\n        contractId: 'contract-2',\n        totalEscrowed: '25000.00',\n        isReleased: true,\n      },\n    ];\n\n    beforeEach(() => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockEscrowBalances);\n    });\n\n    it('should return all escrow balances for landlord', async () => {\n      const result = await service.getLandlordEscrowBalances('landlord-123');\n\n      expect(result).toEqual(mockEscrowBalances);\n      expect(mockDb.where).toHaveBeenCalled();\n    });\n\n    it('should return only unreleased escrow balances when requested', async () => {\n      const unreleasedBalances = [mockEscrowBalances[0]];\n      mockDb.orderBy.mockResolvedValue(unreleasedBalances);\n\n      const result = await service.getLandlordEscrowBalances('landlord-123', true);\n\n      expect(result).toEqual(unreleasedBalances);\n    });\n  });\n\n  describe('getTotalEscrowedAmount', () => {\n    it('should calculate total escrowed amount correctly', async () => {\n      const mockEscrowBalances = [\n        {\n          id: 'escrow-1',\n          landlordId: 'landlord-123',\n          totalEscrowed: '50000.00',\n          isReleased: false,\n        },\n        {\n          id: 'escrow-2',\n          landlordId: 'landlord-123',\n          totalEscrowed: '25000.00',\n          isReleased: false,\n        },\n      ];\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockEscrowBalances);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toBe(75000); // 50000 + 25000\n    });\n\n    it('should return 0 when no escrow balances exist', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue([]);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toBe(0);\n    });\n  });\n\n  describe('escrow management', () => {\n    it('should create new escrow balance for first payment', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        landlordId: 'landlord-123',\n        expiryDate: new Date('2024-12-31T23:59:59.000Z'),\n      };\n\n      // Mock no existing escrow\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]);\n\n      // Mock getContractById for escrow creation\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock insert\n      mockDb.insert.mockReturnValue(mockDb);\n      mockDb.values.mockResolvedValue(undefined);\n\n      // Call the private method through processMonthlyPayment\n      const yearlyContract = {\n        ...mockContract,\n        monthlyAmount: '25000.00',\n        nextPaymentDue: new Date('2024-01-15T00:00:00.000Z'),\n        landlordPayoutType: LandlordPayoutType.YEARLY,\n        status: 'active',\n      };\n\n      mockDb.limit.mockResolvedValue([yearlyContract]);\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n\n      const result = await service.processMonthlyPayment('contract-123', 25000);\n\n      expect(result.success).toBe(true);\n      expect(mockDb.insert).toHaveBeenCalled();\n    });\n\n    it('should update existing escrow balance for subsequent payments', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        landlordId: 'landlord-123',\n        monthlyAmount: '25000.00',\n        nextPaymentDue: new Date('2024-01-15T00:00:00.000Z'),\n        expiryDate: new Date('2024-12-31T23:59:59.000Z'),\n        landlordPayoutType: LandlordPayoutType.YEARLY,\n        status: 'active',\n      };\n\n      const existingEscrow = {\n        id: 'escrow-123',\n        landlordId: 'landlord-123',\n        contractId: 'contract-123',\n        totalEscrowed: '25000.00',\n        monthsAccumulated: 1,\n        isReleased: false,\n      };\n\n      // Mock existing escrow found\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValueOnce([mockContract]).mockResolvedValueOnce([existingEscrow]);\n\n      // Mock update escrow\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n\n      const result = await service.processMonthlyPayment('contract-123', 25000);\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe(LandlordPayoutType.YEARLY);\n      expect(mockDb.update).toHaveBeenCalled();\n    });\n  });\n\n  describe('edge cases and error scenarios', () => {\n    it('should handle database connection errors gracefully', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockRejectedValue(new Error('Database connection failed'));\n\n      await expect(service.getContractById('contract-123')).rejects.toThrow('Database connection failed');\n    });\n\n    it('should handle invalid UUID format', async () => {\n      await expect(service.getContractById('invalid-uuid')).rejects.toThrow();\n    });\n\n    it('should validate contract expiry date boundary conditions', async () => {\n      const validContractDto = {\n        tenantId: 'tenant-123',\n        landlordId: 'landlord-123',\n        propertyId: 'property-123',\n        unitId: 'unit-123',\n        monthlyAmount: 25000,\n        expiryDate: new Date().toISOString(), // Exactly now\n        landlordPayoutType: LandlordPayoutType.MONTHLY,\n        isExistingTenant: false,\n      };\n\n      // Mock no existing contracts\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]);\n\n      await expect(service.createRentContract(validContractDto)).rejects.toThrow(\n        'Contract expiry date must be in the future'\n      );\n    });\n\n    it('should handle transition date calculation for edge months', async () => {\n      // Test February to November transition (9 months back)\n      const februaryDate = new Date('2024-02-29T00:00:00.000Z'); // Leap year\n      const result = service.calculateTransitionStartDate(februaryDate, LandlordPayoutType.YEARLY);\n      \n      expect(result.getFullYear()).toBe(2023);\n      expect(result.getMonth()).toBe(7); // August (0-indexed)\n    });\n\n    it('should handle contract creation with maximum allowed values', async () => {\n      const maxValueContract = {\n        tenantId: 'tenant-123',\n        landlordId: 'landlord-123',\n        propertyId: 'property-123',\n        unitId: 'unit-123',\n        monthlyAmount: 999999.99, // Maximum reasonable amount\n        expiryDate: new Date('2099-12-31T23:59:59.000Z').toISOString(),\n        landlordPayoutType: LandlordPayoutType.MONTHLY,\n        isExistingTenant: false,\n      };\n\n      // Mock successful creation\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([]);\n      mockDb.insert.mockReturnValue(mockDb);\n      mockDb.values.mockReturnValue(mockDb);\n      mockDb.returning.mockResolvedValue([{\n        id: 'contract-123',\n        ...maxValueContract,\n        expiryDate: new Date(maxValueContract.expiryDate),\n        nextPaymentDue: new Date(),\n        transitionStartDate: new Date(),\n        status: 'active',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }]);\n\n      const result = await service.createRentContract(maxValueContract);\n      expect(result).toBeDefined();\n      expect(result.monthlyAmount).toBe('999999.99');\n    });\n\n    it('should handle concurrent access to same contract', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        nextPaymentDue: new Date('2024-01-01T00:00:00.000Z'),\n      };\n\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock update that might fail due to concurrent access\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockRejectedValue(new Error('Concurrent modification detected'));\n\n      await expect(service.updateNextPaymentDue('contract-123')).rejects.toThrow(\n        'Concurrent modification detected'\n      );\n    });\n\n    it('should handle payment processing with floating point precision', async () => {\n      const mockContract = {\n        id: 'contract-123',\n        tenantId: 'tenant-123',\n        landlordId: 'landlord-123',\n        propertyId: 'property-123',\n        unitId: 'unit-123',\n        monthlyAmount: '2500.33', // Amount with cents\n        nextPaymentDue: new Date('2024-01-15T00:00:00.000Z'),\n        expiryDate: new Date('2024-12-31T23:59:59.000Z'),\n        landlordPayoutType: LandlordPayoutType.MONTHLY,\n        status: 'active',\n      };\n\n      // Mock getContractById\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([mockContract]);\n\n      // Mock updateNextPaymentDue\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(undefined);\n\n      const result = await service.processMonthlyPayment('contract-123', 2500.33);\n      expect(result.success).toBe(true);\n    });\n\n    it('should handle very large escrow accumulations', async () => {\n      const mockEscrowBalances = Array.from({ length: 100 }, (_, i) => ({\n        id: `escrow-${i}`,\n        landlordId: 'landlord-123',\n        totalEscrowed: '50000.00',\n        isReleased: false,\n      }));\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue(mockEscrowBalances);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n      expect(result).toBe(5000000); // 100 * 50000\n    });\n\n    it('should handle contract queries with no results', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.orderBy.mockResolvedValue([]);\n\n      const result = await service.getActiveContracts('nonexistent-tenant');\n      expect(result).toEqual([]);\n    });\n\n    it('should handle payment processing for expired contracts', async () => {\n      const expiredContract = {\n        id: 'contract-123',\n        tenantId: 'tenant-123',\n        landlordId: 'landlord-123',\n        propertyId: 'property-123',\n        unitId: 'unit-123',\n        monthlyAmount: '25000.00',\n        nextPaymentDue: new Date('2024-01-15T00:00:00.000Z'),\n        expiryDate: new Date('2020-12-31T23:59:59.000Z'), // Expired\n        landlordPayoutType: LandlordPayoutType.MONTHLY,\n        status: 'active',\n      };\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockReturnValue(mockDb);\n      mockDb.limit.mockResolvedValue([expiredContract]);\n\n      await expect(\n        service.processMonthlyPayment('contract-123', 25000)\n      ).rejects.toThrow('Cannot process payment for expired contract');\n    });\n  });\n});"],"names":["mockDb","select","jest","fn","mockReturnThis","insert","update","from","where","values","set","returning","limit","orderBy","describe","service","beforeEach","module","Test","createTestingModule","providers","TenantPaymentService","provide","DATABASE_CONNECTION","useValue","compile","get","clearAllMocks","it","expiryDate","Date","result","calculateTransitionStartDate","LandlordPayoutType","MONTHLY","expected","expect","toEqual","YEARLY","pastExpiryDate","today","setHours","getTime","toBeGreaterThanOrEqual","toThrow","BadRequestException","getFullYear","toBe","getMonth","getDate","validContractDto","tenantId","landlordId","propertyId","unitId","monthlyAmount","landlordPayoutType","isExistingTenant","mockReturnValue","mockResolvedValue","id","nextPaymentDue","transitionStartDate","status","createdAt","updatedAt","createRentContract","toBeDefined","toHaveBeenCalled","pastExpiryDto","rejects","invalidAmountDto","negativeAmountDto","existingTenantDto","originalExpiryDate","expectedTransition","setMonth","mockContract","getContractById","NotFoundException","mockContracts","getActiveContracts","filteredContracts","undefined","updateNextPaymentDue","toHaveBeenCalledWith","objectContaining","getContractsWithDuePayments","toHaveLength","updatedContract","updateContractStatus","ContractStatus","TERMINATED","mockDate","spyOn","global","mockImplementation","getExpiringContracts","mockRestore","processMonthlyPayment","success","payoutType","message","toContain","yearlyContract","futureContract","earlyPaymentContract","mockEscrowBalances","contractId","totalEscrowed","isReleased","getLandlordEscrowBalances","unreleasedBalances","getTotalEscrowedAmount","existingEscrow","monthsAccumulated","mockResolvedValueOnce","mockRejectedValue","Error","toISOString","februaryDate","maxValueContract","Array","length","_","i","expiredContract"],"mappings":"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"}