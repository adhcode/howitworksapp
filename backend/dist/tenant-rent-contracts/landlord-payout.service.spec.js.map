{"version":3,"sources":["../../src/tenant-rent-contracts/landlord-payout.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { LandlordPayoutService, PayoutResult, EscrowReleaseResult } from './landlord-payout.service';\nimport { DATABASE_CONNECTION } from '../database/database.module';\n\ndescribe('LandlordPayoutService', () => {\n  let service: LandlordPayoutService;\n  let mockDb: any;\n\n  const mockContract = {\n    id: 'contract-123',\n    tenantId: 'tenant-123',\n    landlordId: 'landlord-123',\n    propertyId: 'property-123',\n    unitId: 'unit-123',\n    monthlyAmount: '1000.00',\n    expiryDate: new Date('2024-12-01'),\n    landlordPayoutType: 'monthly',\n    nextPaymentDue: new Date('2024-09-01'),\n    transitionStartDate: new Date('2024-09-01'),\n    status: 'active',\n    isExistingTenant: true,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockEscrowBalance = {\n    id: 'escrow-123',\n    landlordId: 'landlord-123',\n    contractId: 'contract-123',\n    totalEscrowed: '3000.00',\n    monthsAccumulated: 3,\n    expectedReleaseDate: new Date('2024-12-01'),\n    isReleased: false,\n    releasedAt: null,\n    releasedAmount: null,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  beforeEach(async () => {\n    mockDb = {\n      select: jest.fn().mockReturnThis(),\n      from: jest.fn().mockReturnThis(),\n      where: jest.fn().mockReturnThis(),\n      leftJoin: jest.fn().mockReturnThis(),\n      update: jest.fn().mockReturnThis(),\n      set: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n      values: jest.fn().mockReturnThis(),\n      transaction: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        LandlordPayoutService,\n        {\n          provide: DATABASE_CONNECTION,\n          useValue: mockDb,\n        },\n      ],\n    }).compile();\n\n    service = module.get<LandlordPayoutService>(LandlordPayoutService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('processImmediatePayout', () => {\n    it('should process immediate payout for monthly landlord successfully', async () => {\n      // Mock contract lookup\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ ...mockContract, landlordPayoutType: 'monthly' }]);\n\n      const result: PayoutResult = await service.processImmediatePayout('landlord-123', 1000, 'contract-123');\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe('immediate');\n      expect(result.amount).toBe(1000);\n      expect(result.transactionId).toBeDefined();\n      expect(mockDb.select).toHaveBeenCalled();\n      expect(mockDb.where).toHaveBeenCalled();\n    });\n\n    it('should throw error if contract not found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([]);\n\n      await expect(\n        service.processImmediatePayout('landlord-123', 1000, 'invalid-contract')\n      ).rejects.toThrow('Contract not found or not eligible for immediate payout');\n    });\n\n    it('should throw error if contract is not monthly payout type', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ ...mockContract, landlordPayoutType: 'yearly' }]);\n\n      await expect(\n        service.processImmediatePayout('landlord-123', 1000, 'contract-123')\n      ).rejects.toThrow('Contract not found or not eligible for immediate payout');\n    });\n  });\n\n  describe('addToEscrow', () => {\n    it('should create new escrow balance for first payment', async () => {\n      // Mock contract lookup\n      mockDb.select.mockReturnValueOnce(mockDb);\n      mockDb.from.mockReturnValueOnce(mockDb);\n      mockDb.where.mockResolvedValueOnce([{ ...mockContract, landlordPayoutType: 'yearly' }]);\n\n      // Mock escrow lookup (no existing escrow)\n      mockDb.select.mockReturnValueOnce(mockDb);\n      mockDb.from.mockReturnValueOnce(mockDb);\n      mockDb.where.mockResolvedValueOnce([]);\n\n      // Mock insert\n      mockDb.insert.mockReturnValue(mockDb);\n      mockDb.values.mockResolvedValue({ success: true });\n\n      const result: PayoutResult = await service.addToEscrow('landlord-123', 1000, 'contract-123');\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe('escrow');\n      expect(result.amount).toBe(1000);\n      expect(mockDb.insert).toHaveBeenCalled();\n      expect(mockDb.values).toHaveBeenCalledWith(\n        expect.objectContaining({\n          landlordId: 'landlord-123',\n          contractId: 'contract-123',\n          totalEscrowed: '1000',\n          monthsAccumulated: 1,\n          isReleased: false,\n        })\n      );\n    });\n\n    it('should update existing escrow balance for subsequent payments', async () => {\n      // Mock contract lookup\n      mockDb.select.mockReturnValueOnce(mockDb);\n      mockDb.from.mockReturnValueOnce(mockDb);\n      mockDb.where.mockResolvedValueOnce([{ ...mockContract, landlordPayoutType: 'yearly' }]);\n\n      // Mock existing escrow lookup\n      mockDb.select.mockReturnValueOnce(mockDb);\n      mockDb.from.mockReturnValueOnce(mockDb);\n      mockDb.where.mockResolvedValueOnce([mockEscrowBalance]);\n\n      // Mock update\n      mockDb.update.mockReturnValue(mockDb);\n      mockDb.set.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue({ success: true });\n\n      const result: PayoutResult = await service.addToEscrow('landlord-123', 1000, 'contract-123');\n\n      expect(result.success).toBe(true);\n      expect(result.payoutType).toBe('escrow');\n      expect(result.amount).toBe(1000);\n      expect(mockDb.update).toHaveBeenCalled();\n      expect(mockDb.set).toHaveBeenCalledWith(\n        expect.objectContaining({\n          totalEscrowed: '4000', // 3000 + 1000\n          monthsAccumulated: 4, // 3 + 1\n        })\n      );\n    });\n\n    it('should throw error if contract is not yearly payout type', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ ...mockContract, landlordPayoutType: 'monthly' }]);\n\n      await expect(\n        service.addToEscrow('landlord-123', 1000, 'contract-123')\n      ).rejects.toThrow('Contract not found or not eligible for escrow');\n    });\n  });\n\n  describe('checkEscrowReleases', () => {\n    it('should find and process escrow balances ready for release', async () => {\n      const pastDate = new Date('2023-12-01'); // Past date\n      const readyEscrow = {\n        escrow: { ...mockEscrowBalance, expectedReleaseDate: pastDate },\n        contract: mockContract,\n      };\n\n      // Mock query for ready escrow balances\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.leftJoin.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([readyEscrow]);\n\n      // Mock releaseEscrowBalance method\n      const mockReleaseResult: EscrowReleaseResult = {\n        success: true,\n        releasedAmount: 3000,\n        escrowId: 'escrow-123',\n        landlordId: 'landlord-123',\n      };\n      jest.spyOn(service, 'releaseEscrowBalance').mockResolvedValue(mockReleaseResult);\n\n      const results = await service.checkEscrowReleases();\n\n      expect(results).toHaveLength(1);\n      expect(results[0]).toEqual(mockReleaseResult);\n      expect(service.releaseEscrowBalance).toHaveBeenCalledWith('escrow-123');\n    });\n\n    it('should return empty array if no escrow balances ready for release', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.leftJoin.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([]);\n\n      const results = await service.checkEscrowReleases();\n\n      expect(results).toHaveLength(0);\n    });\n\n    it('should continue processing other escrows if one fails', async () => {\n      const readyEscrows = [\n        { escrow: { ...mockEscrowBalance, id: 'escrow-1' }, contract: mockContract },\n        { escrow: { ...mockEscrowBalance, id: 'escrow-2' }, contract: mockContract },\n      ];\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.leftJoin.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue(readyEscrows);\n\n      // Mock first release to fail, second to succeed\n      jest.spyOn(service, 'releaseEscrowBalance')\n        .mockRejectedValueOnce(new Error('Release failed'))\n        .mockResolvedValueOnce({\n          success: true,\n          releasedAmount: 3000,\n          escrowId: 'escrow-2',\n          landlordId: 'landlord-123',\n        });\n\n      const results = await service.checkEscrowReleases();\n\n      expect(results).toHaveLength(1);\n      expect(results[0].escrowId).toBe('escrow-2');\n    });\n  });\n\n  describe('releaseEscrowBalance', () => {\n    it('should release escrow balance successfully with transaction', async () => {\n      const mockTransaction = jest.fn().mockImplementation(async (callback) => {\n        const mockTx = {\n          select: jest.fn().mockReturnThis(),\n          from: jest.fn().mockReturnThis(),\n          where: jest.fn().mockResolvedValue([mockEscrowBalance]),\n          update: jest.fn().mockReturnThis(),\n          set: jest.fn().mockReturnThis(),\n        };\n        mockTx.where.mockResolvedValueOnce([mockEscrowBalance]);\n        mockTx.set.mockReturnValue(mockTx);\n        mockTx.where.mockResolvedValueOnce({ success: true });\n        \n        return await callback(mockTx);\n      });\n\n      mockDb.transaction = mockTransaction;\n\n      const result = await service.releaseEscrowBalance('escrow-123');\n\n      expect(result.success).toBe(true);\n      expect(result.releasedAmount).toBe(3000);\n      expect(result.escrowId).toBe('escrow-123');\n      expect(result.landlordId).toBe('landlord-123');\n      expect(mockTransaction).toHaveBeenCalled();\n    });\n\n    it('should throw error if escrow not found', async () => {\n      const mockTransaction = jest.fn().mockImplementation(async (callback) => {\n        const mockTx = {\n          select: jest.fn().mockReturnThis(),\n          from: jest.fn().mockReturnThis(),\n          where: jest.fn().mockResolvedValue([]),\n        };\n        return await callback(mockTx);\n      });\n\n      mockDb.transaction = mockTransaction;\n\n      await expect(\n        service.releaseEscrowBalance('invalid-escrow')\n      ).rejects.toThrow('Escrow balance not found or already released');\n    });\n\n    it('should throw error if release amount is invalid', async () => {\n      const invalidEscrow = { ...mockEscrowBalance, totalEscrowed: '0.00' };\n      \n      const mockTransaction = jest.fn().mockImplementation(async (callback) => {\n        const mockTx = {\n          select: jest.fn().mockReturnThis(),\n          from: jest.fn().mockReturnThis(),\n          where: jest.fn().mockResolvedValue([invalidEscrow]),\n        };\n        return await callback(mockTx);\n      });\n\n      mockDb.transaction = mockTransaction;\n\n      await expect(\n        service.releaseEscrowBalance('escrow-123')\n      ).rejects.toThrow('Invalid release amount: 0');\n    });\n  });\n\n  describe('getLandlordEscrowBalances', () => {\n    it('should return all escrow balances for landlord', async () => {\n      const mockEscrowWithContract = {\n        escrow: mockEscrowBalance,\n        contract: mockContract,\n      };\n\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.leftJoin.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([mockEscrowWithContract]);\n\n      const result = await service.getLandlordEscrowBalances('landlord-123');\n\n      expect(result).toHaveLength(1);\n      expect(result[0]).toMatchObject({\n        ...mockEscrowBalance,\n        contract: mockContract,\n      });\n    });\n\n    it('should return empty array if no escrow balances found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.leftJoin.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([]);\n\n      const result = await service.getLandlordEscrowBalances('landlord-123');\n\n      expect(result).toHaveLength(0);\n    });\n  });\n\n  describe('getTotalEscrowedAmount', () => {\n    it('should return total escrowed amount for landlord', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ total: '5000.00' }]);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toBe(5000);\n    });\n\n    it('should return 0 if no escrow balances found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ total: '0' }]);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toBe(0);\n    });\n\n    it('should handle null total from database', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([{ total: null }]);\n\n      const result = await service.getTotalEscrowedAmount('landlord-123');\n\n      expect(result).toBe(0);\n    });\n  });\n\n  describe('getEscrowByContractId', () => {\n    it('should return escrow balance for contract', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([mockEscrowBalance]);\n\n      const result = await service.getEscrowByContractId('contract-123');\n\n      expect(result).toEqual(mockEscrowBalance);\n    });\n\n    it('should return null if no escrow found', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockResolvedValue([]);\n\n      const result = await service.getEscrowByContractId('contract-123');\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('forceReleaseEscrow', () => {\n    it('should force release escrow for contract', async () => {\n      // Mock getEscrowByContractId\n      jest.spyOn(service, 'getEscrowByContractId').mockResolvedValue(mockEscrowBalance);\n      \n      // Mock releaseEscrowBalance\n      const mockReleaseResult: EscrowReleaseResult = {\n        success: true,\n        releasedAmount: 3000,\n        escrowId: 'escrow-123',\n        landlordId: 'landlord-123',\n      };\n      jest.spyOn(service, 'releaseEscrowBalance').mockResolvedValue(mockReleaseResult);\n\n      const result = await service.forceReleaseEscrow('contract-123', 'Early termination');\n\n      expect(result).toEqual(mockReleaseResult);\n      expect(service.getEscrowByContractId).toHaveBeenCalledWith('contract-123');\n      expect(service.releaseEscrowBalance).toHaveBeenCalledWith('escrow-123');\n    });\n\n    it('should throw error if no active escrow found', async () => {\n      jest.spyOn(service, 'getEscrowByContractId').mockResolvedValue(null);\n\n      await expect(\n        service.forceReleaseEscrow('contract-123', 'Early termination')\n      ).rejects.toThrow('No active escrow found for contract: contract-123');\n    });\n  });\n\n  describe('error handling', () => {\n    it('should handle database errors gracefully', async () => {\n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockRejectedValue(new Error('Database connection failed'));\n\n      await expect(\n        service.processImmediatePayout('landlord-123', 1000, 'contract-123')\n      ).rejects.toThrow('Database connection failed');\n    });\n\n    it('should log errors appropriately', async () => {\n      const loggerSpy = jest.spyOn(service['logger'], 'error');\n      \n      mockDb.select.mockReturnValue(mockDb);\n      mockDb.from.mockReturnValue(mockDb);\n      mockDb.where.mockRejectedValue(new Error('Test error'));\n\n      await expect(\n        service.processImmediatePayout('landlord-123', 1000, 'contract-123')\n      ).rejects.toThrow('Test error');\n\n      expect(loggerSpy).toHaveBeenCalled();\n    });\n  });\n});"],"names":["describe","service","mockDb","mockContract","id","tenantId","landlordId","propertyId","unitId","monthlyAmount","expiryDate","Date","landlordPayoutType","nextPaymentDue","transitionStartDate","status","isExistingTenant","createdAt","updatedAt","mockEscrowBalance","contractId","totalEscrowed","monthsAccumulated","expectedReleaseDate","isReleased","releasedAt","releasedAmount","beforeEach","select","jest","fn","mockReturnThis","from","where","leftJoin","update","set","insert","values","transaction","module","Test","createTestingModule","providers","LandlordPayoutService","provide","DATABASE_CONNECTION","useValue","compile","get","afterEach","clearAllMocks","it","mockReturnValue","mockResolvedValue","result","processImmediatePayout","expect","success","toBe","payoutType","amount","transactionId","toBeDefined","toHaveBeenCalled","rejects","toThrow","mockReturnValueOnce","mockResolvedValueOnce","addToEscrow","toHaveBeenCalledWith","objectContaining","pastDate","readyEscrow","escrow","contract","mockReleaseResult","escrowId","spyOn","results","checkEscrowReleases","toHaveLength","toEqual","releaseEscrowBalance","readyEscrows","mockRejectedValueOnce","Error","mockTransaction","mockImplementation","callback","mockTx","invalidEscrow","mockEscrowWithContract","getLandlordEscrowBalances","toMatchObject","total","getTotalEscrowedAmount","getEscrowByContractId","toBeNull","forceReleaseEscrow","mockRejectedValue","loggerSpy"],"mappings":"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"}