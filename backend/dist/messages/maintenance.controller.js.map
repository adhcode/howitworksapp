{"version":3,"sources":["../../src/messages/maintenance.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Body,\n  Patch,\n  Param,\n  UseGuards,\n  Request,\n} from '@nestjs/common';\nimport { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { UserRole } from '../auth/dto/auth.dto';\nimport { MessagesService } from './messages.service';\nimport { EnhancedMessagesService } from './enhanced-messages.service';\nimport { CreateMaintenanceRequestDto } from './dto/message.dto';\n\n@ApiTags('Maintenance')\n@Controller('maintenance')\n@UseGuards(JwtAuthGuard, RolesGuard)\n@ApiBearerAuth('JWT-auth')\nexport class MaintenanceController {\n  constructor(\n    private readonly messagesService: MessagesService,\n    private readonly enhancedMessagesService: EnhancedMessagesService\n  ) {}\n\n  @Post('requests')\n  @Roles(UserRole.TENANT)\n  @ApiOperation({ summary: 'Create a maintenance request (routes to facilitator if assigned)' })\n  @ApiResponse({ status: 201, description: 'Maintenance request created successfully' })\n  async createRequest(@Request() req: any, @Body() createMaintenanceRequestDto: CreateMaintenanceRequestDto) {\n    return this.enhancedMessagesService.createMaintenanceRequestWithRouting(req.user.id, createMaintenanceRequestDto);\n  }\n\n  @Get('requests')\n  @Roles(UserRole.TENANT, UserRole.LANDLORD, UserRole.FACILITATOR)\n  @ApiOperation({ summary: 'Get maintenance requests' })\n  @ApiResponse({ status: 200, description: 'Maintenance requests retrieved successfully' })\n  async getRequests(@Request() req: any) {\n    if (req.user.role === 'facilitator') {\n      return this.enhancedMessagesService.getFacilitatorMaintenanceRequests(req.user.id);\n    }\n    return this.messagesService.getMaintenanceRequests(req.user.id, req.user.role);\n  }\n\n  @Get('requests/:id')\n  @ApiOperation({ summary: 'Get a specific maintenance request' })\n  @ApiResponse({ status: 200, description: 'Maintenance request retrieved successfully' })\n  async getRequest(@Request() req: any, @Param('id') id: string) {\n    return this.enhancedMessagesService.getMaintenanceRequestById(id, req.user.id);\n  }\n\n  @Patch('requests/:id/status')\n  @Roles(UserRole.LANDLORD, UserRole.FACILITATOR)\n  @ApiOperation({ summary: 'Update maintenance request status' })\n  @ApiResponse({ status: 200, description: 'Status updated successfully' })\n  async updateStatus(\n    @Request() req: any, \n    @Param('id') id: string, \n    @Body() updateDto: { status: string; notes?: string }\n  ) {\n    return this.enhancedMessagesService.updateMaintenanceRequestStatus(\n      id, \n      updateDto.status, \n      req.user.id,\n      updateDto.notes\n    );\n  }\n\n  @Patch('requests/:id/priority')\n  @Roles(UserRole.LANDLORD, UserRole.FACILITATOR)\n  @ApiOperation({ summary: 'Update maintenance request priority' })\n  @ApiResponse({ status: 200, description: 'Priority updated successfully' })\n  async updatePriority(\n    @Request() req: any, \n    @Param('id') id: string, \n    @Body() updateDto: { priority: string; notes?: string }\n  ) {\n    return this.enhancedMessagesService.updateMaintenanceRequestPriority(\n      id, \n      updateDto.priority, \n      req.user.id,\n      updateDto.notes\n    );\n  }\n\n  @Post('requests/:id/comments')\n  @Roles(UserRole.TENANT, UserRole.LANDLORD, UserRole.FACILITATOR)\n  @ApiOperation({ summary: 'Add comment to maintenance request' })\n  @ApiResponse({ status: 201, description: 'Comment added successfully' })\n  async addComment(\n    @Request() req: any, \n    @Param('id') id: string, \n    @Body() commentDto: { comment: string }\n  ) {\n    return this.enhancedMessagesService.addMaintenanceComment(id, req.user.id, commentDto.comment);\n  }\n} "],"names":["MaintenanceController","createRequest","req","createMaintenanceRequestDto","enhancedMessagesService","createMaintenanceRequestWithRouting","user","id","getRequests","role","getFacilitatorMaintenanceRequests","messagesService","getMaintenanceRequests","getRequest","getMaintenanceRequestById","updateStatus","updateDto","updateMaintenanceRequestStatus","status","notes","updatePriority","updateMaintenanceRequestPriority","priority","addComment","commentDto","addMaintenanceComment","comment","TENANT","summary","description","LANDLORD","FACILITATOR"],"mappings":";;;;+BAuBaA;;;eAAAA;;;wBAdN;yBAC2D;8BACrC;4BACF;gCACL;yBACG;iCACO;yCACQ;4BACI;;;;;;;;;;;;;;;AAMrC,IAAA,AAAMA,wBAAN,MAAMA;IAMX,MAIMC,cAAc,AAAWC,GAAQ,EAAE,AAAQC,2BAAwD,EAAE;QACzG,OAAO,IAAI,CAACC,uBAAuB,CAACC,mCAAmC,CAACH,IAAII,IAAI,CAACC,EAAE,EAAEJ;IACvF;IAEA,MAIMK,YAAY,AAAWN,GAAQ,EAAE;QACrC,IAAIA,IAAII,IAAI,CAACG,IAAI,KAAK,eAAe;YACnC,OAAO,IAAI,CAACL,uBAAuB,CAACM,iCAAiC,CAACR,IAAII,IAAI,CAACC,EAAE;QACnF;QACA,OAAO,IAAI,CAACI,eAAe,CAACC,sBAAsB,CAACV,IAAII,IAAI,CAACC,EAAE,EAAEL,IAAII,IAAI,CAACG,IAAI;IAC/E;IAEA,MAGMI,WAAW,AAAWX,GAAQ,EAAE,AAAaK,EAAU,EAAE;QAC7D,OAAO,IAAI,CAACH,uBAAuB,CAACU,yBAAyB,CAACP,IAAIL,IAAII,IAAI,CAACC,EAAE;IAC/E;IAEA,MAIMQ,aACJ,AAAWb,GAAQ,EACnB,AAAaK,EAAU,EACvB,AAAQS,SAA6C,EACrD;QACA,OAAO,IAAI,CAACZ,uBAAuB,CAACa,8BAA8B,CAChEV,IACAS,UAAUE,MAAM,EAChBhB,IAAII,IAAI,CAACC,EAAE,EACXS,UAAUG,KAAK;IAEnB;IAEA,MAIMC,eACJ,AAAWlB,GAAQ,EACnB,AAAaK,EAAU,EACvB,AAAQS,SAA+C,EACvD;QACA,OAAO,IAAI,CAACZ,uBAAuB,CAACiB,gCAAgC,CAClEd,IACAS,UAAUM,QAAQ,EAClBpB,IAAII,IAAI,CAACC,EAAE,EACXS,UAAUG,KAAK;IAEnB;IAEA,MAIMI,WACJ,AAAWrB,GAAQ,EACnB,AAAaK,EAAU,EACvB,AAAQiB,UAA+B,EACvC;QACA,OAAO,IAAI,CAACpB,uBAAuB,CAACqB,qBAAqB,CAAClB,IAAIL,IAAII,IAAI,CAACC,EAAE,EAAEiB,WAAWE,OAAO;IAC/F;IA3EA,YACE,AAAiBf,eAAgC,EACjD,AAAiBP,uBAAgD,CACjE;aAFiBO,kBAAAA;aACAP,0BAAAA;IAChB;AAyEL;;;iDAtEkBuB;;QACAC,SAAS;;;QACVV,QAAQ;QAAKW,aAAa;;;;;;;;;;;;;iDAMzBF,0BAAiBG,4BAAmBC;;QACpCH,SAAS;;;QACVV,QAAQ;QAAKW,aAAa;;;;;;;;;;;;QASzBD,SAAS;;;QACVV,QAAQ;QAAKW,aAAa;;;;;;;;;;;;;iDAMzBC,4BAAmBC;;QACnBH,SAAS;;;QACVV,QAAQ;QAAKW,aAAa;;;;;;;;;;;;;;;iDAezBC,4BAAmBC;;QACnBH,SAAS;;;QACVV,QAAQ;QAAKW,aAAa;;;;;;;;;;;;;;;iDAezBF,0BAAiBG,4BAAmBC;;QACpCH,SAAS;;;QACVV,QAAQ;QAAKW,aAAa"}