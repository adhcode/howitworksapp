{"version":3,"sources":["../../src/email/email.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { Resend } from 'resend';\nimport { ConfigService } from '@nestjs/config';\n\n@Injectable()\nexport class EmailService {\n  private readonly logger = new Logger(EmailService.name);\n  private resend: Resend;\n\n  constructor(private configService: ConfigService) {\n    this.initializeResend();\n  }\n\n  private initializeResend() {\n    const resendApiKey = this.configService.get<string>('RESEND_API_KEY');\n\n    if (!resendApiKey) {\n      this.logger.warn('RESEND_API_KEY not found. Email functionality will be disabled.');\n      return;\n    }\n\n    this.resend = new Resend(resendApiKey);\n  }\n\n  async sendVerificationEmail(email: string, firstName: string, token: string): Promise<void> {\n    if (!this.resend) {\n      this.logger.warn('Resend not configured. Skipping email send.');\n      return;\n    }\n\n    const verificationUrl = `${this.configService.get('FRONTEND_URL', 'http://localhost:8081')}/auth/verify-email?token=${token}`;\n\n    try {\n      const { data, error } = await this.resend.emails.send({\n        from: this.configService.get('RESEND_FROM_EMAIL', 'HowitWorks <noreply@howitworks.com.ng>'),\n        to: [email],\n        subject: 'Verify Your Email Address - HowitWorks',\n        html: `\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Verify Your Email - HowitWorks</title>\n          </head>\n          <body style=\"margin: 0; padding: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n            <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f5f5f5;\">\n              <tr>\n                <td align=\"center\" style=\"padding: 40px 20px;\">\n                  <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n                    \n                    <!-- Header with Navy Blue Background -->\n                    <tr>\n                      <td style=\"background: linear-gradient(135deg, #1A2A52 0%, #2d4575 100%); padding: 40px 30px; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                          HowitWorks\n                        </h1>\n                        <p style=\"color: #e0e7ff; margin: 8px 0 0 0; font-size: 14px; font-weight: 400;\">\n                          Property Management Made Simple\n                        </p>\n                      </td>\n                    </tr>\n                    \n                    <!-- Content -->\n                    <tr>\n                      <td style=\"padding: 40px 30px;\">\n                        <h2 style=\"color: #1A2A52; margin: 0 0 20px 0; font-size: 24px; font-weight: 600;\">\n                          Welcome, ${firstName}! üëã\n                        </h2>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 20px 0; font-size: 16px;\">\n                          Thank you for joining HowitWorks! We're excited to have you on board.\n                        </p>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px;\">\n                          To complete your registration and secure your account, please verify your email address by clicking the button below:\n                        </p>\n                        \n                        <!-- CTA Button -->\n                        <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                          <tr>\n                            <td align=\"center\" style=\"padding: 0 0 30px 0;\">\n                              <a href=\"${verificationUrl}\" \n                                 style=\"display: inline-block; background-color: #1A2A52; color: #ffffff; \n                                        padding: 16px 40px; text-decoration: none; border-radius: 8px; \n                                        font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px rgba(26, 42, 82, 0.2);\">\n                                Verify Email Address\n                              </a>\n                            </td>\n                          </tr>\n                        </table>\n                        \n                        <!-- Alternative Link -->\n                        <div style=\"background-color: #f9fafb; border-left: 4px solid #1A2A52; padding: 16px; border-radius: 4px; margin: 0 0 30px 0;\">\n                          <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0; font-weight: 600;\">\n                            Button not working?\n                          </p>\n                          <p style=\"color: #6b7280; font-size: 13px; margin: 0; line-height: 1.5;\">\n                            Copy and paste this link into your browser:\n                          </p>\n                          <p style=\"margin: 8px 0 0 0;\">\n                            <a href=\"${verificationUrl}\" style=\"color: #1A2A52; word-break: break-all; font-size: 13px;\">\n                              ${verificationUrl}\n                            </a>\n                          </p>\n                        </div>\n                        \n                        <!-- Security Note -->\n                        <div style=\"border-top: 1px solid #e5e7eb; padding-top: 20px;\">\n                          <p style=\"color: #9ca3af; font-size: 13px; line-height: 1.5; margin: 0;\">\n                            <strong>Security Note:</strong> This verification link will expire in 24 hours. \n                            If you didn't create an account with HowitWorks, you can safely ignore this email.\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n                        <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0;\">\n                          ¬© 2025 HowitWorks. All rights reserved.\n                        </p>\n                        <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">\n                          Property Management Platform\n                        </p>\n                      </td>\n                    </tr>\n                    \n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n      });\n\n      if (error) {\n        this.logger.error(`Resend API error:`, error);\n        throw new Error(`Failed to send verification email: ${error.message}`);\n      }\n\n      this.logger.log(`Verification email sent to ${email}. Message ID: ${data?.id}`);\n    } catch (error) {\n      this.logger.error(`Failed to send verification email to ${email}:`, error);\n      throw error;\n    }\n  }\n\n  async sendVerificationCodeEmail(email: string, firstName: string, code: string): Promise<void> {\n    if (!this.resend) {\n      this.logger.warn('Resend not configured. Skipping email send.');\n      return;\n    }\n\n    try {\n      const { data, error } = await this.resend.emails.send({\n        from: this.configService.get('RESEND_FROM_EMAIL', 'HowitWorks <noreply@howitworks.com.ng>'),\n        to: [email],\n        subject: 'Verify Your Email Address - HowitWorks',\n        html: `\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Verify Your Email - HowitWorks</title>\n          </head>\n          <body style=\"margin: 0; padding: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n            <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f5f5f5;\">\n              <tr>\n                <td align=\"center\" style=\"padding: 40px 20px;\">\n                  <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n                    \n                    <!-- Header with Navy Blue Background -->\n                    <tr>\n                      <td style=\"background: linear-gradient(135deg, #1A2A52 0%, #2d4575 100%); padding: 40px 30px; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                          HowitWorks\n                        </h1>\n                        <p style=\"color: #e0e7ff; margin: 8px 0 0 0; font-size: 14px; font-weight: 400;\">\n                          Property Management Made Simple\n                        </p>\n                      </td>\n                    </tr>\n                    \n                    <!-- Content -->\n                    <tr>\n                      <td style=\"padding: 40px 30px;\">\n                        <h2 style=\"color: #1A2A52; margin: 0 0 20px 0; font-size: 24px; font-weight: 600;\">\n                          Welcome, ${firstName}! üëã\n                        </h2>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 20px 0; font-size: 16px;\">\n                          Thank you for joining HowitWorks! We're excited to have you on board.\n                        </p>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px;\">\n                          To complete your registration and secure your account, please enter the verification code below in the app:\n                        </p>\n                        \n                        <!-- Verification Code -->\n                        <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                          <tr>\n                            <td align=\"center\" style=\"padding: 0 0 30px 0;\">\n                              <div style=\"background-color: #f9fafb; border: 2px dashed #1A2A52; border-radius: 12px; padding: 24px; display: inline-block;\">\n                                <p style=\"color: #6b7280; font-size: 14px; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;\">\n                                  Your Verification Code\n                                </p>\n                                <p style=\"color: #1A2A52; font-size: 36px; font-weight: 700; margin: 0; letter-spacing: 8px; font-family: 'Courier New', monospace;\">\n                                  ${code}\n                                </p>\n                              </div>\n                            </td>\n                          </tr>\n                        </table>\n                        \n                        <!-- Instructions -->\n                        <div style=\"background-color: #f9fafb; border-left: 4px solid #1A2A52; padding: 16px; border-radius: 4px; margin: 0 0 30px 0;\">\n                          <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0; font-weight: 600;\">\n                            How to verify:\n                          </p>\n                          <ol style=\"color: #6b7280; font-size: 13px; margin: 0; padding-left: 20px; line-height: 1.8;\">\n                            <li>Open the HowitWorks app</li>\n                            <li>Enter the 6-digit code above</li>\n                            <li>Click \"Verify\" to complete your registration</li>\n                          </ol>\n                        </div>\n                        \n                        <!-- Security Note -->\n                        <div style=\"border-top: 1px solid #e5e7eb; padding-top: 20px;\">\n                          <p style=\"color: #9ca3af; font-size: 13px; line-height: 1.5; margin: 0;\">\n                            <strong>Security Note:</strong> This verification code will expire in 15 minutes. \n                            If you didn't create an account with HowitWorks, you can safely ignore this email.\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n                        <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0;\">\n                          ¬© 2025 HowitWorks. All rights reserved.\n                        </p>\n                        <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">\n                          Property Management Platform\n                        </p>\n                      </td>\n                    </tr>\n                    \n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n      });\n\n      if (error) {\n        this.logger.error(`Resend API error:`, error);\n        throw new Error(`Failed to send verification email: ${error.message}`);\n      }\n\n      this.logger.log(`Verification code email sent to ${email}. Message ID: ${data?.id}`);\n    } catch (error) {\n      this.logger.error(`Failed to send verification code email to ${email}:`, error);\n      throw error;\n    }\n  }\n\n  async sendWelcomeEmail(email: string, firstName: string): Promise<void> {\n    if (!this.resend) {\n      this.logger.warn('Resend not configured. Skipping email send.');\n      return;\n    }\n\n    try {\n      const { data, error } = await this.resend.emails.send({\n        from: this.configService.get('RESEND_FROM_EMAIL', 'HowitWorks <noreply@howitworks.com.ng>'),\n        to: [email],\n        subject: 'Welcome to HowitWorks! üéâ',\n        html: `\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Welcome to HowitWorks</title>\n          </head>\n          <body style=\"margin: 0; padding: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n            <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f5f5f5;\">\n              <tr>\n                <td align=\"center\" style=\"padding: 40px 20px;\">\n                  <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n                    \n                    <!-- Header with Navy Blue Background -->\n                    <tr>\n                      <td style=\"background: linear-gradient(135deg, #1A2A52 0%, #2d4575 100%); padding: 40px 30px; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                          HowitWorks\n                        </h1>\n                        <p style=\"color: #e0e7ff; margin: 8px 0 0 0; font-size: 14px; font-weight: 400;\">\n                          Property Management Made Simple\n                        </p>\n                      </td>\n                    </tr>\n                    \n                    <!-- Content -->\n                    <tr>\n                      <td style=\"padding: 40px 30px;\">\n                        <div style=\"text-align: center; margin-bottom: 30px;\">\n                          <span style=\"font-size: 48px;\">üéâ</span>\n                        </div>\n                        \n                        <h2 style=\"color: #1A2A52; margin: 0 0 20px 0; font-size: 24px; font-weight: 600; text-align: center;\">\n                          Welcome to HowitWorks, ${firstName}!\n                        </h2>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px; text-align: center;\">\n                          Your email has been verified successfully! You're all set to start managing your properties.\n                        </p>\n                        \n                        <!-- Features -->\n                        <div style=\"background-color: #f9fafb; border-radius: 8px; padding: 24px; margin: 0 0 30px 0;\">\n                          <h3 style=\"color: #1A2A52; margin: 0 0 16px 0; font-size: 18px; font-weight: 600;\">\n                            What you can do now:\n                          </h3>\n                          \n                          <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                            <tr>\n                              <td style=\"padding: 8px 0;\">\n                                <span style=\"color: #1A2A52; font-size: 18px; margin-right: 12px;\">‚úì</span>\n                                <span style=\"color: #4b5563; font-size: 15px;\">Manage your properties and tenants</span>\n                              </td>\n                            </tr>\n                            <tr>\n                              <td style=\"padding: 8px 0;\">\n                                <span style=\"color: #1A2A52; font-size: 18px; margin-right: 12px;\">‚úì</span>\n                                <span style=\"color: #4b5563; font-size: 15px;\">Track maintenance requests</span>\n                              </td>\n                            </tr>\n                            <tr>\n                              <td style=\"padding: 8px 0;\">\n                                <span style=\"color: #1A2A52; font-size: 18px; margin-right: 12px;\">‚úì</span>\n                                <span style=\"color: #4b5563; font-size: 15px;\">Handle payments seamlessly</span>\n                              </td>\n                            </tr>\n                            <tr>\n                              <td style=\"padding: 8px 0;\">\n                                <span style=\"color: #1A2A52; font-size: 18px; margin-right: 12px;\">‚úì</span>\n                                <span style=\"color: #4b5563; font-size: 15px;\">Communicate with ease</span>\n                              </td>\n                            </tr>\n                          </table>\n                        </div>\n                        \n                        <!-- CTA Button -->\n                        <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                          <tr>\n                            <td align=\"center\" style=\"padding: 0 0 30px 0;\">\n                              <a href=\"${this.configService.get('FRONTEND_URL', 'http://localhost:8081')}\" \n                                 style=\"display: inline-block; background-color: #1A2A52; color: #ffffff; \n                                        padding: 16px 40px; text-decoration: none; border-radius: 8px; \n                                        font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px rgba(26, 42, 82, 0.2);\">\n                                Get Started Now\n                              </a>\n                            </td>\n                          </tr>\n                        </table>\n                        \n                        <!-- Support -->\n                        <div style=\"border-top: 1px solid #e5e7eb; padding-top: 20px; text-align: center;\">\n                          <p style=\"color: #6b7280; font-size: 14px; margin: 0;\">\n                            Need help? We're here for you!\n                          </p>\n                          <p style=\"color: #9ca3af; font-size: 13px; margin: 8px 0 0 0;\">\n                            Contact our support team anytime\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n                        <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0;\">\n                          ¬© 2025 HowitWorks. All rights reserved.\n                        </p>\n                        <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">\n                          Property Management Platform\n                        </p>\n                      </td>\n                    </tr>\n                    \n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n      });\n\n      if (error) {\n        this.logger.error(`Resend API error:`, error);\n        throw new Error(`Failed to send welcome email: ${error.message}`);\n      }\n\n      this.logger.log(`Welcome email sent to ${email}. Message ID: ${data?.id}`);\n    } catch (error) {\n      this.logger.error(`Failed to send welcome email to ${email}:`, error);\n    }\n  }\n\n  async sendPaymentReminderEmail(\n    email: string,\n    firstName: string,\n    title: string,\n    message: string,\n    amount?: number,\n    dueDate?: string,\n  ): Promise<void> {\n    if (!this.resend) {\n      this.logger.warn('Resend not configured. Skipping email send.');\n      return;\n    }\n\n    try {\n      const { data, error } = await this.resend.emails.send({\n        from: this.configService.get('RESEND_FROM_EMAIL', 'HowitWorks <noreply@howitworks.com.ng>'),\n        to: [email],\n        subject: title,\n        html: `\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>${title}</title>\n          </head>\n          <body style=\"margin: 0; padding: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n            <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f5f5f5;\">\n              <tr>\n                <td align=\"center\" style=\"padding: 40px 20px;\">\n                  <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n                    \n                    <!-- Header -->\n                    <tr>\n                      <td style=\"background: linear-gradient(135deg, #1A2A52 0%, #2d4575 100%); padding: 40px 30px; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                          HowitWorks\n                        </h1>\n                        <p style=\"color: #e0e7ff; margin: 8px 0 0 0; font-size: 14px; font-weight: 400;\">\n                          Property Management Made Simple\n                        </p>\n                      </td>\n                    </tr>\n                    \n                    <!-- Content -->\n                    <tr>\n                      <td style=\"padding: 40px 30px;\">\n                        <h2 style=\"color: #1A2A52; margin: 0 0 20px 0; font-size: 24px; font-weight: 600;\">\n                          ${title}\n                        </h2>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 16px 0; font-size: 16px;\">\n                          Hi ${firstName},\n                        </p>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px;\">\n                          ${message}\n                        </p>\n                        \n                        ${amount ? `\n                        <!-- Payment Details -->\n                        <div style=\"background-color: #f9fafb; border-radius: 8px; padding: 24px; margin: 0 0 30px 0;\">\n                          <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                            <tr>\n                              <td style=\"padding: 8px 0; color: #6b7280; font-size: 14px;\">Amount Due:</td>\n                              <td style=\"padding: 8px 0; color: #1A2A52; font-size: 18px; font-weight: 700; text-align: right;\">‚Ç¶${amount.toLocaleString()}</td>\n                            </tr>\n                            ${dueDate ? `\n                            <tr>\n                              <td style=\"padding: 8px 0; color: #6b7280; font-size: 14px;\">Due Date:</td>\n                              <td style=\"padding: 8px 0; color: #1A2A52; font-size: 16px; font-weight: 600; text-align: right;\">${new Date(dueDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</td>\n                            </tr>\n                            ` : ''}\n                          </table>\n                        </div>\n                        ` : ''}\n                        \n                        <!-- CTA Button -->\n                        <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                          <tr>\n                            <td align=\"center\" style=\"padding: 0 0 30px 0;\">\n                              <a href=\"${this.configService.get('FRONTEND_URL', 'http://localhost:8081')}\" \n                                 style=\"display: inline-block; background-color: #1A2A52; color: #ffffff; \n                                        padding: 16px 40px; text-decoration: none; border-radius: 8px; \n                                        font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px rgba(26, 42, 82, 0.2);\">\n                                Make Payment\n                              </a>\n                            </td>\n                          </tr>\n                        </table>\n                        \n                        <!-- Support -->\n                        <div style=\"border-top: 1px solid #e5e7eb; padding-top: 20px;\">\n                          <p style=\"color: #9ca3af; font-size: 13px; line-height: 1.5; margin: 0;\">\n                            If you have any questions or need assistance, please contact our support team.\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n                        <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0;\">\n                          ¬© 2025 HowitWorks. All rights reserved.\n                        </p>\n                        <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">\n                          Property Management Platform\n                        </p>\n                      </td>\n                    </tr>\n                    \n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n      });\n\n      if (error) {\n        this.logger.error(`Resend API error:`, error);\n        throw new Error(`Failed to send payment reminder email: ${error.message}`);\n      }\n\n      this.logger.log(`Payment reminder email sent to ${email}. Message ID: ${data?.id}`);\n    } catch (error) {\n      this.logger.error(`Failed to send payment reminder email to ${email}:`, error);\n      throw error;\n    }\n  }\n\n  async sendPasswordResetEmail(email: string, firstName: string, token: string): Promise<void> {\n    if (!this.resend) {\n      this.logger.warn('Resend not configured. Skipping email send.');\n      return;\n    }\n\n    const resetUrl = `${this.configService.get('FRONTEND_URL', 'http://localhost:8081')}/auth/reset-password?token=${token}`;\n\n    try {\n      const { data, error } = await this.resend.emails.send({\n        from: this.configService.get('RESEND_FROM_EMAIL', 'HowitWorks <noreply@howitworks.com.ng>'),\n        to: [email],\n        subject: 'Reset Your Password - HowitWorks',\n        html: `\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Reset Your Password - HowitWorks</title>\n          </head>\n          <body style=\"margin: 0; padding: 0; background-color: #f5f5f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n            <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f5f5f5;\">\n              <tr>\n                <td align=\"center\" style=\"padding: 40px 20px;\">\n                  <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n                    \n                    <!-- Header with Navy Blue Background -->\n                    <tr>\n                      <td style=\"background: linear-gradient(135deg, #1A2A52 0%, #2d4575 100%); padding: 40px 30px; text-align: center;\">\n                        <h1 style=\"color: #ffffff; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                          HowitWorks\n                        </h1>\n                        <p style=\"color: #e0e7ff; margin: 8px 0 0 0; font-size: 14px; font-weight: 400;\">\n                          Property Management Made Simple\n                        </p>\n                      </td>\n                    </tr>\n                    \n                    <!-- Content -->\n                    <tr>\n                      <td style=\"padding: 40px 30px;\">\n                        <div style=\"text-align: center; margin-bottom: 30px;\">\n                          <span style=\"font-size: 48px;\">üîê</span>\n                        </div>\n                        \n                        <h2 style=\"color: #1A2A52; margin: 0 0 20px 0; font-size: 24px; font-weight: 600;\">\n                          Reset Your Password\n                        </h2>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 16px 0; font-size: 16px;\">\n                          Hi ${firstName},\n                        </p>\n                        \n                        <p style=\"color: #4b5563; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px;\">\n                          We received a request to reset your password. Click the button below to create a new password:\n                        </p>\n                        \n                        <!-- CTA Button -->\n                        <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                          <tr>\n                            <td align=\"center\" style=\"padding: 0 0 30px 0;\">\n                              <a href=\"${resetUrl}\" \n                                 style=\"display: inline-block; background-color: #1A2A52; color: #ffffff; \n                                        padding: 16px 40px; text-decoration: none; border-radius: 8px; \n                                        font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px rgba(26, 42, 82, 0.2);\">\n                                Reset Password\n                              </a>\n                            </td>\n                          </tr>\n                        </table>\n                        \n                        <!-- Alternative Link -->\n                        <div style=\"background-color: #f9fafb; border-left: 4px solid #1A2A52; padding: 16px; border-radius: 4px; margin: 0 0 30px 0;\">\n                          <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0; font-weight: 600;\">\n                            Button not working?\n                          </p>\n                          <p style=\"color: #6b7280; font-size: 13px; margin: 0; line-height: 1.5;\">\n                            Copy and paste this link into your browser:\n                          </p>\n                          <p style=\"margin: 8px 0 0 0;\">\n                            <a href=\"${resetUrl}\" style=\"color: #1A2A52; word-break: break-all; font-size: 13px;\">\n                              ${resetUrl}\n                            </a>\n                          </p>\n                        </div>\n                        \n                        <!-- Security Warning -->\n                        <div style=\"background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 4px; margin: 0 0 20px 0;\">\n                          <p style=\"color: #92400e; font-size: 13px; margin: 0; line-height: 1.5;\">\n                            <strong>‚ö†Ô∏è Security Notice:</strong> This password reset link will expire in 1 hour. \n                            If you didn't request a password reset, please ignore this email and your password will remain unchanged.\n                          </p>\n                        </div>\n                        \n                        <!-- Support -->\n                        <div style=\"border-top: 1px solid #e5e7eb; padding-top: 20px;\">\n                          <p style=\"color: #9ca3af; font-size: 13px; line-height: 1.5; margin: 0;\">\n                            If you're having trouble or didn't request this reset, please contact our support team immediately.\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"background-color: #f9fafb; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n                        <p style=\"color: #6b7280; font-size: 13px; margin: 0 0 8px 0;\">\n                          ¬© 2025 HowitWorks. All rights reserved.\n                        </p>\n                        <p style=\"color: #9ca3af; font-size: 12px; margin: 0;\">\n                          Property Management Platform\n                        </p>\n                      </td>\n                    </tr>\n                    \n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n      });\n\n      if (error) {\n        this.logger.error(`Resend API error:`, error);\n        throw new Error(`Failed to send password reset email: ${error.message}`);\n      }\n\n      this.logger.log(`Password reset email sent to ${email}. Message ID: ${data?.id}`);\n    } catch (error) {\n      this.logger.error(`Failed to send password reset email to ${email}:`, error);\n      throw error;\n    }\n  }\n}"],"names":["EmailService","initializeResend","resendApiKey","configService","get","logger","warn","resend","Resend","sendVerificationEmail","email","firstName","token","verificationUrl","data","error","emails","send","from","to","subject","html","Error","message","log","id","sendVerificationCodeEmail","code","sendWelcomeEmail","sendPaymentReminderEmail","title","amount","dueDate","toLocaleString","Date","toLocaleDateString","year","month","day","sendPasswordResetEmail","resetUrl","Logger","name"],"mappings":"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"}