{"version":3,"sources":["../../../src/common/interceptors/logging.interceptor.ts"],"sourcesContent":["import {\n  Injectable,\n  NestInterceptor,\n  ExecutionContext,\n  CallHandler,\n  Logger,\n} from '@nestjs/common';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { FastifyRequest } from 'fastify';\n\n@Injectable()\nexport class LoggingInterceptor implements NestInterceptor {\n  private readonly logger = new Logger(LoggingInterceptor.name);\n\n  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {\n    const request = context.switchToHttp().getRequest<FastifyRequest>();\n    const { method, url, headers, body } = request;\n    const userAgent = headers['user-agent'] || '';\n    const ip = request.ip;\n\n    this.logger.log(\n      `Incoming Request: ${method} ${url} - ${ip} - ${userAgent}`,\n    );\n\n    // Log request body for non-GET requests (excluding sensitive data)\n    if (method !== 'GET' && body) {\n      const sanitizedBody = this.sanitizeBody(body);\n      this.logger.debug(`Request Body: ${JSON.stringify(sanitizedBody)}`);\n    }\n\n    const startTime = Date.now();\n\n    return next.handle().pipe(\n      tap({\n        next: (data) => {\n          const duration = Date.now() - startTime;\n          this.logger.log(\n            `Outgoing Response: ${method} ${url} - ${duration}ms`,\n          );\n        },\n        error: (error) => {\n          const duration = Date.now() - startTime;\n          this.logger.error(\n            `Request Failed: ${method} ${url} - ${duration}ms - ${error.message}`,\n          );\n        },\n      }),\n    );\n  }\n\n  private sanitizeBody(body: any): any {\n    if (!body || typeof body !== 'object') return body;\n\n    const sensitiveFields = ['password', 'token', 'secret', 'key', 'auth'];\n    const sanitized = { ...body };\n\n    for (const field of sensitiveFields) {\n      if (sanitized[field]) {\n        sanitized[field] = '[REDACTED]';\n      }\n    }\n\n    return sanitized;\n  }\n}"],"names":["LoggingInterceptor","intercept","context","next","request","switchToHttp","getRequest","method","url","headers","body","userAgent","ip","logger","log","sanitizedBody","sanitizeBody","debug","JSON","stringify","startTime","Date","now","handle","pipe","tap","data","duration","error","message","sensitiveFields","sanitized","field","Logger","name"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBANN;2BAEa;;;;;;;AAIb,IAAA,AAAMA,qBAAN,MAAMA;IAGXC,UAAUC,OAAyB,EAAEC,IAAiB,EAAmB;QACvE,MAAMC,UAAUF,QAAQG,YAAY,GAAGC,UAAU;QACjD,MAAM,EAAEC,MAAM,EAAEC,GAAG,EAAEC,OAAO,EAAEC,IAAI,EAAE,GAAGN;QACvC,MAAMO,YAAYF,OAAO,CAAC,aAAa,IAAI;QAC3C,MAAMG,KAAKR,QAAQQ,EAAE;QAErB,IAAI,CAACC,MAAM,CAACC,GAAG,CACb,CAAC,kBAAkB,EAAEP,OAAO,CAAC,EAAEC,IAAI,GAAG,EAAEI,GAAG,GAAG,EAAED,WAAW;QAG7D,mEAAmE;QACnE,IAAIJ,WAAW,SAASG,MAAM;YAC5B,MAAMK,gBAAgB,IAAI,CAACC,YAAY,CAACN;YACxC,IAAI,CAACG,MAAM,CAACI,KAAK,CAAC,CAAC,cAAc,EAAEC,KAAKC,SAAS,CAACJ,gBAAgB;QACpE;QAEA,MAAMK,YAAYC,KAAKC,GAAG;QAE1B,OAAOnB,KAAKoB,MAAM,GAAGC,IAAI,CACvBC,IAAAA,cAAG,EAAC;YACFtB,MAAM,CAACuB;gBACL,MAAMC,WAAWN,KAAKC,GAAG,KAAKF;gBAC9B,IAAI,CAACP,MAAM,CAACC,GAAG,CACb,CAAC,mBAAmB,EAAEP,OAAO,CAAC,EAAEC,IAAI,GAAG,EAAEmB,SAAS,EAAE,CAAC;YAEzD;YACAC,OAAO,CAACA;gBACN,MAAMD,WAAWN,KAAKC,GAAG,KAAKF;gBAC9B,IAAI,CAACP,MAAM,CAACe,KAAK,CACf,CAAC,gBAAgB,EAAErB,OAAO,CAAC,EAAEC,IAAI,GAAG,EAAEmB,SAAS,KAAK,EAAEC,MAAMC,OAAO,EAAE;YAEzE;QACF;IAEJ;IAEQb,aAAaN,IAAS,EAAO;QACnC,IAAI,CAACA,QAAQ,OAAOA,SAAS,UAAU,OAAOA;QAE9C,MAAMoB,kBAAkB;YAAC;YAAY;YAAS;YAAU;YAAO;SAAO;QACtE,MAAMC,YAAY;YAAE,GAAGrB,IAAI;QAAC;QAE5B,KAAK,MAAMsB,SAASF,gBAAiB;YACnC,IAAIC,SAAS,CAACC,MAAM,EAAE;gBACpBD,SAAS,CAACC,MAAM,GAAG;YACrB;QACF;QAEA,OAAOD;IACT;;aAnDiBlB,SAAS,IAAIoB,cAAM,CAACjC,mBAAmBkC,IAAI;;AAoD9D"}