{"version":3,"sources":["../../../src/common/interceptors/response.interceptor.ts"],"sourcesContent":["import {\n  Injectable,\n  NestInterceptor,\n  ExecutionContext,\n  CallHandler,\n  Logger,\n} from '@nestjs/common';\nimport { Observable } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { FastifyRequest } from 'fastify';\n\nexport interface ApiResponse<T> {\n  statusCode: number;\n  message: string;\n  data: T;\n  timestamp: string;\n  path: string;\n}\n\n@Injectable()\nexport class ResponseInterceptor<T> implements NestInterceptor<T, ApiResponse<T>> {\n  private readonly logger = new Logger(ResponseInterceptor.name);\n\n  intercept(context: ExecutionContext, next: CallHandler): Observable<ApiResponse<T>> {\n    const request = context.switchToHttp().getRequest<FastifyRequest>();\n    const startTime = Date.now();\n\n    return next.handle().pipe(\n      tap(() => {\n        const duration = Date.now() - startTime;\n        this.logger.log(\n          `${request.method} ${request.url} - ${context.switchToHttp().getResponse().statusCode} - ${duration}ms`,\n        );\n      }),\n      map((data) => ({\n        statusCode: context.switchToHttp().getResponse().statusCode || 200,\n        message: this.getSuccessMessage(request.method),\n        data,\n        timestamp: new Date().toISOString(),\n        path: request.url,\n      })),\n    );\n  }\n\n  private getSuccessMessage(method: string): string {\n    switch (method) {\n      case 'POST':\n        return 'Resource created successfully';\n      case 'PUT':\n      case 'PATCH':\n        return 'Resource updated successfully';\n      case 'DELETE':\n        return 'Resource deleted successfully';\n      case 'GET':\n      default:\n        return 'Request processed successfully';\n    }\n  }\n}"],"names":["ResponseInterceptor","intercept","context","next","request","switchToHttp","getRequest","startTime","Date","now","handle","pipe","tap","duration","logger","log","method","url","getResponse","statusCode","map","data","message","getSuccessMessage","timestamp","toISOString","path","Logger","name"],"mappings":";;;;+BAoBaA;;;eAAAA;;;wBAdN;2BAEkB;;;;;;;AAYlB,IAAA,AAAMA,sBAAN,MAAMA;IAGXC,UAAUC,OAAyB,EAAEC,IAAiB,EAA8B;QAClF,MAAMC,UAAUF,QAAQG,YAAY,GAAGC,UAAU;QACjD,MAAMC,YAAYC,KAAKC,GAAG;QAE1B,OAAON,KAAKO,MAAM,GAAGC,IAAI,CACvBC,IAAAA,cAAG,EAAC;YACF,MAAMC,WAAWL,KAAKC,GAAG,KAAKF;YAC9B,IAAI,CAACO,MAAM,CAACC,GAAG,CACb,GAAGX,QAAQY,MAAM,CAAC,CAAC,EAAEZ,QAAQa,GAAG,CAAC,GAAG,EAAEf,QAAQG,YAAY,GAAGa,WAAW,GAAGC,UAAU,CAAC,GAAG,EAAEN,SAAS,EAAE,CAAC;QAE3G,IACAO,IAAAA,cAAG,EAAC,CAACC,OAAU,CAAA;gBACbF,YAAYjB,QAAQG,YAAY,GAAGa,WAAW,GAAGC,UAAU,IAAI;gBAC/DG,SAAS,IAAI,CAACC,iBAAiB,CAACnB,QAAQY,MAAM;gBAC9CK;gBACAG,WAAW,IAAIhB,OAAOiB,WAAW;gBACjCC,MAAMtB,QAAQa,GAAG;YACnB,CAAA;IAEJ;IAEQM,kBAAkBP,MAAc,EAAU;QAChD,OAAQA;YACN,KAAK;gBACH,OAAO;YACT,KAAK;YACL,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;YACL;gBACE,OAAO;QACX;IACF;;aApCiBF,SAAS,IAAIa,cAAM,CAAC3B,oBAAoB4B,IAAI;;AAqC/D"}