{"version":3,"sources":["../../../src/common/filters/global-exception.filter.ts"],"sourcesContent":["import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Logger,\n} from '@nestjs/common';\nimport { FastifyRequest, FastifyReply } from 'fastify';\n\n@Catch()\nexport class GlobalExceptionFilter implements ExceptionFilter {\n  private readonly logger = new Logger(GlobalExceptionFilter.name);\n\n  catch(exception: unknown, host: ArgumentsHost): void {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<FastifyReply>();\n    const request = ctx.getRequest<FastifyRequest>();\n\n    let status: number;\n    let message: string | object;\n    let error: string;\n\n    if (exception instanceof HttpException) {\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n      \n      if (typeof exceptionResponse === 'string') {\n        message = exceptionResponse;\n        error = exception.name;\n      } else {\n        message = (exceptionResponse as any).message || exceptionResponse;\n        error = (exceptionResponse as any).error || exception.name;\n      }\n    } else {\n      status = HttpStatus.INTERNAL_SERVER_ERROR;\n      message = 'Internal server error';\n      error = 'InternalServerError';\n      \n      // Log unexpected errors\n      this.logger.error(\n        `Unexpected error: ${exception}`,\n        exception instanceof Error ? exception.stack : undefined,\n      );\n    }\n\n    const errorResponse = {\n      statusCode: status,\n      timestamp: new Date().toISOString(),\n      path: request.url,\n      method: request.method,\n      error,\n      message,\n    };\n\n    // Log error details\n    this.logger.error(\n      `${request.method} ${request.url} - ${status} - ${JSON.stringify(message)}`,\n    );\n\n    response.status(status).send(errorResponse);\n  }\n}"],"names":["GlobalExceptionFilter","catch","exception","host","ctx","switchToHttp","response","getResponse","request","getRequest","status","message","error","HttpException","getStatus","exceptionResponse","name","HttpStatus","INTERNAL_SERVER_ERROR","logger","Error","stack","undefined","errorResponse","statusCode","timestamp","Date","toISOString","path","url","method","JSON","stringify","send","Logger"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAJN;;;;;;;AAIA,IAAA,AAAMA,wBAAN,MAAMA;IAGXC,MAAMC,SAAkB,EAAEC,IAAmB,EAAQ;QACnD,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,WAAWF,IAAIG,WAAW;QAChC,MAAMC,UAAUJ,IAAIK,UAAU;QAE9B,IAAIC;QACJ,IAAIC;QACJ,IAAIC;QAEJ,IAAIV,qBAAqBW,qBAAa,EAAE;YACtCH,SAASR,UAAUY,SAAS;YAC5B,MAAMC,oBAAoBb,UAAUK,WAAW;YAE/C,IAAI,OAAOQ,sBAAsB,UAAU;gBACzCJ,UAAUI;gBACVH,QAAQV,UAAUc,IAAI;YACxB,OAAO;gBACLL,UAAU,AAACI,kBAA0BJ,OAAO,IAAII;gBAChDH,QAAQ,AAACG,kBAA0BH,KAAK,IAAIV,UAAUc,IAAI;YAC5D;QACF,OAAO;YACLN,SAASO,kBAAU,CAACC,qBAAqB;YACzCP,UAAU;YACVC,QAAQ;YAER,wBAAwB;YACxB,IAAI,CAACO,MAAM,CAACP,KAAK,CACf,CAAC,kBAAkB,EAAEV,WAAW,EAChCA,qBAAqBkB,QAAQlB,UAAUmB,KAAK,GAAGC;QAEnD;QAEA,MAAMC,gBAAgB;YACpBC,YAAYd;YACZe,WAAW,IAAIC,OAAOC,WAAW;YACjCC,MAAMpB,QAAQqB,GAAG;YACjBC,QAAQtB,QAAQsB,MAAM;YACtBlB;YACAD;QACF;QAEA,oBAAoB;QACpB,IAAI,CAACQ,MAAM,CAACP,KAAK,CACf,GAAGJ,QAAQsB,MAAM,CAAC,CAAC,EAAEtB,QAAQqB,GAAG,CAAC,GAAG,EAAEnB,OAAO,GAAG,EAAEqB,KAAKC,SAAS,CAACrB,UAAU;QAG7EL,SAASI,MAAM,CAACA,QAAQuB,IAAI,CAACV;IAC/B;;aAjDiBJ,SAAS,IAAIe,cAAM,CAAClC,sBAAsBgB,IAAI;;AAkDjE"}