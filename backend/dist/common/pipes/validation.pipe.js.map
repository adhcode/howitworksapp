{"version":3,"sources":["../../../src/common/pipes/validation.pipe.ts"],"sourcesContent":["import {\n  PipeTransform,\n  Injectable,\n  ArgumentMetadata,\n  BadRequestException,\n} from '@nestjs/common';\nimport { validate } from 'class-validator';\nimport { plainToInstance } from 'class-transformer';\n\n@Injectable()\nexport class ValidationPipe implements PipeTransform<any> {\n  async transform(value: any, { metatype }: ArgumentMetadata) {\n    if (!metatype || !this.toValidate(metatype)) {\n      return value;\n    }\n\n    const object = plainToInstance(metatype, value);\n    const errors = await validate(object);\n\n    if (errors.length > 0) {\n      const errorMessages = errors.map((error) => {\n        return Object.values(error.constraints || {}).join(', ');\n      });\n\n      throw new BadRequestException({\n        message: 'Validation failed',\n        errors: errorMessages,\n      });\n    }\n\n    return object;\n  }\n\n  private toValidate(metatype: Function): boolean {\n    const types: Function[] = [String, Boolean, Number, Array, Object];\n    return !types.includes(metatype);\n  }\n}"],"names":["ValidationPipe","transform","value","metatype","toValidate","object","plainToInstance","errors","validate","length","errorMessages","map","error","Object","values","constraints","join","BadRequestException","message","types","String","Boolean","Number","Array","includes"],"mappings":";;;;+BAUaA;;;eAAAA;;;wBALN;gCACkB;kCACO;;;;;;;AAGzB,IAAA,AAAMA,iBAAN,MAAMA;IACX,MAAMC,UAAUC,KAAU,EAAE,EAAEC,QAAQ,EAAoB,EAAE;QAC1D,IAAI,CAACA,YAAY,CAAC,IAAI,CAACC,UAAU,CAACD,WAAW;YAC3C,OAAOD;QACT;QAEA,MAAMG,SAASC,IAAAA,iCAAe,EAACH,UAAUD;QACzC,MAAMK,SAAS,MAAMC,IAAAA,wBAAQ,EAACH;QAE9B,IAAIE,OAAOE,MAAM,GAAG,GAAG;YACrB,MAAMC,gBAAgBH,OAAOI,GAAG,CAAC,CAACC;gBAChC,OAAOC,OAAOC,MAAM,CAACF,MAAMG,WAAW,IAAI,CAAC,GAAGC,IAAI,CAAC;YACrD;YAEA,MAAM,IAAIC,2BAAmB,CAAC;gBAC5BC,SAAS;gBACTX,QAAQG;YACV;QACF;QAEA,OAAOL;IACT;IAEQD,WAAWD,QAAkB,EAAW;QAC9C,MAAMgB,QAAoB;YAACC;YAAQC;YAASC;YAAQC;YAAOV;SAAO;QAClE,OAAO,CAACM,MAAMK,QAAQ,CAACrB;IACzB;AACF"}