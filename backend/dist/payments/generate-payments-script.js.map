{"version":3,"sources":["../../src/payments/generate-payments-script.ts"],"sourcesContent":["// Simple script to generate payment schedules for existing tenants\n// This can be run once to set up the payment system\n\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from '../app.module';\nimport { PaymentsService } from './payments.service';\nimport { DATABASE_CONNECTION } from '../database/database.module';\nimport { tenantInvitations } from '../database/schema';\nimport { eq } from 'drizzle-orm';\n\nasync function generatePaymentSchedules() {\n  const app = await NestFactory.createApplicationContext(AppModule);\n  const paymentsService = app.get(PaymentsService);\n  const db = app.get(DATABASE_CONNECTION);\n\n  try {\n    console.log('Finding all accepted tenant invitations...');\n    \n    // Get all accepted invitations\n    const acceptedInvitations = await db\n      .select()\n      .from(tenantInvitations)\n      .where(eq(tenantInvitations.status, 'accepted'));\n\n    console.log(`Found ${acceptedInvitations.length} accepted invitations`);\n\n    for (const invitation of acceptedInvitations) {\n      try {\n        console.log(`Generating payment schedule for invitation ${invitation.id} (${invitation.firstName} ${invitation.lastName})`);\n        await paymentsService.generatePaymentSchedule(invitation.id);\n        console.log('✅ Payment schedule generated successfully');\n      } catch (error) {\n        console.error(`❌ Error generating payment schedule for invitation ${invitation.id}:`, error.message);\n      }\n    }\n\n    console.log('✅ Payment schedule generation completed');\n  } catch (error) {\n    console.error('❌ Error in payment schedule generation:', error);\n  } finally {\n    await app.close();\n  }\n}\n\n// Run the script\nif (require.main === module) {\n  generatePaymentSchedules().catch(console.error);\n}\n\nexport { generatePaymentSchedules };"],"names":["generatePaymentSchedules","app","NestFactory","createApplicationContext","AppModule","paymentsService","get","PaymentsService","db","DATABASE_CONNECTION","console","log","acceptedInvitations","select","from","tenantInvitations","where","eq","status","length","invitation","id","firstName","lastName","generatePaymentSchedule","error","message","close","require","main","module","catch"],"mappings":"AAAA,mEAAmE;AACnE,oDAAoD;;;;;+BAgD3CA;;;eAAAA;;;sBA9CmB;2BACF;iCACM;gCACI;wBACF;4BACf;AAEnB,eAAeA;IACb,MAAMC,MAAM,MAAMC,iBAAW,CAACC,wBAAwB,CAACC,oBAAS;IAChE,MAAMC,kBAAkBJ,IAAIK,GAAG,CAACC,gCAAe;IAC/C,MAAMC,KAAKP,IAAIK,GAAG,CAACG,mCAAmB;IAEtC,IAAI;QACFC,QAAQC,GAAG,CAAC;QAEZ,+BAA+B;QAC/B,MAAMC,sBAAsB,MAAMJ,GAC/BK,MAAM,GACNC,IAAI,CAACC,yBAAiB,EACtBC,KAAK,CAACC,IAAAA,cAAE,EAACF,yBAAiB,CAACG,MAAM,EAAE;QAEtCR,QAAQC,GAAG,CAAC,CAAC,MAAM,EAAEC,oBAAoBO,MAAM,CAAC,qBAAqB,CAAC;QAEtE,KAAK,MAAMC,cAAcR,oBAAqB;YAC5C,IAAI;gBACFF,QAAQC,GAAG,CAAC,CAAC,2CAA2C,EAAES,WAAWC,EAAE,CAAC,EAAE,EAAED,WAAWE,SAAS,CAAC,CAAC,EAAEF,WAAWG,QAAQ,CAAC,CAAC,CAAC;gBAC1H,MAAMlB,gBAAgBmB,uBAAuB,CAACJ,WAAWC,EAAE;gBAC3DX,QAAQC,GAAG,CAAC;YACd,EAAE,OAAOc,OAAO;gBACdf,QAAQe,KAAK,CAAC,CAAC,mDAAmD,EAAEL,WAAWC,EAAE,CAAC,CAAC,CAAC,EAAEI,MAAMC,OAAO;YACrG;QACF;QAEAhB,QAAQC,GAAG,CAAC;IACd,EAAE,OAAOc,OAAO;QACdf,QAAQe,KAAK,CAAC,2CAA2CA;IAC3D,SAAU;QACR,MAAMxB,IAAI0B,KAAK;IACjB;AACF;AAEA,iBAAiB;AACjB,IAAIC,QAAQC,IAAI,KAAKC,QAAQ;IAC3B9B,2BAA2B+B,KAAK,CAACrB,QAAQe,KAAK;AAChD"}