{"version":3,"sources":["../../../src/database/schema/tenant-rent-contracts.ts"],"sourcesContent":["import { pgTable, uuid, varchar, text, timestamp, decimal, boolean, pgEnum, integer, index } from 'drizzle-orm/pg-core';\nimport { sql } from 'drizzle-orm';\nimport { users } from './users';\nimport { properties, units } from './properties';\n\nexport const landlordPayoutTypeEnum = pgEnum('landlord_payout_type', ['monthly', 'yearly']);\nexport const contractStatusEnum = pgEnum('contract_status', ['active', 'expired', 'terminated']);\nexport const notificationTypeEnum = pgEnum('notification_type', ['reminder', 'overdue', 'success']);\nexport const notificationStatusEnum = pgEnum('notification_status', ['pending', 'sent', 'failed']);\n\n// Main tenant rent contracts table\nexport const tenantRentContracts = pgTable('tenant_rent_contracts', {\n  id: uuid('id').defaultRandom().primaryKey(),\n  \n  // References\n  tenantId: uuid('tenant_id').references(() => users.id).notNull(),\n  landlordId: uuid('landlord_id').references(() => users.id).notNull(),\n  propertyId: uuid('property_id').references(() => properties.id).notNull(),\n  unitId: uuid('unit_id').references(() => units.id).notNull(),\n  \n  // Contract details\n  monthlyAmount: decimal('monthly_amount', { precision: 10, scale: 2 }).notNull(),\n  expiryDate: timestamp('expiry_date').notNull(),\n  landlordPayoutType: landlordPayoutTypeEnum('landlord_payout_type').notNull(),\n  \n  // Payment scheduling\n  nextPaymentDue: timestamp('next_payment_due').notNull(),\n  transitionStartDate: timestamp('transition_start_date').notNull(),\n  \n  // Status and metadata\n  status: contractStatusEnum('status').default('active').notNull(),\n  isExistingTenant: boolean('is_existing_tenant').default(false).notNull(),\n  originalExpiryDate: timestamp('original_expiry_date'), // For existing tenants\n  \n  // Tracking\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n});\n\n// Landlord escrow balances for yearly payout tracking\nexport const landlordEscrowBalances = pgTable('landlord_escrow_balances', {\n  id: uuid('id').defaultRandom().primaryKey(),\n  \n  // References\n  landlordId: uuid('landlord_id').references(() => users.id).notNull(),\n  contractId: uuid('contract_id').references(() => tenantRentContracts.id).notNull(),\n  \n  // Balance tracking\n  totalEscrowed: decimal('total_escrowed', { precision: 10, scale: 2 }).default('0.00').notNull(),\n  monthsAccumulated: integer('months_accumulated').default(0).notNull(),\n  expectedReleaseDate: timestamp('expected_release_date').notNull(),\n  \n  // Release tracking\n  isReleased: boolean('is_released').default(false).notNull(),\n  releasedAt: timestamp('released_at'),\n  releasedAmount: decimal('released_amount', { precision: 10, scale: 2 }),\n  \n  // Tracking\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n  updatedAt: timestamp('updated_at').defaultNow().notNull(),\n});\n\n// Payment notifications for scheduling\nexport const paymentNotifications = pgTable('payment_notifications', {\n  id: uuid('id').defaultRandom().primaryKey(),\n  \n  // References\n  contractId: uuid('contract_id').references(() => tenantRentContracts.id).notNull(),\n  tenantId: uuid('tenant_id').references(() => users.id).notNull(),\n  \n  // Notification details\n  notificationType: notificationTypeEnum('notification_type').notNull(),\n  scheduledFor: timestamp('scheduled_for').notNull(),\n  sentAt: timestamp('sent_at'),\n  \n  // Notification content\n  title: varchar('title', { length: 255 }).notNull(),\n  message: text('message').notNull(),\n  \n  // Delivery tracking\n  status: notificationStatusEnum('status').default('pending').notNull(),\n  expoReceiptId: varchar('expo_receipt_id', { length: 255 }),\n  \n  // Tracking\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n});\n\n// Type exports\nexport type TenantRentContract = typeof tenantRentContracts.$inferSelect;\nexport type NewTenantRentContract = typeof tenantRentContracts.$inferInsert;\nexport type LandlordEscrowBalance = typeof landlordEscrowBalances.$inferSelect;\nexport type NewLandlordEscrowBalance = typeof landlordEscrowBalances.$inferInsert;\nexport type PaymentNotification = typeof paymentNotifications.$inferSelect;\nexport type NewPaymentNotification = typeof paymentNotifications.$inferInsert;"],"names":["contractStatusEnum","landlordEscrowBalances","landlordPayoutTypeEnum","notificationStatusEnum","notificationTypeEnum","paymentNotifications","tenantRentContracts","pgEnum","pgTable","id","uuid","defaultRandom","primaryKey","tenantId","references","users","notNull","landlordId","propertyId","properties","unitId","units","monthlyAmount","decimal","precision","scale","expiryDate","timestamp","landlordPayoutType","nextPaymentDue","transitionStartDate","status","default","isExistingTenant","boolean","originalExpiryDate","createdAt","defaultNow","updatedAt","contractId","totalEscrowed","monthsAccumulated","integer","expectedReleaseDate","isReleased","releasedAt","releasedAmount","notificationType","scheduledFor","sentAt","title","varchar","length","message","text","expoReceiptId"],"mappings":"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"}