{"version":3,"sources":["../../src/database/database.module.ts"],"sourcesContent":["import { Module, Global } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from './schema';\n\nexport const DATABASE_CONNECTION = 'DATABASE_CONNECTION';\n\n@Global()\n@Module({\n  imports: [ConfigModule],\n  providers: [\n    {\n      provide: DATABASE_CONNECTION,\n      useFactory: async (configService: ConfigService) => {\n        const connectionString = configService.get<string>('DATABASE_URL');\n        \n        if (!connectionString) {\n          throw new Error('DATABASE_URL environment variable is required');\n        }\n\n        // Create postgres client with SSL support\n        const client = postgres(connectionString, {\n          max: 10, // Connection pool size\n          ssl: configService.get<string>('DB_SSL') === 'false' ? false : { rejectUnauthorized: false },\n        });\n\n        // Create and return drizzle instance\n        const db = drizzle(client, { schema });\n\n        return db;\n      },\n      inject: [ConfigService],\n    },\n  ],\n  exports: [DATABASE_CONNECTION],\n})\nexport class DatabaseModule {}\n"],"names":["DATABASE_CONNECTION","DatabaseModule","imports","ConfigModule","providers","provide","useFactory","configService","connectionString","get","Error","client","postgres","max","ssl","rejectUnauthorized","db","drizzle","schema","inject","ConfigService","exports"],"mappings":";;;;;;;;;;;QAMaA;eAAAA;;QA+BAC;eAAAA;;;wBArCkB;wBACa;4BACpB;iEACH;gEACG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEjB,MAAMD,sBAAsB;AA+B5B,IAAA,AAAMC,iBAAN,MAAMA;AAAgB;;;;QA3B3BC,SAAS;YAACC,oBAAY;SAAC;QACvBC,WAAW;YACT;gBACEC,SAASL;gBACTM,YAAY,OAAOC;oBACjB,MAAMC,mBAAmBD,cAAcE,GAAG,CAAS;oBAEnD,IAAI,CAACD,kBAAkB;wBACrB,MAAM,IAAIE,MAAM;oBAClB;oBAEA,0CAA0C;oBAC1C,MAAMC,SAASC,IAAAA,iBAAQ,EAACJ,kBAAkB;wBACxCK,KAAK;wBACLC,KAAKP,cAAcE,GAAG,CAAS,cAAc,UAAU,QAAQ;4BAAEM,oBAAoB;wBAAM;oBAC7F;oBAEA,qCAAqC;oBACrC,MAAMC,KAAKC,IAAAA,mBAAO,EAACN,QAAQ;wBAAEO,QAAAA;oBAAO;oBAEpC,OAAOF;gBACT;gBACAG,QAAQ;oBAACC,qBAAa;iBAAC;YACzB;SACD;QACDC,SAAS;YAACrB;SAAoB"}