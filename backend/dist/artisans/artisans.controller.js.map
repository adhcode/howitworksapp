{"version":3,"sources":["../../src/artisans/artisans.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Patch,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  Request,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { UserRole } from '../auth/dto/auth.dto';\nimport { ArtisansService } from './artisans.service';\nimport {\n  RegisterArtisanDto,\n  UpdateArtisanStatusDto,\n  ArtisanFiltersDto,\n  ArtisanResponseDto,\n} from './dto/artisan.dto';\n\n@Controller('artisans')\nexport class ArtisansController {\n  constructor(private readonly artisansService: ArtisansService) { }\n\n  /**\n   * PUBLIC: Register new artisan\n   * No authentication required - public form\n   */\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  async registerArtisan(@Body() dto: RegisterArtisanDto): Promise<ArtisanResponseDto> {\n    return this.artisansService.registerArtisan(dto);\n  }\n\n  /**\n   * ADMIN: Get all artisans with filters\n   */\n  @Get('admin/all')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.ADMIN)\n  async getAllArtisans(@Query() filters: ArtisanFiltersDto): Promise<ArtisanResponseDto[]> {\n    return this.artisansService.getAllArtisans(filters);\n  }\n\n  /**\n   * ADMIN: Get artisan by ID\n   */\n  @Get('admin/:id')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.ADMIN)\n  async getArtisanById(@Param('id') id: string): Promise<ArtisanResponseDto> {\n    return this.artisansService.getArtisanById(id);\n  }\n\n  /**\n   * ADMIN: Update artisan status\n   */\n  @Patch('admin/:id/status')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.ADMIN)\n  async updateArtisanStatus(\n    @Param('id') id: string,\n    @Body() dto: UpdateArtisanStatusDto,\n  ): Promise<ArtisanResponseDto> {\n    return this.artisansService.updateArtisanStatus(id, dto);\n  }\n\n  /**\n   * ADMIN: Delete artisan\n   */\n  @Delete('admin/:id')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.ADMIN)\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteArtisan(@Param('id') id: string): Promise<void> {\n    return this.artisansService.deleteArtisan(id);\n  }\n\n  /**\n   * FACILITATOR: Get my referred artisans\n   */\n  @Get('facilitator/my-referrals')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.FACILITATOR)\n  async getMyReferrals(@Request() req): Promise<ArtisanResponseDto[]> {\n    return this.artisansService.getArtisansByFacilitator(req.user.id);\n  }\n\n  /**\n   * FACILITATOR: Get my referral statistics\n   */\n  @Get('facilitator/stats')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.FACILITATOR)\n  async getMyReferralStats(@Request() req) {\n    return this.artisansService.getFacilitatorReferralStats(req.user.id);\n  }\n\n  /**\n   * FACILITATOR: Get my referral link\n   */\n  @Get('facilitator/referral-link')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.FACILITATOR)\n  async getMyReferralLink(@Request() req) {\n    const link = this.artisansService.generateReferralLink(req.user.id);\n    return { referralLink: link };\n  }\n\n  /**\n   * ADMIN: Get facilitator's referral link\n   */\n  @Get('admin/facilitator/:facilitatorId/referral-link')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.ADMIN)\n  async getFacilitatorReferralLink(@Param('facilitatorId') facilitatorId: string) {\n    const link = this.artisansService.generateReferralLink(facilitatorId);\n    return { referralLink: link };\n  }\n}\n"],"names":["ArtisansController","registerArtisan","dto","artisansService","getAllArtisans","filters","getArtisanById","id","updateArtisanStatus","deleteArtisan","getMyReferrals","req","getArtisansByFacilitator","user","getMyReferralStats","getFacilitatorReferralStats","getMyReferralLink","link","generateReferralLink","referralLink","getFacilitatorReferralLink","facilitatorId","CREATED","ADMIN","NO_CONTENT","FACILITATOR"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAdN;8BACsB;4BACF;gCACL;yBACG;iCACO;4BAMzB;;;;;;;;;;;;;;;AAGA,IAAA,AAAMA,qBAAN,MAAMA;IAGX;;;GAGC,GACD,MAEMC,gBAAgB,AAAQC,GAAuB,EAA+B;QAClF,OAAO,IAAI,CAACC,eAAe,CAACF,eAAe,CAACC;IAC9C;IAEA;;GAEC,GACD,MAGME,eAAe,AAASC,OAA0B,EAAiC;QACvF,OAAO,IAAI,CAACF,eAAe,CAACC,cAAc,CAACC;IAC7C;IAEA;;GAEC,GACD,MAGMC,eAAe,AAAaC,EAAU,EAA+B;QACzE,OAAO,IAAI,CAACJ,eAAe,CAACG,cAAc,CAACC;IAC7C;IAEA;;GAEC,GACD,MAGMC,oBACJ,AAAaD,EAAU,EACvB,AAAQL,GAA2B,EACN;QAC7B,OAAO,IAAI,CAACC,eAAe,CAACK,mBAAmB,CAACD,IAAIL;IACtD;IAEA;;GAEC,GACD,MAIMO,cAAc,AAAaF,EAAU,EAAiB;QAC1D,OAAO,IAAI,CAACJ,eAAe,CAACM,aAAa,CAACF;IAC5C;IAEA;;GAEC,GACD,MAGMG,eAAe,AAAWC,GAAG,EAAiC;QAClE,OAAO,IAAI,CAACR,eAAe,CAACS,wBAAwB,CAACD,IAAIE,IAAI,CAACN,EAAE;IAClE;IAEA;;GAEC,GACD,MAGMO,mBAAmB,AAAWH,GAAG,EAAE;QACvC,OAAO,IAAI,CAACR,eAAe,CAACY,2BAA2B,CAACJ,IAAIE,IAAI,CAACN,EAAE;IACrE;IAEA;;GAEC,GACD,MAGMS,kBAAkB,AAAWL,GAAG,EAAE;QACtC,MAAMM,OAAO,IAAI,CAACd,eAAe,CAACe,oBAAoB,CAACP,IAAIE,IAAI,CAACN,EAAE;QAClE,OAAO;YAAEY,cAAcF;QAAK;IAC9B;IAEA;;GAEC,GACD,MAGMG,2BAA2B,AAAwBC,aAAqB,EAAE;QAC9E,MAAMJ,OAAO,IAAI,CAACd,eAAe,CAACe,oBAAoB,CAACG;QACvD,OAAO;YAAEF,cAAcF;QAAK;IAC9B;IAhGA,YAAY,AAAiBd,eAAgC,CAAE;aAAlCA,kBAAAA;IAAoC;AAiGnE;;;6CA1FuBmB;;;;;;;;;;;iDAULC;;;;;;;;;;;iDAUAA;;;;;;;;;;;iDAUAA;;;;;;;;;;;;;iDAaAA;6CACKC;;;;;;;;;;;iDAULC;;;;;;;;;;;iDAUAA;;;;;;;;;;;iDAUAA;;;;;;;;;;;iDAWAF"}