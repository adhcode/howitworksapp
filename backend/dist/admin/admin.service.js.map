{"version":3,"sources":["../../src/admin/admin.service.ts"],"sourcesContent":["import { Injectable, NotFoundException, ConflictException, Inject } from '@nestjs/common';\nimport { eq, and, or, ilike, count, sql, inArray } from 'drizzle-orm';\nimport { NodePgDatabase } from 'drizzle-orm/node-postgres';\nimport * as bcrypt from 'bcryptjs';\nimport { DATABASE_CONNECTION } from '../database/database.module';\nimport { users } from '../database/schema/users';\nimport { properties, units } from '../database/schema/properties';\nimport { payments } from '../database/schema/payments';\nimport { maintenanceRequests, messages } from '../database/schema/messages';\nimport { leases } from '../database/schema/leases';\nimport { tenantInvitations } from '../database/schema/tenant-invitations';\nimport { CreateUserDto, UpdateUserDto } from './dto/admin.dto';\n\n@Injectable()\nexport class AdminService {\n  constructor(\n    @Inject(DATABASE_CONNECTION)\n    private readonly db: NodePgDatabase<any>,\n  ) {}\n\n  async getDashboardStats() {\n    try {\n      console.log('üîç Fetching real dashboard stats from database...');\n      \n      // Get user counts by role (only query for roles that exist in database)\n      const [userStats] = await this.db\n        .select({\n          totalLandlords: sql<number>`count(case when role = 'landlord' then 1 end)`,\n          totalTenants: sql<number>`count(case when role = 'tenant' then 1 end)`,\n          totalAdmins: sql<number>`count(case when role = 'admin' then 1 end)`,\n        })\n        .from(users);\n\n      // Get property stats\n      const [propertyStats] = await this.db\n        .select({\n          totalProperties: count(),\n          totalUnits: sql<number>`sum(total_units)`,\n        })\n        .from(properties);\n\n      // TODO: Get more complex stats from other tables when available:\n      // - occupiedUnits from leases/units table\n      // - totalRentCollected from payments table  \n      // - pendingPayments from payments table\n      // - activeMaintenanceRequests from maintenance_requests table\n\n      // Get facilitator stats\n      const [facilitatorStats] = await this.db\n        .select({\n          totalFacilitators: sql<number>`count(case when role = 'facilitator' then 1 end)`,\n          activeFacilitators: sql<number>`count(case when role = 'facilitator' and is_active = true then 1 end)`,\n        })\n        .from(users);\n\n      // Get properties with facilitators assigned\n      const [facilitatorPropertyStats] = await this.db\n        .select({\n          propertiesWithFacilitators: sql<number>`count(case when facilitator_id is not null then 1 end)`,\n        })\n        .from(properties);\n\n      const stats = {\n        totalProperties: Number(propertyStats?.totalProperties || 0),\n        totalLandlords: Number(userStats?.totalLandlords || 0),\n        totalTenants: Number(userStats?.totalTenants || 0),\n        totalFacilitators: Number(facilitatorStats?.totalFacilitators || 0),\n        activeFacilitators: Number(facilitatorStats?.activeFacilitators || 0),\n        propertiesWithFacilitators: Number(facilitatorPropertyStats?.propertiesWithFacilitators || 0),\n        totalUnits: Number(propertyStats?.totalUnits || 0),\n        occupiedUnits: 0, // TODO: Calculate from lease/tenant data when available\n        vacantUnits: Number(propertyStats?.totalUnits || 0), // For now, assume all units are vacant\n        totalRentCollected: 0, // TODO: Calculate from payments table when available\n        pendingPayments: 0, // TODO: Calculate from payments table when available\n        activeMaintenanceRequests: 0, // TODO: Calculate from maintenance_requests table when available\n      };\n      \n      console.log('üìä Real dashboard stats from database:', stats);\n      return stats;\n    } catch (error) {\n      console.error('Error fetching dashboard stats:', error);\n      // Fall back to basic stats if database query fails\n      return {\n        totalProperties: 0,\n        totalLandlords: 0,\n        totalTenants: 0,\n        totalFacilitators: 0,\n        totalUnits: 0,\n        occupiedUnits: 0,\n        vacantUnits: 0,\n        totalRentCollected: 0,\n        pendingPayments: 0,\n        activeMaintenanceRequests: 0,\n      };\n    }\n  }\n\n  async getRevenueAnalytics(timeframe: string = '12m') {\n    try {\n      console.log('üîç Fetching real revenue analytics from database...');\n      \n      // Get current date and calculate timeframe\n      const now = new Date();\n      const monthsBack = parseInt(timeframe.replace('m', '')) || 12;\n      const startDate = new Date(now.getFullYear(), now.getMonth() - monthsBack + 1, 1);\n      \n      console.log(`Querying revenue data from ${startDate.toISOString()} to ${now.toISOString()}`);\n      \n      // Query payments by month for the specified timeframe\n      const revenueData = await this.db\n        .select({\n          month: sql<string>`TO_CHAR(paid_date, 'Mon')`,\n          year: sql<number>`EXTRACT(YEAR FROM paid_date)`,\n          amount: sql<number>`COALESCE(SUM(amount_paid), 0)`,\n        })\n        .from(payments)\n        .where(\n          and(\n            sql`paid_date >= ${startDate}`,\n            sql`paid_date <= ${now}`,\n            eq(payments.status, 'paid')\n          )\n        )\n        .groupBy(sql`DATE_TRUNC('month', paid_date)`, sql`TO_CHAR(paid_date, 'Mon')`, sql`EXTRACT(YEAR FROM paid_date)`)\n        .orderBy(sql`DATE_TRUNC('month', paid_date)`);\n\n      console.log('üìä Revenue analytics data:', revenueData);\n\n      // If no data, return empty array\n      if (revenueData.length === 0) {\n        console.log('No payment data found, returning empty array');\n        return { monthlyData: [] };\n      }\n\n      return {\n        monthlyData: revenueData.map(row => ({\n          month: row.month,\n          amount: Number(row.amount),\n        }))\n      };\n    } catch (error) {\n      console.error('Error fetching revenue analytics:', error);\n      // Return empty data instead of throwing error\n      return { monthlyData: [] };\n    }\n  }\n\n  async getMaintenanceAnalytics(timeframe: string = '12m') {\n    try {\n      console.log('üîç Fetching real maintenance analytics from database...');\n      \n      // Get current date and calculate timeframe\n      const now = new Date();\n      const monthsBack = parseInt(timeframe.replace('m', '')) || 12;\n      const startDate = new Date(now.getFullYear(), now.getMonth() - monthsBack + 1, 1);\n      \n      console.log(`Querying maintenance data from ${startDate.toISOString()} to ${now.toISOString()}`);\n      \n      // Query maintenance requests by month and status for the specified timeframe\n      const maintenanceData = await this.db\n        .select({\n          month: sql<string>`TO_CHAR(created_at, 'Mon')`,\n          year: sql<number>`EXTRACT(YEAR FROM created_at)`,\n          pending: sql<number>`COUNT(CASE WHEN status = 'pending' THEN 1 END)`,\n          inProgress: sql<number>`COUNT(CASE WHEN status = 'in_progress' THEN 1 END)`,\n          completed: sql<number>`COUNT(CASE WHEN status = 'completed' THEN 1 END)`,\n          cancelled: sql<number>`COUNT(CASE WHEN status = 'cancelled' THEN 1 END)`,\n        })\n        .from(maintenanceRequests)\n        .where(\n          and(\n            sql`created_at >= ${startDate}`,\n            sql`created_at <= ${now}`\n          )\n        )\n        .groupBy(sql`DATE_TRUNC('month', created_at)`, sql`TO_CHAR(created_at, 'Mon')`, sql`EXTRACT(YEAR FROM created_at)`)\n        .orderBy(sql`DATE_TRUNC('month', created_at)`);\n\n      console.log('üìä Maintenance analytics data:', maintenanceData);\n\n      // If no data, return empty array\n      if (maintenanceData.length === 0) {\n        console.log('No maintenance request data found, returning empty array');\n        return { monthlyData: [] };\n      }\n\n      return {\n        monthlyData: maintenanceData.map(row => ({\n          month: row.month,\n          open: Number(row.pending), // Map \"pending\" to \"open\" for frontend compatibility\n          inProgress: Number(row.inProgress),\n          resolved: Number(row.completed), // Map \"completed\" to \"resolved\" for frontend compatibility\n        }))\n      };\n    } catch (error) {\n      console.error('Error fetching maintenance analytics:', error);\n      // Return empty data instead of throwing error\n      return { monthlyData: [] };\n    }\n  }\n\n\n\n  async getUsers(options: {\n    page: number;\n    limit: number;\n    role?: string;\n    search?: string;\n  }) {\n    const { page, limit, role, search } = options;\n    const offset = (page - 1) * limit;\n\n    try {\n      // Build where condition\n      let finalWhereCondition;\n      \n      if (role && search) {\n        finalWhereCondition = and(\n          eq(users.role, role as any),\n          sql`${users.firstName} ILIKE ${`%${search}%`} OR ${users.lastName} ILIKE ${`%${search}%`} OR ${users.email} ILIKE ${`%${search}%`}`\n        );\n      } else if (role) {\n        finalWhereCondition = eq(users.role, role as any);\n      } else if (search) {\n        finalWhereCondition = sql`${users.firstName} ILIKE ${`%${search}%`} OR ${users.lastName} ILIKE ${`%${search}%`} OR ${users.email} ILIKE ${`%${search}%`}`;\n      } else {\n        finalWhereCondition = undefined;\n      }\n\n      // Execute queries\n      const dataQuery = this.db\n        .select()\n        .from(users)\n        .where(finalWhereCondition)\n        .limit(limit)\n        .offset(offset)\n        .orderBy(users.createdAt);\n\n      const countQuery = this.db\n        .select({ count: count() })\n        .from(users)\n        .where(finalWhereCondition);\n\n      const [data, totalResult] = await Promise.all([\n        dataQuery,\n        countQuery,\n      ]);\n\n      const total = totalResult[0]?.count || 0;\n\n      return {\n        data: data.map(user => {\n          const { password, ...userWithoutPassword } = user;\n          return userWithoutPassword;\n        }),\n        meta: {\n          page,\n          limit,\n          total: Number(total),\n          totalPages: Math.ceil(Number(total) / limit),\n        },\n      };\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      throw error;\n    }\n  }\n\n  async createUser(createUserDto: CreateUserDto) {\n    try {\n      // Check if user already exists\n      const existingUser = await this.db\n        .select()\n        .from(users)\n        .where(eq(users.email, createUserDto.email))\n        .limit(1);\n\n      if (existingUser.length > 0) {\n        throw new ConflictException('User with this email already exists');\n      }\n\n      // Hash password\n      const hashedPassword = await bcrypt.hash(createUserDto.password, 12);\n\n      // Create user\n      const [newUser] = await this.db\n        .insert(users)\n        .values({\n          ...createUserDto,\n          password: hashedPassword,\n          isEmailVerified: true, // Admin-created users are auto-verified\n        })\n        .returning();\n\n      const { password, ...userWithoutPassword } = newUser;\n      return userWithoutPassword;\n    } catch (error) {\n      console.error('Error creating user:', error);\n      throw error;\n    }\n  }\n\n  async getUserById(id: string) {\n    try {\n      const [user] = await this.db\n        .select()\n        .from(users)\n        .where(eq(users.id, id))\n        .limit(1);\n\n      if (!user) {\n        throw new NotFoundException('User not found');\n      }\n\n      const { password, ...userWithoutPassword } = user;\n      return userWithoutPassword;\n    } catch (error) {\n      console.error('Error fetching user:', error);\n      throw error;\n    }\n  }\n\n  async updateUser(id: string, updateUserDto: UpdateUserDto) {\n    try {\n      const [updatedUser] = await this.db\n        .update(users)\n        .set({\n          ...updateUserDto,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, id))\n        .returning();\n\n      if (!updatedUser) {\n        throw new NotFoundException('User not found');\n      }\n\n      const { password, ...userWithoutPassword } = updatedUser;\n      return userWithoutPassword;\n    } catch (error) {\n      console.error('Error updating user:', error);\n      throw error;\n    }\n  }\n\n  async deleteUser(id: string) {\n    try {\n      const [deletedUser] = await this.db\n        .delete(users)\n        .where(eq(users.id, id))\n        .returning();\n\n      if (!deletedUser) {\n        throw new NotFoundException('User not found');\n      }\n\n      return { message: 'User deleted successfully' };\n    } catch (error) {\n      console.error('Error deleting user:', error);\n      throw error;\n    }\n  }\n\n  async toggleUserStatus(id: string) {\n    try {\n      // First get the current user\n      const [currentUser] = await this.db\n        .select()\n        .from(users)\n        .where(eq(users.id, id))\n        .limit(1);\n\n      if (!currentUser) {\n        throw new NotFoundException('User not found');\n      }\n\n      // Toggle the status\n      const [updatedUser] = await this.db\n        .update(users)\n        .set({\n          isActive: !currentUser.isActive,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, id))\n        .returning();\n\n      const { password, ...userWithoutPassword } = updatedUser;\n      return userWithoutPassword;\n    } catch (error) {\n      console.error('Error toggling user status:', error);\n      throw error;\n    }\n  }\n\n  async getProperties(options: {\n    page: number;\n    limit: number;\n    search?: string;\n  }) {\n    const { page, limit, search } = options;\n    const offset = (page - 1) * limit;\n\n    try {\n      // Build where condition for search\n      const searchCondition = search \n        ? sql`${properties.name} ILIKE ${`%${search}%`} OR ${properties.address} ILIKE ${`%${search}%`}`\n        : undefined;\n\n      // Execute queries with facilitator join\n      const landlordAlias = users;\n      const facilitatorAlias = sql`facilitator`;\n      \n      const dataQuery = this.db\n        .select({\n          id: properties.id,\n          name: properties.name,\n          address: properties.address,\n          city: properties.city,\n          state: properties.state,\n          country: properties.country,\n          propertyType: properties.propertyType,\n          totalUnits: properties.totalUnits,\n          description: properties.description,\n          images: properties.images,\n          amenities: properties.amenities,\n          status: properties.status,\n          landlordId: properties.landlordId,\n          facilitatorId: properties.facilitatorId,\n          createdAt: properties.createdAt,\n          updatedAt: properties.updatedAt,\n          landlordName: sql<string>`${landlordAlias.firstName} || ' ' || ${landlordAlias.lastName}`,\n          landlordEmail: landlordAlias.email,\n          facilitatorName: sql<string>`facilitator.first_name || ' ' || facilitator.last_name`,\n          facilitatorEmail: sql<string>`facilitator.email`,\n        })\n        .from(properties)\n        .leftJoin(landlordAlias, eq(properties.landlordId, landlordAlias.id))\n        .leftJoin(sql`users AS facilitator`, sql`${properties.facilitatorId} = facilitator.id`)\n        .where(searchCondition)\n        .limit(limit)\n        .offset(offset)\n        .orderBy(properties.createdAt);\n\n      const countQuery = this.db\n        .select({ count: count() })\n        .from(properties)\n        .where(searchCondition);\n\n      const [data, totalResult] = await Promise.all([\n        dataQuery,\n        countQuery,\n      ]);\n\n      const total = totalResult[0]?.count || 0;\n\n      return {\n        data,\n        meta: {\n          page,\n          limit,\n          total: Number(total),\n          totalPages: Math.ceil(Number(total) / limit),\n        },\n      };\n    } catch (error) {\n      console.error('Error fetching properties:', error);\n      throw error;\n    }\n  }\n\n  async assignFacilitatorToProperty(propertyId: string, facilitatorId: string) {\n    try {\n      // Verify facilitator exists and has correct role\n      const [facilitator] = await this.db\n        .select()\n        .from(users)\n        .where(and(eq(users.id, facilitatorId), eq(users.role, 'facilitator')))\n        .limit(1);\n\n      if (!facilitator) {\n        throw new NotFoundException('Facilitator not found');\n      }\n\n      // Update property\n      const [updatedProperty] = await this.db\n        .update(properties)\n        .set({\n          facilitatorId,\n          updatedAt: new Date(),\n        })\n        .where(eq(properties.id, propertyId))\n        .returning();\n\n      if (!updatedProperty) {\n        throw new NotFoundException('Property not found');\n      }\n\n      return updatedProperty;\n    } catch (error) {\n      console.error('Error assigning facilitator to property:', error);\n      throw error;\n    }\n  }\n\n  async removeFacilitatorFromProperty(propertyId: string) {\n    try {\n      const [updatedProperty] = await this.db\n        .update(properties)\n        .set({\n          facilitatorId: null,\n          updatedAt: new Date(),\n        })\n        .where(eq(properties.id, propertyId))\n        .returning();\n\n      if (!updatedProperty) {\n        throw new NotFoundException('Property not found');\n      }\n\n      return updatedProperty;\n    } catch (error) {\n      console.error('Error removing facilitator from property:', error);\n      throw error;\n    }\n  }\n\n  // Analytics methods (mock implementations for now)\n  async getPropertyAnalytics(timeframe: string) {\n    // TODO: Implement real analytics based on timeframe\n    return {\n      totalProperties: 24,\n      newProperties: 3,\n      propertiesWithFacilitators: 18,\n      averageUnitsPerProperty: 6.5,\n    };\n  }\n\n  // Property Detail Methods\n  async getPropertyById(id: string) {\n    try {\n      const [property] = await this.db\n        .select({\n          id: properties.id,\n          name: properties.name,\n          address: properties.address,\n          city: properties.city,\n          state: properties.state,\n          country: properties.country,\n          propertyType: properties.propertyType,\n          totalUnits: properties.totalUnits,\n          description: properties.description,\n          images: properties.images,\n          amenities: properties.amenities,\n          status: properties.status,\n          landlordId: properties.landlordId,\n          facilitatorId: properties.facilitatorId,\n          createdAt: properties.createdAt,\n          updatedAt: properties.updatedAt,\n          landlord: {\n            id: users.id,\n            firstName: users.firstName,\n            lastName: users.lastName,\n            email: users.email,\n            phoneNumber: users.phoneNumber,\n          },\n        })\n        .from(properties)\n        .leftJoin(users, eq(properties.landlordId, users.id))\n        .where(eq(properties.id, id))\n        .limit(1);\n\n      if (!property) {\n        throw new NotFoundException('Property not found');\n      }\n\n      // Get facilitator info if assigned\n      let facilitator: {\n        id: string;\n        firstName: string;\n        lastName: string;\n        email: string;\n        phoneNumber: string;\n      } | null = null;\n      if (property.facilitatorId) {\n        const [facilitatorData] = await this.db\n          .select({\n            id: users.id,\n            firstName: users.firstName,\n            lastName: users.lastName,\n            email: users.email,\n            phoneNumber: users.phoneNumber,\n          })\n          .from(users)\n          .where(eq(users.id, property.facilitatorId))\n          .limit(1);\n        \n        facilitator = facilitatorData;\n      }\n\n      return {\n        ...property,\n        facilitator,\n      };\n    } catch (error) {\n      console.error('Error fetching property by ID:', error);\n      throw error;\n    }\n  }\n\n  async getPropertyUnits(propertyId: string) {\n    try {\n      // Query units with active lease information\n      const unitsData = await this.db\n        .select({\n          id: units.id,\n          unitNumber: units.unitNumber,\n          bedrooms: units.bedrooms,\n          bathrooms: units.bathrooms,\n          rent: units.rent,\n          isAvailable: units.isAvailable,\n          propertyId: units.propertyId,\n          // Lease information\n          tenantId: leases.tenantId,\n          leaseStatus: leases.status,\n          // Tenant information\n          tenantFirstName: users.firstName,\n          tenantLastName: users.lastName,\n        })\n        .from(units)\n        .leftJoin(\n          leases,\n          and(\n            eq(units.id, leases.unitId),\n            eq(leases.status, 'active')\n          )\n        )\n        .leftJoin(users, eq(leases.tenantId, users.id))\n        .where(eq(units.propertyId, propertyId))\n        .orderBy(units.unitNumber);\n\n      // Transform to match frontend expectations\n      return unitsData.map(unit => ({\n        id: unit.id,\n        unitNumber: unit.unitNumber,\n        status: unit.tenantId ? 'occupied' : 'vacant',\n        rentAmount: Number(unit.rent),\n        tenantId: unit.tenantId,\n        tenantName: unit.tenantFirstName && unit.tenantLastName \n          ? `${unit.tenantFirstName} ${unit.tenantLastName}`\n          : null,\n        propertyId: unit.propertyId,\n      }));\n    } catch (error) {\n      console.error('Error fetching property units:', error);\n      throw error;\n    }\n  }\n\n  async getPropertyTenants(propertyId: string) {\n    try {\n      // Query tenants with active leases for this property\n      const tenantsData = await this.db\n        .select({\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          email: users.email,\n          phoneNumber: users.phoneNumber,\n          unitNumber: units.unitNumber,\n          monthlyRent: leases.monthlyRent,\n          leaseEndDate: leases.endDate,\n          leaseStatus: leases.status,\n        })\n        .from(leases)\n        .innerJoin(users, eq(leases.tenantId, users.id))\n        .innerJoin(units, eq(leases.unitId, units.id))\n        .where(\n          and(\n            eq(leases.propertyId, propertyId),\n            eq(leases.status, 'active')\n          )\n        )\n        .orderBy(units.unitNumber);\n\n      // Transform to match frontend expectations\n      // TODO: Calculate actual payment status from payments table\n      return tenantsData.map(tenant => ({\n        id: tenant.id,\n        firstName: tenant.firstName,\n        lastName: tenant.lastName,\n        email: tenant.email,\n        phoneNumber: tenant.phoneNumber,\n        unitNumber: tenant.unitNumber,\n        rentAmount: Number(tenant.monthlyRent),\n        leaseEndDate: tenant.leaseEndDate,\n        status: 'paid', // Default for now, should be calculated from payments\n      }));\n    } catch (error) {\n      console.error('Error fetching property tenants:', error);\n      throw error;\n    }\n  }\n\n  async getPropertyMaintenance(propertyId: string) {\n    try {\n      // Query maintenance requests for this property with tenant and unit info\n      const maintenanceData = await this.db\n        .select({\n          id: maintenanceRequests.id,\n          title: maintenanceRequests.title,\n          description: maintenanceRequests.description,\n          status: maintenanceRequests.status,\n          priority: maintenanceRequests.priority,\n          images: maintenanceRequests.images,\n          createdAt: maintenanceRequests.createdAt,\n          completedAt: maintenanceRequests.completedAt,\n          tenantFirstName: sql<string>`tenant.first_name`,\n          tenantLastName: sql<string>`tenant.last_name`,\n          unitNumber: sql<string>`unit.unit_number`,\n          assignedToFirstName: sql<string>`assigned_admin.first_name`,\n          assignedToLastName: sql<string>`assigned_admin.last_name`,\n        })\n        .from(maintenanceRequests)\n        .leftJoin(sql`users AS tenant`, sql`${maintenanceRequests.tenantId} = tenant.id`)\n        .leftJoin(sql`leases AS active_lease`, sql`active_lease.tenant_id = tenant.id AND active_lease.property_id = ${propertyId} AND active_lease.status = 'active'`)\n        .leftJoin(sql`units AS unit`, sql`active_lease.unit_id = unit.id`)\n        .leftJoin(sql`users AS assigned_admin`, sql`${maintenanceRequests.assignedTo} = assigned_admin.id`)\n        .where(eq(maintenanceRequests.propertyId, propertyId))\n        .orderBy(sql`${maintenanceRequests.createdAt} DESC`);\n\n      // Transform the data to match frontend expectations\n      return maintenanceData.map(request => ({\n        id: request.id,\n        issue: request.title,\n        description: request.description,\n        status: request.status,\n        priority: request.priority || 'medium',\n        images: request.images || [],\n        tenant: request.tenantFirstName && request.tenantLastName \n          ? `${request.tenantFirstName} ${request.tenantLastName}` \n          : 'Unknown',\n        unit: request.unitNumber || 'N/A',\n        assignedAdmin: request.assignedToFirstName && request.assignedToLastName\n          ? `${request.assignedToFirstName} ${request.assignedToLastName}`\n          : 'Unassigned',\n        createdAt: request.createdAt,\n        resolvedAt: request.status === 'completed' ? request.completedAt : null,\n      }));\n    } catch (error) {\n      console.error('Error fetching property maintenance:', error);\n      return [];\n    }\n  }\n\n  async getPropertyPayments(propertyId: string) {\n    try {\n      // Query payments for this property with tenant and unit info\n      const paymentsData = await this.db\n        .select({\n          id: payments.id,\n          amount: payments.amount,\n          amountPaid: payments.amountPaid,\n          dueDate: payments.dueDate,\n          paidDate: payments.paidDate,\n          status: payments.status,\n          tenantFirstName: sql<string>`tenant.first_name`,\n          tenantLastName: sql<string>`tenant.last_name`,\n          unitNumber: units.unitNumber,\n        })\n        .from(payments)\n        .innerJoin(sql`users AS tenant`, sql`${payments.tenantId} = tenant.id`)\n        .innerJoin(units, eq(payments.unitId, units.id))\n        .where(eq(payments.propertyId, propertyId))\n        .orderBy(sql`${payments.dueDate} DESC`);\n\n      // Transform the data to match frontend expectations\n      return paymentsData.map(payment => {\n        const totalDue = Number(payment.amount);\n        const paid = Number(payment.amountPaid);\n        const balance = totalDue - paid;\n\n        return {\n          id: payment.id,\n          tenantName: `${payment.tenantFirstName} ${payment.tenantLastName}`,\n          unitNumber: payment.unitNumber,\n          totalDue,\n          paid,\n          balance,\n          status: payment.status,\n          dueDate: payment.dueDate,\n          lastPayment: payment.paidDate,\n        };\n      });\n    } catch (error) {\n      console.error('Error fetching property payments:', error);\n      return [];\n    }\n  }\n\n  async getAllMaintenanceRequests(filters: {\n    status?: string;\n    priority?: string;\n    page?: number;\n    limit?: number;\n  } = {}) {\n    try {\n      const { status, priority, page = 1, limit = 50 } = filters;\n      const offset = (page - 1) * limit;\n\n      // Build where conditions\n      const conditions: any[] = [];\n      if (status) {\n        conditions.push(eq(maintenanceRequests.status, status as any));\n      }\n      if (priority) {\n        conditions.push(eq(maintenanceRequests.priority, priority as any));\n      }\n\n      // First, let's try a simple query to see if we can get basic maintenance requests\n      console.log('üîç Fetching maintenance requests with filters:', { status, priority, page, limit });\n      \n      // Simple query first - just get maintenance requests with property info\n      const query = this.db\n        .select({\n          id: maintenanceRequests.id,\n          title: maintenanceRequests.title,\n          description: maintenanceRequests.description,\n          status: maintenanceRequests.status,\n          priority: maintenanceRequests.priority,\n          images: maintenanceRequests.images,\n          createdAt: maintenanceRequests.createdAt,\n          completedAt: maintenanceRequests.completedAt,\n          propertyName: properties.name,\n          propertyId: properties.id,\n          tenantId: maintenanceRequests.tenantId,\n          landlordId: maintenanceRequests.landlordId,\n          assignedTo: maintenanceRequests.assignedTo,\n        })\n        .from(maintenanceRequests)\n        .innerJoin(properties, eq(maintenanceRequests.propertyId, properties.id))\n        .orderBy(sql`${maintenanceRequests.createdAt} DESC`)\n        .limit(limit)\n        .offset(offset);\n\n      const maintenanceData = conditions.length > 0 \n        ? await query.where(and(...conditions))\n        : await query;\n\n      console.log(`üìä Found ${maintenanceData.length} maintenance requests`);\n      console.log('Sample data:', maintenanceData.slice(0, 2));\n\n      // For now, let's get tenant and admin names separately to avoid complex joins\n      const transformedData: any[] = [];\n      \n      for (const request of maintenanceData) {\n        // Get tenant info and unit number\n        let tenantName = 'Unknown';\n        let unitNumber = 'N/A';\n        if (request.tenantId) {\n          try {\n            const [tenant] = await this.db\n              .select({\n                firstName: users.firstName,\n                lastName: users.lastName,\n              })\n              .from(users)\n              .where(eq(users.id, request.tenantId))\n              .limit(1);\n            \n            if (tenant) {\n              tenantName = `${tenant.firstName} ${tenant.lastName}`;\n            }\n\n            // Get the unit number for this tenant in this property\n            const [lease] = await this.db\n              .select({\n                unitNumber: units.unitNumber,\n              })\n              .from(leases)\n              .innerJoin(units, eq(leases.unitId, units.id))\n              .where(\n                and(\n                  eq(leases.tenantId, request.tenantId),\n                  eq(leases.propertyId, request.propertyId),\n                  eq(leases.status, 'active')\n                )\n              )\n              .limit(1);\n            \n            if (lease) {\n              unitNumber = lease.unitNumber;\n            }\n          } catch (error) {\n            console.error('Error fetching tenant/unit info:', error);\n          }\n        }\n\n        // Get assigned admin info\n        let assignedAdmin = 'Unassigned';\n        if (request.assignedTo) {\n          try {\n            const [admin] = await this.db\n              .select({\n                firstName: users.firstName,\n                lastName: users.lastName,\n              })\n              .from(users)\n              .where(eq(users.id, request.assignedTo))\n              .limit(1);\n            \n            if (admin) {\n              assignedAdmin = `${admin.firstName} ${admin.lastName}`;\n            }\n          } catch (error) {\n            console.error('Error fetching admin:', error);\n          }\n        }\n\n        transformedData.push({\n          id: request.id,\n          issue: request.title,\n          description: request.description,\n          status: request.status,\n          priority: request.priority || 'medium',\n          images: request.images || [],\n          propertyName: request.propertyName,\n          propertyId: request.propertyId,\n          tenant: tenantName,\n          unit: unitNumber,\n          assignedAdmin,\n          createdAt: request.createdAt,\n          resolvedAt: request.status === 'completed' ? request.completedAt : null,\n        });\n      }\n\n      console.log('‚úÖ Transformed maintenance data:', transformedData);\n      return transformedData;\n    } catch (error) {\n      console.error('Error fetching all maintenance requests:', error);\n      return [];\n    }\n  }\n\n  // Admin Message Methods\n  async getAdminConversations(adminId: string) {\n    try {\n      // Get all messages where admin is sender or receiver\n      const adminMessages = await this.db\n        .select({\n          id: messages.id,\n          senderId: messages.senderId,\n          receiverId: messages.receiverId,\n          content: messages.content,\n          subject: messages.subject,\n          isRead: messages.isRead,\n          createdAt: messages.createdAt,\n        })\n        .from(messages)\n        .where(\n          or(\n            eq(messages.senderId, adminId),\n            eq(messages.receiverId, adminId)\n          )\n        )\n        .orderBy(sql`${messages.createdAt} DESC`);\n\n      // Group by other user and get latest message\n      const conversationsMap = new Map();\n      \n      for (const message of adminMessages) {\n        const otherUserId = message.senderId === adminId ? message.receiverId : message.senderId;\n        \n        if (!conversationsMap.has(otherUserId)) {\n          // Get the other user's details\n          const [otherUser] = await this.db\n            .select({\n              firstName: users.firstName,\n              lastName: users.lastName,\n              role: users.role,\n            })\n            .from(users)\n            .where(eq(users.id, otherUserId));\n\n          if (otherUser) {\n            // Count unread messages from this user\n            const unreadMessages = await this.db\n              .select()\n              .from(messages)\n              .where(\n                and(\n                  eq(messages.senderId, otherUserId),\n                  eq(messages.receiverId, adminId),\n                  eq(messages.isRead, false)\n                )\n              );\n\n            conversationsMap.set(otherUserId, {\n              id: otherUserId,\n              name: `${otherUser.firstName} ${otherUser.lastName}`,\n              role: otherUser.role,\n              lastMessage: message.content,\n              lastMessageTime: message.createdAt,\n              unreadCount: unreadMessages.length,\n              isOwn: message.senderId === adminId,\n            });\n          }\n        }\n      }\n\n      return Array.from(conversationsMap.values());\n    } catch (error) {\n      console.error('Error getting admin conversations:', error);\n      return [];\n    }\n  }\n\n  async getAdminConversation(\n    adminId: string, \n    otherUserId: string, \n    pagination: { page: number; limit: number }\n  ) {\n    try {\n      const { page = 1, limit = 20 } = pagination;\n      const offset = (page - 1) * limit;\n\n      const conversation = await this.db\n        .select({\n          id: messages.id,\n          senderId: messages.senderId,\n          receiverId: messages.receiverId,\n          subject: messages.subject,\n          content: messages.content,\n          isRead: messages.isRead,\n          createdAt: messages.createdAt,\n        })\n        .from(messages)\n        .where(\n          or(\n            and(eq(messages.senderId, adminId), eq(messages.receiverId, otherUserId)),\n            and(eq(messages.senderId, otherUserId), eq(messages.receiverId, adminId))\n          )\n        )\n        .orderBy(sql`${messages.createdAt} ASC`)\n        .limit(limit)\n        .offset(offset);\n\n      // Mark messages from other user as read\n      await this.db\n        .update(messages)\n        .set({ \n          isRead: true, \n          readAt: new Date(),\n          updatedAt: new Date() \n        })\n        .where(\n          and(\n            eq(messages.senderId, otherUserId),\n            eq(messages.receiverId, adminId),\n            eq(messages.isRead, false)\n          )\n        );\n\n      return conversation.map(msg => ({\n        id: msg.id,\n        senderId: msg.senderId,\n        content: msg.content,\n        subject: msg.subject,\n        timestamp: msg.createdAt,\n        isOwn: msg.senderId === adminId,\n        isRead: msg.isRead,\n      }));\n    } catch (error) {\n      console.error('Error getting admin conversation:', error);\n      return [];\n    }\n  }\n\n  async sendAdminMessage(\n    adminId: string, \n    messageDto: { receiverId: string; subject?: string; content: string }\n  ) {\n    try {\n      // Verify receiver exists\n      const [receiver] = await this.db\n        .select()\n        .from(users)\n        .where(eq(users.id, messageDto.receiverId));\n\n      if (!receiver) {\n        throw new NotFoundException('Receiver not found');\n      }\n\n      const messageData = {\n        senderId: adminId,\n        receiverId: messageDto.receiverId,\n        subject: messageDto.subject || 'Message from Admin',\n        content: messageDto.content,\n      };\n\n      const [message] = await this.db.insert(messages).values(messageData).returning();\n      return message;\n    } catch (error) {\n      console.error('Error sending admin message:', error);\n      throw error;\n    }\n  }\n\n  async getAdminUnreadCount(adminId: string) {\n    try {\n      const unreadMessages = await this.db\n        .select()\n        .from(messages)\n        .where(\n          and(\n            eq(messages.receiverId, adminId),\n            eq(messages.isRead, false)\n          )\n        );\n\n      return { count: unreadMessages.length };\n    } catch (error) {\n      console.error('Error getting admin unread count:', error);\n      return { count: 0 };\n    }\n  }\n\n}\n"],"names":["AdminService","getDashboardStats","console","log","userStats","db","select","totalLandlords","sql","totalTenants","totalAdmins","from","users","propertyStats","totalProperties","count","totalUnits","properties","facilitatorStats","totalFacilitators","activeFacilitators","facilitatorPropertyStats","propertiesWithFacilitators","stats","Number","occupiedUnits","vacantUnits","totalRentCollected","pendingPayments","activeMaintenanceRequests","error","getRevenueAnalytics","timeframe","now","Date","monthsBack","parseInt","replace","startDate","getFullYear","getMonth","toISOString","revenueData","month","year","amount","payments","where","and","eq","status","groupBy","orderBy","length","monthlyData","map","row","getMaintenanceAnalytics","maintenanceData","pending","inProgress","completed","cancelled","maintenanceRequests","open","resolved","getUsers","options","page","limit","role","search","offset","finalWhereCondition","firstName","lastName","email","undefined","dataQuery","createdAt","countQuery","data","totalResult","Promise","all","total","user","password","userWithoutPassword","meta","totalPages","Math","ceil","createUser","createUserDto","existingUser","ConflictException","hashedPassword","bcrypt","hash","newUser","insert","values","isEmailVerified","returning","getUserById","id","NotFoundException","updateUser","updateUserDto","updatedUser","update","set","updatedAt","deleteUser","deletedUser","delete","message","toggleUserStatus","currentUser","isActive","getProperties","searchCondition","name","address","landlordAlias","facilitatorAlias","city","state","country","propertyType","description","images","amenities","landlordId","facilitatorId","landlordName","landlordEmail","facilitatorName","facilitatorEmail","leftJoin","assignFacilitatorToProperty","propertyId","facilitator","updatedProperty","removeFacilitatorFromProperty","getPropertyAnalytics","newProperties","averageUnitsPerProperty","getPropertyById","property","landlord","phoneNumber","facilitatorData","getPropertyUnits","unitsData","units","unitNumber","bedrooms","bathrooms","rent","isAvailable","tenantId","leases","leaseStatus","tenantFirstName","tenantLastName","unitId","unit","rentAmount","tenantName","getPropertyTenants","tenantsData","monthlyRent","leaseEndDate","endDate","innerJoin","tenant","getPropertyMaintenance","title","priority","completedAt","assignedToFirstName","assignedToLastName","assignedTo","request","issue","assignedAdmin","resolvedAt","getPropertyPayments","paymentsData","amountPaid","dueDate","paidDate","payment","totalDue","paid","balance","lastPayment","getAllMaintenanceRequests","filters","conditions","push","query","propertyName","slice","transformedData","lease","admin","getAdminConversations","adminId","adminMessages","messages","senderId","receiverId","content","subject","isRead","or","conversationsMap","Map","otherUserId","has","otherUser","unreadMessages","lastMessage","lastMessageTime","unreadCount","isOwn","Array","getAdminConversation","pagination","conversation","readAt","msg","timestamp","sendAdminMessage","messageDto","receiver","messageData","getAdminUnreadCount"],"mappings":"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"}